)]}'
{"version":3,"file":"project1.js","sources":["D:/fpc2js/dist/rtl.js","D:/fpc2js/pas2js-windows-1.5.1/packages/rtl/system.pas","D:/fpc2js/pas2js-windows-1.5.1/packages/rtl/js.pas","D:/fpc2js/pas2js-windows-1.5.1/packages/rtl/web.pas","ugooglemaps.pas","projGMaps.lpr"],"sourcesContent":["var pas = {};\r\n\r\nvar rtl = {\r\n\r\n  version: 10501,\r\n\r\n  quiet: false,\r\n  debug_load_units: false,\r\n  debug_rtti: false,\r\n\r\n  debug: function(){\r\n    if (rtl.quiet || !console || !console.log) return;\r\n    console.log(arguments);\r\n  },\r\n\r\n  error: function(s){\r\n    rtl.debug('Error: ',s);\r\n    throw s;\r\n  },\r\n\r\n  warn: function(s){\r\n    rtl.debug('Warn: ',s);\r\n  },\r\n\r\n  checkVersion: function(v){\r\n    if (rtl.version != v) throw \"expected rtl version \"+v+\", but found \"+rtl.version;\r\n  },\r\n\r\n  hiInt: Math.pow(2,53),\r\n\r\n  hasString: function(s){\r\n    return rtl.isString(s) && (s.length>0);\r\n  },\r\n\r\n  isArray: function(a) {\r\n    return Array.isArray(a);\r\n  },\r\n\r\n  isFunction: function(f){\r\n    return typeof(f)===\"function\";\r\n  },\r\n\r\n  isModule: function(m){\r\n    return rtl.isObject(m) && rtl.hasString(m.$name) && (pas[m.$name]===m);\r\n  },\r\n\r\n  isImplementation: function(m){\r\n    return rtl.isObject(m) && rtl.isModule(m.$module) && (m.$module.$impl===m);\r\n  },\r\n\r\n  isNumber: function(n){\r\n    return typeof(n)===\"number\";\r\n  },\r\n\r\n  isObject: function(o){\r\n    var s=typeof(o);\r\n    return (typeof(o)===\"object\") && (o!=null);\r\n  },\r\n\r\n  isString: function(s){\r\n    return typeof(s)===\"string\";\r\n  },\r\n\r\n  getNumber: function(n){\r\n    return typeof(n)===\"number\"?n:NaN;\r\n  },\r\n\r\n  getChar: function(c){\r\n    return ((typeof(c)===\"string\") && (c.length===1)) ? c : \"\";\r\n  },\r\n\r\n  getObject: function(o){\r\n    return ((typeof(o)===\"object\") || (typeof(o)==='function')) ? o : null;\r\n  },\r\n\r\n  isTRecord: function(type){\r\n    return (rtl.isObject(type) && type.hasOwnProperty('$new') && (typeof(type.$new)==='function'));\r\n  },\r\n\r\n  isPasClass: function(type){\r\n    return (rtl.isObject(type) && type.hasOwnProperty('$classname') && rtl.isObject(type.$module));\r\n  },\r\n\r\n  isPasClassInstance: function(type){\r\n    return (rtl.isObject(type) && rtl.isPasClass(type.$class));\r\n  },\r\n\r\n  hexStr: function(n,digits){\r\n    return (\"000000000000000\"+n.toString(16).toUpperCase()).slice(-digits);\r\n  },\r\n\r\n  m_loading: 0,\r\n  m_loading_intf: 1,\r\n  m_intf_loaded: 2,\r\n  m_loading_impl: 3, // loading all used unit\r\n  m_initializing: 4, // running initialization\r\n  m_initialized: 5,\r\n\r\n  module: function(module_name, intfuseslist, intfcode, impluseslist, implcode){\r\n    if (rtl.debug_load_units) rtl.debug('rtl.module name=\"'+module_name+'\" intfuses='+intfuseslist+' impluses='+impluseslist+' hasimplcode='+rtl.isFunction(implcode));\r\n    if (!rtl.hasString(module_name)) rtl.error('invalid module name \"'+module_name+'\"');\r\n    if (!rtl.isArray(intfuseslist)) rtl.error('invalid interface useslist of \"'+module_name+'\"');\r\n    if (!rtl.isFunction(intfcode)) rtl.error('invalid interface code of \"'+module_name+'\"');\r\n    if (!(impluseslist==undefined) && !rtl.isArray(impluseslist)) rtl.error('invalid implementation useslist of \"'+module_name+'\"');\r\n    if (!(implcode==undefined) && !rtl.isFunction(implcode)) rtl.error('invalid implementation code of \"'+module_name+'\"');\r\n\r\n    if (pas[module_name])\r\n      rtl.error('module \"'+module_name+'\" is already registered');\r\n\r\n    var module = pas[module_name] = {\r\n      $name: module_name,\r\n      $intfuseslist: intfuseslist,\r\n      $impluseslist: impluseslist,\r\n      $state: rtl.m_loading,\r\n      $intfcode: intfcode,\r\n      $implcode: implcode,\r\n      $impl: null,\r\n      $rtti: Object.create(rtl.tSectionRTTI)\r\n    };\r\n    module.$rtti.$module = module;\r\n    if (implcode) module.$impl = {\r\n      $module: module,\r\n      $rtti: module.$rtti\r\n    };\r\n  },\r\n\r\n  exitcode: 0,\r\n\r\n  run: function(module_name){\r\n  \r\n    function doRun(){\r\n      if (!rtl.hasString(module_name)) module_name='program';\r\n      if (rtl.debug_load_units) rtl.debug('rtl.run module=\"'+module_name+'\"');\r\n      rtl.initRTTI();\r\n      var module = pas[module_name];\r\n      if (!module) rtl.error('rtl.run module \"'+module_name+'\" missing');\r\n      rtl.loadintf(module);\r\n      rtl.loadimpl(module);\r\n      if (module_name=='program'){\r\n        if (rtl.debug_load_units) rtl.debug('running $main');\r\n        var r = pas.program.$main();\r\n        if (rtl.isNumber(r)) rtl.exitcode = r;\r\n      }\r\n    }\r\n    \r\n    if (rtl.showUncaughtExceptions) {\r\n      try{\r\n        doRun();\r\n      } catch(re) {\r\n        var errMsg = rtl.hasString(re.$classname) ? re.$classname : '';\r\n\t    errMsg +=  ((errMsg) ? ': ' : '') + (re.hasOwnProperty('fMessage') ? re.fMessage : re);\r\n        alert('Uncaught Exception : '+errMsg);\r\n        rtl.exitCode = 216;\r\n      }\r\n    } else {\r\n      doRun();\r\n    }\r\n    return rtl.exitcode;\r\n  },\r\n\r\n  loadintf: function(module){\r\n    if (module.$state>rtl.m_loading_intf) return; // already finished\r\n    if (rtl.debug_load_units) rtl.debug('loadintf: \"'+module.$name+'\"');\r\n    if (module.$state===rtl.m_loading_intf)\r\n      rtl.error('unit cycle detected \"'+module.$name+'\"');\r\n    module.$state=rtl.m_loading_intf;\r\n    // load interfaces of interface useslist\r\n    rtl.loaduseslist(module,module.$intfuseslist,rtl.loadintf);\r\n    // run interface\r\n    if (rtl.debug_load_units) rtl.debug('loadintf: run intf of \"'+module.$name+'\"');\r\n    module.$intfcode(module.$intfuseslist);\r\n    // success\r\n    module.$state=rtl.m_intf_loaded;\r\n    // Note: units only used in implementations are not yet loaded (not even their interfaces)\r\n  },\r\n\r\n  loaduseslist: function(module,useslist,f){\r\n    if (useslist==undefined) return;\r\n    for (var i in useslist){\r\n      var unitname=useslist[i];\r\n      if (rtl.debug_load_units) rtl.debug('loaduseslist of \"'+module.$name+'\" uses=\"'+unitname+'\"');\r\n      if (pas[unitname]==undefined)\r\n        rtl.error('module \"'+module.$name+'\" misses \"'+unitname+'\"');\r\n      f(pas[unitname]);\r\n    }\r\n  },\r\n\r\n  loadimpl: function(module){\r\n    if (module.$state>=rtl.m_loading_impl) return; // already processing\r\n    if (module.$state<rtl.m_intf_loaded) rtl.error('loadimpl: interface not loaded of \"'+module.$name+'\"');\r\n    if (rtl.debug_load_units) rtl.debug('loadimpl: load uses of \"'+module.$name+'\"');\r\n    module.$state=rtl.m_loading_impl;\r\n    // load interfaces of implementation useslist\r\n    rtl.loaduseslist(module,module.$impluseslist,rtl.loadintf);\r\n    // load implementation of interfaces useslist\r\n    rtl.loaduseslist(module,module.$intfuseslist,rtl.loadimpl);\r\n    // load implementation of implementation useslist\r\n    rtl.loaduseslist(module,module.$impluseslist,rtl.loadimpl);\r\n    // Note: At this point all interfaces used by this unit are loaded. If\r\n    //   there are implementation uses cycles some used units might not yet be\r\n    //   initialized. This is by design.\r\n    // run implementation\r\n    if (rtl.debug_load_units) rtl.debug('loadimpl: run impl of \"'+module.$name+'\"');\r\n    if (rtl.isFunction(module.$implcode)) module.$implcode(module.$impluseslist);\r\n    // run initialization\r\n    if (rtl.debug_load_units) rtl.debug('loadimpl: run init of \"'+module.$name+'\"');\r\n    module.$state=rtl.m_initializing;\r\n    if (rtl.isFunction(module.$init)) module.$init();\r\n    // unit initialized\r\n    module.$state=rtl.m_initialized;\r\n  },\r\n\r\n  createCallback: function(scope, fn){\r\n    var cb;\r\n    if (typeof(fn)==='string'){\r\n      cb = function(){\r\n        return scope[fn].apply(scope,arguments);\r\n      };\r\n    } else {\r\n      cb = function(){\r\n        return fn.apply(scope,arguments);\r\n      };\r\n    };\r\n    cb.scope = scope;\r\n    cb.fn = fn;\r\n    return cb;\r\n  },\r\n\r\n  cloneCallback: function(cb){\r\n    return rtl.createCallback(cb.scope,cb.fn);\r\n  },\r\n\r\n  eqCallback: function(a,b){\r\n    // can be a function or a function wrapper\r\n    if (a==b){\r\n      return true;\r\n    } else {\r\n      return (a!=null) && (b!=null) && (a.fn) && (a.scope===b.scope) && (a.fn==b.fn);\r\n    }\r\n  },\r\n\r\n  initStruct: function(c,parent,name){\r\n    if ((parent.$module) && (parent.$module.$impl===parent)) parent=parent.$module;\r\n    c.$parent = parent;\r\n    if (rtl.isModule(parent)){\r\n      c.$module = parent;\r\n      c.$name = name;\r\n    } else {\r\n      c.$module = parent.$module;\r\n      c.$name = parent.$name+'.'+name;\r\n    };\r\n    return parent;\r\n  },\r\n\r\n  initClass: function(c,parent,name,initfn){\r\n    parent[name] = c;\r\n    c.$class = c; // Note: o.$class === Object.getPrototypeOf(o)\r\n    c.$classname = name;\r\n    parent = rtl.initStruct(c,parent,name);\r\n    c.$fullname = parent.$name+'.'+name;\r\n    // rtti\r\n    if (rtl.debug_rtti) rtl.debug('initClass '+c.$fullname);\r\n    var t = c.$module.$rtti.$Class(c.$name,{ \"class\": c });\r\n    c.$rtti = t;\r\n    if (rtl.isObject(c.$ancestor)) t.ancestor = c.$ancestor.$rtti;\r\n    if (!t.ancestor) t.ancestor = null;\r\n    // init members\r\n    initfn.call(c);\r\n  },\r\n\r\n  createClass: function(parent,name,ancestor,initfn){\r\n    // create a normal class,\r\n    // ancestor must be null or a normal class,\r\n    // the root ancestor can be an external class\r\n    var c = null;\r\n    if (ancestor != null){\r\n      c = Object.create(ancestor);\r\n      c.$ancestor = ancestor;\r\n      // Note:\r\n      // if root is an \"object\" then c.$ancestor === Object.getPrototypeOf(c)\r\n      // if root is a \"function\" then c.$ancestor === c.__proto__, Object.getPrototypeOf(c) returns the root\r\n    } else {\r\n      c = {};\r\n      c.$create = function(fn,args){\r\n        if (args == undefined) args = [];\r\n        var o = Object.create(this);\r\n        o.$init();\r\n        try{\r\n          if (typeof(fn)===\"string\"){\r\n            o[fn].apply(o,args);\r\n          } else {\r\n            fn.apply(o,args);\r\n          };\r\n          o.AfterConstruction();\r\n        } catch($e){\r\n          // do not call BeforeDestruction\r\n          if (o.Destroy) o.Destroy();\r\n          o.$final();\r\n          throw $e;\r\n        }\r\n        return o;\r\n      };\r\n      c.$destroy = function(fnname){\r\n        this.BeforeDestruction();\r\n        if (this[fnname]) this[fnname]();\r\n        this.$final();\r\n      };\r\n    };\r\n    rtl.initClass(c,parent,name,initfn);\r\n  },\r\n\r\n  createClassExt: function(parent,name,ancestor,newinstancefnname,initfn){\r\n    // Create a class using an external ancestor.\r\n    // If newinstancefnname is given, use that function to create the new object.\r\n    // If exist call BeforeDestruction and AfterConstruction.\r\n    var c = Object.create(ancestor);\r\n    c.$create = function(fn,args){\r\n      if (args == undefined) args = [];\r\n      var o = null;\r\n      if (newinstancefnname.length>0){\r\n        o = this[newinstancefnname](fn,args);\r\n      } else {\r\n        o = Object.create(this);\r\n      }\r\n      if (o.$init) o.$init();\r\n      try{\r\n        if (typeof(fn)===\"string\"){\r\n          o[fn].apply(o,args);\r\n        } else {\r\n          fn.apply(o,args);\r\n        };\r\n        if (o.AfterConstruction) o.AfterConstruction();\r\n      } catch($e){\r\n        // do not call BeforeDestruction\r\n        if (o.Destroy) o.Destroy();\r\n        if (o.$final) this.$final();\r\n        throw $e;\r\n      }\r\n      return o;\r\n    };\r\n    c.$destroy = function(fnname){\r\n      if (this.BeforeDestruction) this.BeforeDestruction();\r\n      if (this[fnname]) this[fnname]();\r\n      if (this.$final) this.$final();\r\n    };\r\n    rtl.initClass(c,parent,name,initfn);\r\n  },\r\n\r\n  createHelper: function(parent,name,ancestor,initfn){\r\n    // create a helper,\r\n    // ancestor must be null or a helper,\r\n    var c = null;\r\n    if (ancestor != null){\r\n      c = Object.create(ancestor);\r\n      c.$ancestor = ancestor;\r\n      // c.$ancestor === Object.getPrototypeOf(c)\r\n    } else {\r\n      c = {};\r\n    };\r\n    parent[name] = c;\r\n    c.$class = c; // Note: o.$class === Object.getPrototypeOf(o)\r\n    c.$classname = name;\r\n    parent = rtl.initStruct(c,parent,name);\r\n    c.$fullname = parent.$name+'.'+name;\r\n    // rtti\r\n    var t = c.$module.$rtti.$Helper(c.$name,{ \"helper\": c });\r\n    c.$rtti = t;\r\n    if (rtl.isObject(ancestor)) t.ancestor = ancestor.$rtti;\r\n    if (!t.ancestor) t.ancestor = null;\r\n    // init members\r\n    initfn.call(c);\r\n  },\r\n\r\n  tObjectDestroy: \"Destroy\",\r\n\r\n  free: function(obj,name){\r\n    if (obj[name]==null) return null;\r\n    obj[name].$destroy(rtl.tObjectDestroy);\r\n    obj[name]=null;\r\n  },\r\n\r\n  freeLoc: function(obj){\r\n    if (obj==null) return null;\r\n    obj.$destroy(rtl.tObjectDestroy);\r\n    return null;\r\n  },\r\n\r\n  recNewT: function(parent,name,initfn,full){\r\n    // create new record type\r\n    var t = {};\r\n    if (parent) parent[name] = t;\r\n    function hide(prop){\r\n      Object.defineProperty(t,prop,{enumerable:false});\r\n    }\r\n    if (full){\r\n      rtl.initStruct(t,parent,name);\r\n      t.$record = t;\r\n      hide('$record');\r\n      hide('$name');\r\n      hide('$parent');\r\n      hide('$module');\r\n    }\r\n    initfn.call(t);\r\n    if (!t.$new){\r\n      t.$new = function(){ return Object.create(this); };\r\n    }\r\n    t.$clone = function(r){ return this.$new().$assign(r); };\r\n    hide('$new');\r\n    hide('$clone');\r\n    hide('$eq');\r\n    hide('$assign');\r\n    return t;\r\n  },\r\n\r\n  is: function(instance,type){\r\n    return type.isPrototypeOf(instance) || (instance===type);\r\n  },\r\n\r\n  isExt: function(instance,type,mode){\r\n    // mode===1 means instance must be a Pascal class instance\r\n    // mode===2 means instance must be a Pascal class\r\n    // Notes:\r\n    // isPrototypeOf and instanceof return false on equal\r\n    // isPrototypeOf does not work for Date.isPrototypeOf(new Date())\r\n    //   so if isPrototypeOf is false test with instanceof\r\n    // instanceof needs a function on right side\r\n    if (instance == null) return false; // Note: ==null checks for undefined too\r\n    if ((typeof(type) !== 'object') && (typeof(type) !== 'function')) return false;\r\n    if (instance === type){\r\n      if (mode===1) return false;\r\n      if (mode===2) return rtl.isPasClass(instance);\r\n      return true;\r\n    }\r\n    if (type.isPrototypeOf && type.isPrototypeOf(instance)){\r\n      if (mode===1) return rtl.isPasClassInstance(instance);\r\n      if (mode===2) return rtl.isPasClass(instance);\r\n      return true;\r\n    }\r\n    if ((typeof type == 'function') && (instance instanceof type)) return true;\r\n    return false;\r\n  },\r\n\r\n  Exception: null,\r\n  EInvalidCast: null,\r\n  EAbstractError: null,\r\n  ERangeError: null,\r\n  EIntOverflow: null,\r\n  EPropWriteOnly: null,\r\n\r\n  raiseE: function(typename){\r\n    var t = rtl[typename];\r\n    if (t==null){\r\n      var mod = pas.SysUtils;\r\n      if (!mod) mod = pas.sysutils;\r\n      if (mod){\r\n        t = mod[typename];\r\n        if (!t) t = mod[typename.toLowerCase()];\r\n        if (!t) t = mod['Exception'];\r\n        if (!t) t = mod['exception'];\r\n      }\r\n    }\r\n    if (t){\r\n      if (t.Create){\r\n        throw t.$create(\"Create\");\r\n      } else if (t.create){\r\n        throw t.$create(\"create\");\r\n      }\r\n    }\r\n    if (typename === \"EInvalidCast\") throw \"invalid type cast\";\r\n    if (typename === \"EAbstractError\") throw \"Abstract method called\";\r\n    if (typename === \"ERangeError\") throw \"range error\";\r\n    throw typename;\r\n  },\r\n\r\n  as: function(instance,type){\r\n    if((instance === null) || rtl.is(instance,type)) return instance;\r\n    rtl.raiseE(\"EInvalidCast\");\r\n  },\r\n\r\n  asExt: function(instance,type,mode){\r\n    if((instance === null) || rtl.isExt(instance,type,mode)) return instance;\r\n    rtl.raiseE(\"EInvalidCast\");\r\n  },\r\n\r\n  createInterface: function(module, name, guid, fnnames, ancestor, initfn){\r\n    //console.log('createInterface name=\"'+name+'\" guid=\"'+guid+'\" names='+fnnames);\r\n    var i = ancestor?Object.create(ancestor):{};\r\n    module[name] = i;\r\n    i.$module = module;\r\n    i.$name = name;\r\n    i.$fullname = module.$name+'.'+name;\r\n    i.$guid = guid;\r\n    i.$guidr = null;\r\n    i.$names = fnnames?fnnames:[];\r\n    if (rtl.isFunction(initfn)){\r\n      // rtti\r\n      if (rtl.debug_rtti) rtl.debug('createInterface '+i.$fullname);\r\n      var t = i.$module.$rtti.$Interface(name,{ \"interface\": i, module: module });\r\n      i.$rtti = t;\r\n      if (ancestor) t.ancestor = ancestor.$rtti;\r\n      if (!t.ancestor) t.ancestor = null;\r\n      initfn.call(i);\r\n    }\r\n    return i;\r\n  },\r\n\r\n  strToGUIDR: function(s,g){\r\n    var p = 0;\r\n    function n(l){\r\n      var h = s.substr(p,l);\r\n      p+=l;\r\n      return parseInt(h,16);\r\n    }\r\n    p+=1; // skip {\r\n    g.D1 = n(8);\r\n    p+=1; // skip -\r\n    g.D2 = n(4);\r\n    p+=1; // skip -\r\n    g.D3 = n(4);\r\n    p+=1; // skip -\r\n    if (!g.D4) g.D4=[];\r\n    g.D4[0] = n(2);\r\n    g.D4[1] = n(2);\r\n    p+=1; // skip -\r\n    for(var i=2; i<8; i++) g.D4[i] = n(2);\r\n    return g;\r\n  },\r\n\r\n  guidrToStr: function(g){\r\n    if (g.$intf) return g.$intf.$guid;\r\n    var h = rtl.hexStr;\r\n    var s='{'+h(g.D1,8)+'-'+h(g.D2,4)+'-'+h(g.D3,4)+'-'+h(g.D4[0],2)+h(g.D4[1],2)+'-';\r\n    for (var i=2; i<8; i++) s+=h(g.D4[i],2);\r\n    s+='}';\r\n    return s;\r\n  },\r\n\r\n  createTGUID: function(guid){\r\n    var TGuid = (pas.System)?pas.System.TGuid:pas.system.tguid;\r\n    var g = rtl.strToGUIDR(guid,TGuid.$new());\r\n    return g;\r\n  },\r\n\r\n  getIntfGUIDR: function(intfTypeOrVar){\r\n    if (!intfTypeOrVar) return null;\r\n    if (!intfTypeOrVar.$guidr){\r\n      var g = rtl.createTGUID(intfTypeOrVar.$guid);\r\n      if (!intfTypeOrVar.hasOwnProperty('$guid')) intfTypeOrVar = Object.getPrototypeOf(intfTypeOrVar);\r\n      g.$intf = intfTypeOrVar;\r\n      intfTypeOrVar.$guidr = g;\r\n    }\r\n    return intfTypeOrVar.$guidr;\r\n  },\r\n\r\n  addIntf: function (aclass, intf, map){\r\n    function jmp(fn){\r\n      if (typeof(fn)===\"function\"){\r\n        return function(){ return fn.apply(this.$o,arguments); };\r\n      } else {\r\n        return function(){ rtl.raiseE('EAbstractError'); };\r\n      }\r\n    }\r\n    if(!map) map = {};\r\n    var t = intf;\r\n    var item = Object.create(t);\r\n    if (!aclass.hasOwnProperty('$intfmaps')) aclass.$intfmaps = {};\r\n    aclass.$intfmaps[intf.$guid] = item;\r\n    do{\r\n      var names = t.$names;\r\n      if (!names) break;\r\n      for (var i=0; i<names.length; i++){\r\n        var intfname = names[i];\r\n        var fnname = map[intfname];\r\n        if (!fnname) fnname = intfname;\r\n        //console.log('addIntf: intftype='+t.$name+' index='+i+' intfname=\"'+intfname+'\" fnname=\"'+fnname+'\" old='+typeof(item[intfname]));\r\n        item[intfname] = jmp(aclass[fnname]);\r\n      }\r\n      t = Object.getPrototypeOf(t);\r\n    }while(t!=null);\r\n  },\r\n\r\n  getIntfG: function (obj, guid, query){\r\n    if (!obj) return null;\r\n    //console.log('getIntfG: obj='+obj.$classname+' guid='+guid+' query='+query);\r\n    // search\r\n    var maps = obj.$intfmaps;\r\n    if (!maps) return null;\r\n    var item = maps[guid];\r\n    if (!item) return null;\r\n    // check delegation\r\n    //console.log('getIntfG: obj='+obj.$classname+' guid='+guid+' query='+query+' item='+typeof(item));\r\n    if (typeof item === 'function') return item.call(obj); // delegate. Note: COM contains _AddRef\r\n    // check cache\r\n    var intf = null;\r\n    if (obj.$interfaces){\r\n      intf = obj.$interfaces[guid];\r\n      //console.log('getIntfG: obj='+obj.$classname+' guid='+guid+' cache='+typeof(intf));\r\n    }\r\n    if (!intf){ // intf can be undefined!\r\n      intf = Object.create(item);\r\n      intf.$o = obj;\r\n      if (!obj.$interfaces) obj.$interfaces = {};\r\n      obj.$interfaces[guid] = intf;\r\n    }\r\n    if (typeof(query)==='object'){\r\n      // called by queryIntfT\r\n      var o = null;\r\n      if (intf.QueryInterface(rtl.getIntfGUIDR(query),\r\n          {get:function(){ return o; }, set:function(v){ o=v; }}) === 0){\r\n        return o;\r\n      } else {\r\n        return null;\r\n      }\r\n    } else if(query===2){\r\n      // called by TObject.GetInterfaceByStr\r\n      if (intf.$kind === 'com') intf._AddRef();\r\n    }\r\n    return intf;\r\n  },\r\n\r\n  getIntfT: function(obj,intftype){\r\n    return rtl.getIntfG(obj,intftype.$guid);\r\n  },\r\n\r\n  queryIntfT: function(obj,intftype){\r\n    return rtl.getIntfG(obj,intftype.$guid,intftype);\r\n  },\r\n\r\n  queryIntfIsT: function(obj,intftype){\r\n    var i = rtl.queryIntfG(obj,intftype.$guid);\r\n    if (!i) return false;\r\n    if (i.$kind === 'com') i._Release();\r\n    return true;\r\n  },\r\n\r\n  asIntfT: function (obj,intftype){\r\n    var i = rtl.getIntfG(obj,intftype.$guid);\r\n    if (i!==null) return i;\r\n    rtl.raiseEInvalidCast();\r\n  },\r\n\r\n  intfIsClass: function(intf,classtype){\r\n    return (intf!=null) && (rtl.is(intf.$o,classtype));\r\n  },\r\n\r\n  intfAsClass: function(intf,classtype){\r\n    if (intf==null) return null;\r\n    return rtl.as(intf.$o,classtype);\r\n  },\r\n\r\n  intfToClass: function(intf,classtype){\r\n    if ((intf!==null) && rtl.is(intf.$o,classtype)) return intf.$o;\r\n    return null;\r\n  },\r\n\r\n  // interface reference counting\r\n  intfRefs: { // base object for temporary interface variables\r\n    ref: function(id,intf){\r\n      // called for temporary interface references needing delayed release\r\n      var old = this[id];\r\n      //console.log('rtl.intfRefs.ref: id='+id+' old=\"'+(old?old.$name:'null')+'\" intf=\"'+(intf?intf.$name:'null')+' $o='+(intf?intf.$o:'null'));\r\n      if (old){\r\n        // called again, e.g. in a loop\r\n        delete this[id];\r\n        old._Release(); // may fail\r\n      }\r\n      this[id]=intf;\r\n      return intf;\r\n    },\r\n    free: function(){\r\n      //console.log('rtl.intfRefs.free...');\r\n      for (var id in this){\r\n        if (this.hasOwnProperty(id)){\r\n          //console.log('rtl.intfRefs.free: id='+id+' '+this[id].$name+' $o='+this[id].$o.$classname);\r\n          this[id]._Release();\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  createIntfRefs: function(){\r\n    //console.log('rtl.createIntfRefs');\r\n    return Object.create(rtl.intfRefs);\r\n  },\r\n\r\n  setIntfP: function(path,name,value,skipAddRef){\r\n    var old = path[name];\r\n    //console.log('rtl.setIntfP path='+path+' name='+name+' old=\"'+(old?old.$name:'null')+'\" value=\"'+(value?value.$name:'null')+'\"');\r\n    if (old === value) return;\r\n    if (old !== null){\r\n      path[name]=null;\r\n      old._Release();\r\n    }\r\n    if (value !== null){\r\n      if (!skipAddRef) value._AddRef();\r\n      path[name]=value;\r\n    }\r\n  },\r\n\r\n  setIntfL: function(old,value,skipAddRef){\r\n    //console.log('rtl.setIntfL old=\"'+(old?old.$name:'null')+'\" value=\"'+(value?value.$name:'null')+'\"');\r\n    if (old !== value){\r\n      if (value!==null){\r\n        if (!skipAddRef) value._AddRef();\r\n      }\r\n      if (old!==null){\r\n        old._Release();  // Release after AddRef, to avoid double Release if Release creates an exception\r\n      }\r\n    } else if (skipAddRef){\r\n      if (old!==null){\r\n        old._Release();  // value has an AddRef\r\n      }\r\n    }\r\n    return value;\r\n  },\r\n\r\n  _AddRef: function(intf){\r\n    //if (intf) console.log('rtl._AddRef intf=\"'+(intf?intf.$name:'null')+'\"');\r\n    if (intf) intf._AddRef();\r\n    return intf;\r\n  },\r\n\r\n  _Release: function(intf){\r\n    //if (intf) console.log('rtl._Release intf=\"'+(intf?intf.$name:'null')+'\"');\r\n    if (intf) intf._Release();\r\n    return intf;\r\n  },\r\n\r\n  checkMethodCall: function(obj,type){\r\n    if (rtl.isObject(obj) && rtl.is(obj,type)) return;\r\n    rtl.raiseE(\"EInvalidCast\");\r\n  },\r\n\r\n  oc: function(i){\r\n    // overflow check integer\r\n    if ((Math.floor(i)===i) && (i>=-0x1fffffffffffff) && (i<=0x1fffffffffffff)) return i;\r\n    rtl.raiseE('EIntOverflow');\r\n  },\r\n\r\n  rc: function(i,minval,maxval){\r\n    // range check integer\r\n    if ((Math.floor(i)===i) && (i>=minval) && (i<=maxval)) return i;\r\n    rtl.raiseE('ERangeError');\r\n  },\r\n\r\n  rcc: function(c,minval,maxval){\r\n    // range check char\r\n    if ((typeof(c)==='string') && (c.length===1)){\r\n      var i = c.charCodeAt(0);\r\n      if ((i>=minval) && (i<=maxval)) return c;\r\n    }\r\n    rtl.raiseE('ERangeError');\r\n  },\r\n\r\n  rcSetCharAt: function(s,index,c){\r\n    // range check setCharAt\r\n    if ((typeof(s)!=='string') || (index<0) || (index>=s.length)) rtl.raiseE('ERangeError');\r\n    return rtl.setCharAt(s,index,c);\r\n  },\r\n\r\n  rcCharAt: function(s,index){\r\n    // range check charAt\r\n    if ((typeof(s)!=='string') || (index<0) || (index>=s.length)) rtl.raiseE('ERangeError');\r\n    return s.charAt(index);\r\n  },\r\n\r\n  rcArrR: function(arr,index){\r\n    // range check read array\r\n    if (Array.isArray(arr) && (typeof(index)==='number') && (index>=0) && (index<arr.length)){\r\n      if (arguments.length>2){\r\n        // arr,index1,index2,...\r\n        arr=arr[index];\r\n        for (var i=2; i<arguments.length; i++) arr=rtl.rcArrR(arr,arguments[i]);\r\n        return arr;\r\n      }\r\n      return arr[index];\r\n    }\r\n    rtl.raiseE('ERangeError');\r\n  },\r\n\r\n  rcArrW: function(arr,index,value){\r\n    // range check write array\r\n    // arr,index1,index2,...,value\r\n    for (var i=3; i<arguments.length; i++){\r\n      arr=rtl.rcArrR(arr,index);\r\n      index=arguments[i-1];\r\n      value=arguments[i];\r\n    }\r\n    if (Array.isArray(arr) && (typeof(index)==='number') && (index>=0) && (index<arr.length)){\r\n      return arr[index]=value;\r\n    }\r\n    rtl.raiseE('ERangeError');\r\n  },\r\n\r\n  length: function(arr){\r\n    return (arr == null) ? 0 : arr.length;\r\n  },\r\n\r\n  arraySetLength: function(arr,defaultvalue,newlength){\r\n    // multi dim: (arr,defaultvalue,dim1,dim2,...)\r\n    var p = arguments;\r\n    function setLength(src,argNo){\r\n      var newlen = p[argNo];\r\n      var a = [];\r\n      a.length = newlength;\r\n      if (argNo === p.length-1){\r\n        var oldlen = src?src.length:0;\r\n        if (rtl.isArray(defaultvalue)){\r\n          for (var i=0; i<newlen; i++) a[i]=(i<oldlen)?src[i]:[]; // array of dyn array\r\n        } else if (rtl.isObject(defaultvalue)) {\r\n          if (rtl.isTRecord(defaultvalue)){\r\n            for (var i=0; i<newlen; i++)\r\n              a[i]=(i<oldlen)?defaultvalue.$clone(src[i]):defaultvalue.$new(); // e.g. record\r\n          } else {\r\n            for (var i=0; i<newlen; i++) a[i]=(i<oldlen)?rtl.refSet(src[i]):{}; // e.g. set\r\n          }\r\n        } else {\r\n          for (var i=0; i<newlen; i++)\r\n            a[i]=(i<oldlen)?src[i]:defaultvalue;\r\n        }\r\n      } else {\r\n        // multi dim array\r\n        for (var i=0; i<newlen; i++) a[i]=setLength(src?src[i]:null,argNo+1);\r\n      }\r\n      return a;\r\n    }\r\n    return setLength(arr,2);\r\n  },\r\n\r\n  /*arrayChgLength: function(arr,defaultvalue,newlength){\r\n    // multi dim: (arr,defaultvalue,dim1,dim2,...)\r\n    if (arr == null) arr = [];\r\n    var p = arguments;\r\n    function setLength(a,argNo){\r\n      var oldlen = a.length;\r\n      var newlen = p[argNo];\r\n      if (oldlen!==newlength){\r\n        a.length = newlength;\r\n        if (argNo === p.length-1){\r\n          if (rtl.isArray(defaultvalue)){\r\n            for (var i=oldlen; i<newlen; i++) a[i]=[]; // nested array\r\n          } else if (rtl.isObject(defaultvalue)) {\r\n            if (rtl.isTRecord(defaultvalue)){\r\n              for (var i=oldlen; i<newlen; i++) a[i]=defaultvalue.$new(); // e.g. record\r\n            } else {\r\n              for (var i=oldlen; i<newlen; i++) a[i]={}; // e.g. set\r\n            }\r\n          } else {\r\n            for (var i=oldlen; i<newlen; i++) a[i]=defaultvalue;\r\n          }\r\n        } else {\r\n          for (var i=oldlen; i<newlen; i++) a[i]=[]; // nested array\r\n        }\r\n      }\r\n      if (argNo < p.length-1){\r\n        // multi argNo\r\n        for (var i=0; i<newlen; i++) a[i]=setLength(a[i],argNo+1);\r\n      }\r\n      return a;\r\n    }\r\n    return setLength(arr,2);\r\n  },*/\r\n\r\n  arrayEq: function(a,b){\r\n    if (a===null) return b===null;\r\n    if (b===null) return false;\r\n    if (a.length!==b.length) return false;\r\n    for (var i=0; i<a.length; i++) if (a[i]!==b[i]) return false;\r\n    return true;\r\n  },\r\n\r\n  arrayClone: function(type,src,srcpos,endpos,dst,dstpos){\r\n    // type: 0 for references, \"refset\" for calling refSet(), a function for new type()\r\n    // src must not be null\r\n    // This function does not range check.\r\n    if(type === 'refSet') {\r\n      for (; srcpos<endpos; srcpos++) dst[dstpos++] = rtl.refSet(src[srcpos]); // ref set\r\n    } else if (rtl.isTRecord(type)){\r\n      for (; srcpos<endpos; srcpos++) dst[dstpos++] = type.$clone(src[srcpos]); // clone record\r\n    }  else {\r\n      for (; srcpos<endpos; srcpos++) dst[dstpos++] = src[srcpos]; // reference\r\n    };\r\n  },\r\n\r\n  arrayConcat: function(type){\r\n    // type: see rtl.arrayClone\r\n    var a = [];\r\n    var l = 0;\r\n    for (var i=1; i<arguments.length; i++){\r\n      var src = arguments[i];\r\n      if (src !== null) l+=src.length;\r\n    };\r\n    a.length = l;\r\n    l=0;\r\n    for (var i=1; i<arguments.length; i++){\r\n      var src = arguments[i];\r\n      if (src === null) continue;\r\n      rtl.arrayClone(type,src,0,src.length,a,l);\r\n      l+=src.length;\r\n    };\r\n    return a;\r\n  },\r\n\r\n  arrayConcatN: function(){\r\n    var a = null;\r\n    for (var i=1; i<arguments.length; i++){\r\n      var src = arguments[i];\r\n      if (src === null) continue;\r\n      if (a===null){\r\n        a=src; // Note: concat(a) does not clone\r\n      } else {\r\n        a=a.concat(src);\r\n      }\r\n    };\r\n    return a;\r\n  },\r\n\r\n  arrayCopy: function(type, srcarray, index, count){\r\n    // type: see rtl.arrayClone\r\n    // if count is missing, use srcarray.length\r\n    if (srcarray === null) return [];\r\n    if (index < 0) index = 0;\r\n    if (count === undefined) count=srcarray.length;\r\n    var end = index+count;\r\n    if (end>srcarray.length) end = srcarray.length;\r\n    if (index>=end) return [];\r\n    if (type===0){\r\n      return srcarray.slice(index,end);\r\n    } else {\r\n      var a = [];\r\n      a.length = end-index;\r\n      rtl.arrayClone(type,srcarray,index,end,a,0);\r\n      return a;\r\n    }\r\n  },\r\n\r\n  setCharAt: function(s,index,c){\r\n    return s.substr(0,index)+c+s.substr(index+1);\r\n  },\r\n\r\n  getResStr: function(mod,name){\r\n    var rs = mod.$resourcestrings[name];\r\n    return rs.current?rs.current:rs.org;\r\n  },\r\n\r\n  createSet: function(){\r\n    var s = {};\r\n    for (var i=0; i<arguments.length; i++){\r\n      if (arguments[i]!=null){\r\n        s[arguments[i]]=true;\r\n      } else {\r\n        var first=arguments[i+=1];\r\n        var last=arguments[i+=1];\r\n        for(var j=first; j<=last; j++) s[j]=true;\r\n      }\r\n    }\r\n    return s;\r\n  },\r\n\r\n  cloneSet: function(s){\r\n    var r = {};\r\n    for (var key in s) r[key]=true;\r\n    return r;\r\n  },\r\n\r\n  refSet: function(s){\r\n    Object.defineProperty(s, '$shared', {\r\n      enumerable: false,\r\n      configurable: true,\r\n      writable: true,\r\n      value: true\r\n    });\r\n    return s;\r\n  },\r\n\r\n  includeSet: function(s,enumvalue){\r\n    if (s.$shared) s = rtl.cloneSet(s);\r\n    s[enumvalue] = true;\r\n    return s;\r\n  },\r\n\r\n  excludeSet: function(s,enumvalue){\r\n    if (s.$shared) s = rtl.cloneSet(s);\r\n    delete s[enumvalue];\r\n    return s;\r\n  },\r\n\r\n  diffSet: function(s,t){\r\n    var r = {};\r\n    for (var key in s) if (!t[key]) r[key]=true;\r\n    return r;\r\n  },\r\n\r\n  unionSet: function(s,t){\r\n    var r = {};\r\n    for (var key in s) r[key]=true;\r\n    for (var key in t) r[key]=true;\r\n    return r;\r\n  },\r\n\r\n  intersectSet: function(s,t){\r\n    var r = {};\r\n    for (var key in s) if (t[key]) r[key]=true;\r\n    return r;\r\n  },\r\n\r\n  symDiffSet: function(s,t){\r\n    var r = {};\r\n    for (var key in s) if (!t[key]) r[key]=true;\r\n    for (var key in t) if (!s[key]) r[key]=true;\r\n    return r;\r\n  },\r\n\r\n  eqSet: function(s,t){\r\n    for (var key in s) if (!t[key]) return false;\r\n    for (var key in t) if (!s[key]) return false;\r\n    return true;\r\n  },\r\n\r\n  neSet: function(s,t){\r\n    return !rtl.eqSet(s,t);\r\n  },\r\n\r\n  leSet: function(s,t){\r\n    for (var key in s) if (!t[key]) return false;\r\n    return true;\r\n  },\r\n\r\n  geSet: function(s,t){\r\n    for (var key in t) if (!s[key]) return false;\r\n    return true;\r\n  },\r\n\r\n  strSetLength: function(s,newlen){\r\n    var oldlen = s.length;\r\n    if (oldlen > newlen){\r\n      return s.substring(0,newlen);\r\n    } else if (s.repeat){\r\n      // Note: repeat needs ECMAScript6!\r\n      return s+' '.repeat(newlen-oldlen);\r\n    } else {\r\n       while (oldlen<newlen){\r\n         s+=' ';\r\n         oldlen++;\r\n       };\r\n       return s;\r\n    }\r\n  },\r\n\r\n  spaceLeft: function(s,width){\r\n    var l=s.length;\r\n    if (l>=width) return s;\r\n    if (s.repeat){\r\n      // Note: repeat needs ECMAScript6!\r\n      return ' '.repeat(width-l) + s;\r\n    } else {\r\n      while (l<width){\r\n        s=' '+s;\r\n        l++;\r\n      };\r\n    };\r\n  },\r\n\r\n  floatToStr: function(d,w,p){\r\n    // input 1-3 arguments: double, width, precision\r\n    if (arguments.length>2){\r\n      return rtl.spaceLeft(d.toFixed(p),w);\r\n    } else {\r\n\t  // exponent width\r\n\t  var pad = \"\";\r\n\t  var ad = Math.abs(d);\r\n\t  if (ad<1.0e+10) {\r\n\t\tpad='00';\r\n\t  } else if (ad<1.0e+100) {\r\n\t\tpad='0';\r\n      }  \t\r\n\t  if (arguments.length<2) {\r\n\t    w=9;\t\t\r\n      } else if (w<9) {\r\n\t\tw=9;\r\n      }\t\t  \r\n      var p = w-8;\r\n      var s=(d>0 ? \" \" : \"\" ) + d.toExponential(p);\r\n      s=s.replace(/e(.)/,'E$1'+pad);\r\n      return rtl.spaceLeft(s,w);\r\n    }\r\n  },\r\n\r\n  valEnum: function(s, enumType, setCodeFn){\r\n    s = s.toLowerCase();\r\n    for (var key in enumType){\r\n      if((typeof(key)==='string') && (key.toLowerCase()===s)){\r\n        setCodeFn(0);\r\n        return enumType[key];\r\n      }\r\n    }\r\n    setCodeFn(1);\r\n    return 0;\r\n  },\r\n\r\n  and: function(a,b){\r\n    var hi = 0x80000000;\r\n    var low = 0x7fffffff;\r\n    var h = (a / hi) & (b / hi);\r\n    var l = (a & low) & (b & low);\r\n    return h*hi + l;\r\n  },\r\n\r\n  or: function(a,b){\r\n    var hi = 0x80000000;\r\n    var low = 0x7fffffff;\r\n    var h = (a / hi) | (b / hi);\r\n    var l = (a & low) | (b & low);\r\n    return h*hi + l;\r\n  },\r\n\r\n  xor: function(a,b){\r\n    var hi = 0x80000000;\r\n    var low = 0x7fffffff;\r\n    var h = (a / hi) ^ (b / hi);\r\n    var l = (a & low) ^ (b & low);\r\n    return h*hi + l;\r\n  },\r\n\r\n  shr: function(a,b){\r\n    if (a<0) a += rtl.hiInt;\r\n    if (a<0x80000000) return a >> b;\r\n    if (b<=0) return a;\r\n    if (b>54) return 0;\r\n    return Math.floor(a / Math.pow(2,b));\r\n  },\r\n\r\n  shl: function(a,b){\r\n    if (a<0) a += rtl.hiInt;\r\n    if (b<=0) return a;\r\n    if (b>54) return 0;\r\n    var r = a * Math.pow(2,b);\r\n    if (r <= rtl.hiInt) return r;\r\n    return r % rtl.hiInt;\r\n  },\r\n\r\n  initRTTI: function(){\r\n    if (rtl.debug_rtti) rtl.debug('initRTTI');\r\n\r\n    // base types\r\n    rtl.tTypeInfo = { name: \"tTypeInfo\" };\r\n    function newBaseTI(name,kind,ancestor){\r\n      if (!ancestor) ancestor = rtl.tTypeInfo;\r\n      if (rtl.debug_rtti) rtl.debug('initRTTI.newBaseTI \"'+name+'\" '+kind+' (\"'+ancestor.name+'\")');\r\n      var t = Object.create(ancestor);\r\n      t.name = name;\r\n      t.kind = kind;\r\n      rtl[name] = t;\r\n      return t;\r\n    };\r\n    function newBaseInt(name,minvalue,maxvalue,ordtype){\r\n      var t = newBaseTI(name,1 /* tkInteger */,rtl.tTypeInfoInteger);\r\n      t.minvalue = minvalue;\r\n      t.maxvalue = maxvalue;\r\n      t.ordtype = ordtype;\r\n      return t;\r\n    };\r\n    newBaseTI(\"tTypeInfoInteger\",1 /* tkInteger */);\r\n    newBaseInt(\"shortint\",-0x80,0x7f,0);\r\n    newBaseInt(\"byte\",0,0xff,1);\r\n    newBaseInt(\"smallint\",-0x8000,0x7fff,2);\r\n    newBaseInt(\"word\",0,0xffff,3);\r\n    newBaseInt(\"longint\",-0x80000000,0x7fffffff,4);\r\n    newBaseInt(\"longword\",0,0xffffffff,5);\r\n    newBaseInt(\"nativeint\",-0x10000000000000,0xfffffffffffff,6);\r\n    newBaseInt(\"nativeuint\",0,0xfffffffffffff,7);\r\n    newBaseTI(\"char\",2 /* tkChar */);\r\n    newBaseTI(\"string\",3 /* tkString */);\r\n    newBaseTI(\"tTypeInfoEnum\",4 /* tkEnumeration */,rtl.tTypeInfoInteger);\r\n    newBaseTI(\"tTypeInfoSet\",5 /* tkSet */);\r\n    newBaseTI(\"double\",6 /* tkDouble */);\r\n    newBaseTI(\"boolean\",7 /* tkBool */);\r\n    newBaseTI(\"tTypeInfoProcVar\",8 /* tkProcVar */);\r\n    newBaseTI(\"tTypeInfoMethodVar\",9 /* tkMethod */,rtl.tTypeInfoProcVar);\r\n    newBaseTI(\"tTypeInfoArray\",10 /* tkArray */);\r\n    newBaseTI(\"tTypeInfoDynArray\",11 /* tkDynArray */);\r\n    newBaseTI(\"tTypeInfoPointer\",15 /* tkPointer */);\r\n    var t = newBaseTI(\"pointer\",15 /* tkPointer */,rtl.tTypeInfoPointer);\r\n    t.reftype = null;\r\n    newBaseTI(\"jsvalue\",16 /* tkJSValue */);\r\n    newBaseTI(\"tTypeInfoRefToProcVar\",17 /* tkRefToProcVar */,rtl.tTypeInfoProcVar);\r\n\r\n    // member kinds\r\n    rtl.tTypeMember = {};\r\n    function newMember(name,kind){\r\n      var m = Object.create(rtl.tTypeMember);\r\n      m.name = name;\r\n      m.kind = kind;\r\n      rtl[name] = m;\r\n    };\r\n    newMember(\"tTypeMemberField\",1); // tmkField\r\n    newMember(\"tTypeMemberMethod\",2); // tmkMethod\r\n    newMember(\"tTypeMemberProperty\",3); // tmkProperty\r\n\r\n    // base object for storing members: a simple object\r\n    rtl.tTypeMembers = {};\r\n\r\n    // tTypeInfoStruct - base object for tTypeInfoClass, tTypeInfoRecord, tTypeInfoInterface\r\n    var tis = newBaseTI(\"tTypeInfoStruct\",0);\r\n    tis.$addMember = function(name,ancestor,options){\r\n      if (rtl.debug_rtti){\r\n        if (!rtl.hasString(name) || (name.charAt()==='$')) throw 'invalid member \"'+name+'\", this=\"'+this.name+'\"';\r\n        if (!rtl.is(ancestor,rtl.tTypeMember)) throw 'invalid ancestor \"'+ancestor+':'+ancestor.name+'\", \"'+this.name+'.'+name+'\"';\r\n        if ((options!=undefined) && (typeof(options)!='object')) throw 'invalid options \"'+options+'\", \"'+this.name+'.'+name+'\"';\r\n      };\r\n      var t = Object.create(ancestor);\r\n      t.name = name;\r\n      this.members[name] = t;\r\n      this.names.push(name);\r\n      if (rtl.isObject(options)){\r\n        for (var key in options) if (options.hasOwnProperty(key)) t[key] = options[key];\r\n      };\r\n      return t;\r\n    };\r\n    tis.addField = function(name,type,options){\r\n      var t = this.$addMember(name,rtl.tTypeMemberField,options);\r\n      if (rtl.debug_rtti){\r\n        if (!rtl.is(type,rtl.tTypeInfo)) throw 'invalid type \"'+type+'\", \"'+this.name+'.'+name+'\"';\r\n      };\r\n      t.typeinfo = type;\r\n      this.fields.push(name);\r\n      return t;\r\n    };\r\n    tis.addFields = function(){\r\n      var i=0;\r\n      while(i<arguments.length){\r\n        var name = arguments[i++];\r\n        var type = arguments[i++];\r\n        if ((i<arguments.length) && (typeof(arguments[i])==='object')){\r\n          this.addField(name,type,arguments[i++]);\r\n        } else {\r\n          this.addField(name,type);\r\n        };\r\n      };\r\n    };\r\n    tis.addMethod = function(name,methodkind,params,result,options){\r\n      var t = this.$addMember(name,rtl.tTypeMemberMethod,options);\r\n      t.methodkind = methodkind;\r\n      t.procsig = rtl.newTIProcSig(params);\r\n      t.procsig.resulttype = result?result:null;\r\n      this.methods.push(name);\r\n      return t;\r\n    };\r\n    tis.addProperty = function(name,flags,result,getter,setter,options){\r\n      var t = this.$addMember(name,rtl.tTypeMemberProperty,options);\r\n      t.flags = flags;\r\n      t.typeinfo = result;\r\n      t.getter = getter;\r\n      t.setter = setter;\r\n      // Note: in options: params, stored, defaultvalue\r\n      if (rtl.isArray(t.params)) t.params = rtl.newTIParams(t.params);\r\n      this.properties.push(name);\r\n      if (!rtl.isString(t.stored)) t.stored = \"\";\r\n      return t;\r\n    };\r\n    tis.getField = function(index){\r\n      return this.members[this.fields[index]];\r\n    };\r\n    tis.getMethod = function(index){\r\n      return this.members[this.methods[index]];\r\n    };\r\n    tis.getProperty = function(index){\r\n      return this.members[this.properties[index]];\r\n    };\r\n\r\n    newBaseTI(\"tTypeInfoRecord\",12 /* tkRecord */,rtl.tTypeInfoStruct);\r\n    newBaseTI(\"tTypeInfoClass\",13 /* tkClass */,rtl.tTypeInfoStruct);\r\n    newBaseTI(\"tTypeInfoClassRef\",14 /* tkClassRef */);\r\n    newBaseTI(\"tTypeInfoInterface\",18 /* tkInterface */,rtl.tTypeInfoStruct);\r\n    newBaseTI(\"tTypeInfoHelper\",19 /* tkHelper */,rtl.tTypeInfoStruct);\r\n  },\r\n\r\n  tSectionRTTI: {\r\n    $module: null,\r\n    $inherited: function(name,ancestor,o){\r\n      if (rtl.debug_rtti){\r\n        rtl.debug('tSectionRTTI.newTI \"'+(this.$module?this.$module.$name:\"(no module)\")\r\n          +'\".\"'+name+'\" ('+ancestor.name+') '+(o?'init':'forward'));\r\n      };\r\n      var t = this[name];\r\n      if (t){\r\n        if (!t.$forward) throw 'duplicate type \"'+name+'\"';\r\n        if (!ancestor.isPrototypeOf(t)) throw 'typeinfo ancestor mismatch \"'+name+'\" ancestor=\"'+ancestor.name+'\" t.name=\"'+t.name+'\"';\r\n      } else {\r\n        t = Object.create(ancestor);\r\n        t.name = name;\r\n        t.$module = this.$module;\r\n        this[name] = t;\r\n      }\r\n      if (o){\r\n        delete t.$forward;\r\n        for (var key in o) if (o.hasOwnProperty(key)) t[key]=o[key];\r\n      } else {\r\n        t.$forward = true;\r\n      }\r\n      return t;\r\n    },\r\n    $Scope: function(name,ancestor,o){\r\n      var t=this.$inherited(name,ancestor,o);\r\n      t.members = {};\r\n      t.names = [];\r\n      t.fields = [];\r\n      t.methods = [];\r\n      t.properties = [];\r\n      return t;\r\n    },\r\n    $TI: function(name,kind,o){ var t=this.$inherited(name,rtl.tTypeInfo,o); t.kind = kind; return t; },\r\n    $Int: function(name,o){ return this.$inherited(name,rtl.tTypeInfoInteger,o); },\r\n    $Enum: function(name,o){ return this.$inherited(name,rtl.tTypeInfoEnum,o); },\r\n    $Set: function(name,o){ return this.$inherited(name,rtl.tTypeInfoSet,o); },\r\n    $StaticArray: function(name,o){ return this.$inherited(name,rtl.tTypeInfoArray,o); },\r\n    $DynArray: function(name,o){ return this.$inherited(name,rtl.tTypeInfoDynArray,o); },\r\n    $ProcVar: function(name,o){ return this.$inherited(name,rtl.tTypeInfoProcVar,o); },\r\n    $RefToProcVar: function(name,o){ return this.$inherited(name,rtl.tTypeInfoRefToProcVar,o); },\r\n    $MethodVar: function(name,o){ return this.$inherited(name,rtl.tTypeInfoMethodVar,o); },\r\n    $Record: function(name,o){ return this.$Scope(name,rtl.tTypeInfoRecord,o); },\r\n    $Class: function(name,o){ return this.$Scope(name,rtl.tTypeInfoClass,o); },\r\n    $ClassRef: function(name,o){ return this.$inherited(name,rtl.tTypeInfoClassRef,o); },\r\n    $Pointer: function(name,o){ return this.$inherited(name,rtl.tTypeInfoPointer,o); },\r\n    $Interface: function(name,o){ return this.$Scope(name,rtl.tTypeInfoInterface,o); },\r\n    $Helper: function(name,o){ return this.$Scope(name,rtl.tTypeInfoHelper,o); }\r\n  },\r\n\r\n  newTIParam: function(param){\r\n    // param is an array, 0=name, 1=type, 2=optional flags\r\n    var t = {\r\n      name: param[0],\r\n      typeinfo: param[1],\r\n      flags: (rtl.isNumber(param[2]) ? param[2] : 0)\r\n    };\r\n    return t;\r\n  },\r\n\r\n  newTIParams: function(list){\r\n    // list: optional array of [paramname,typeinfo,optional flags]\r\n    var params = [];\r\n    if (rtl.isArray(list)){\r\n      for (var i=0; i<list.length; i++) params.push(rtl.newTIParam(list[i]));\r\n    };\r\n    return params;\r\n  },\r\n\r\n  newTIProcSig: function(params,result,flags){\r\n    var s = {\r\n      params: rtl.newTIParams(params),\r\n      resulttype: result,\r\n      flags: flags\r\n    };\r\n    return s;\r\n  }\r\n}\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2018 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit System;\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\n{$IFDEF NodeJS}\r\nvar\r\n  LineEnding: string = #10;\r\n  sLineBreak: string = #10;\r\n{$ELSE}\r\nconst\r\n  LineEnding = #10;\r\n  sLineBreak = LineEnding;\r\n{$ENDIF}\r\n\r\nVar\r\n  PathDelim : Char = '/';\r\n  AllowDirectorySeparators : Set of Char = ['/'];\r\n  AllowDriveSeparators : Set of Char = [':'];\r\n  ExtensionSeparator : Char = '.';\r\n\r\nconst\r\n  MaxSmallint = 32767;\r\n  MinSmallint = -32768;\r\n  MaxShortInt = 127;\r\n  MinShortInt = -128;\r\n  MaxByte = $FF;\r\n  MaxWord = $FFFF;\r\n  MaxLongint  = $7fffffff;\r\n  MaxCardinal = LongWord($ffffffff);\r\n\r\n  Maxint = MaxLongint;\r\n  IsMultiThread = false;\r\n\r\n{*****************************************************************************\r\n                               Base types\r\n*****************************************************************************}\r\ntype\r\n  Int8 = ShortInt;\r\n  UInt8 = Byte;\r\n  Int16 = SmallInt;\r\n  UInt16 = Word;\r\n  Int32 = Longint;\r\n  UInt32 = LongWord;\r\n\r\n  Integer = LongInt;\r\n  Cardinal = LongWord;\r\n  DWord = LongWord;\r\n  SizeInt = NativeInt;\r\n  SizeUInt = NativeUInt;\r\n  PtrInt = NativeInt;\r\n  PtrUInt = NativeUInt;\r\n  ValSInt = NativeInt;\r\n  ValUInt = NativeUInt;\r\n  CodePointer = Pointer;\r\n  ValReal = Double;\r\n  Real = type Double;\r\n  Extended = type Double;\r\n\r\n  TDateTime = type double;\r\n  TTime = type TDateTime;\r\n  TDate = type TDateTime;\r\n\r\n\r\n  Int64 = type NativeInt unimplemented; // only 53 bits at runtime\r\n  UInt64 = type NativeUInt unimplemented; // only 52 bits at runtime\r\n  QWord = type NativeUInt unimplemented; // only 52 bits at runtime\r\n  Single = type Double unimplemented;\r\n  Comp = type NativeInt unimplemented;\r\n  NativeLargeInt = NativeInt;\r\n  NativeLargeUInt = NativeUInt;\r\n\r\n  UnicodeString = type String;\r\n  WideString = type String;\r\n  WideChar = char;\r\n  UnicodeChar = char;\r\n\r\n  TDynArrayIndex = NativeInt;\r\n  TTextLineBreakStyle = (tlbsLF,tlbsCRLF,tlbsCR);\r\n\r\n{*****************************************************************************\r\n            TObject, TClass, IUnknown, IInterface, TInterfacedObject\r\n*****************************************************************************}\r\ntype\r\n  TGuid = record\r\n    D1: DWord;\r\n    D2: word;\r\n    D3: word;\r\n    D4: array[0..7] of byte;\r\n  end;\r\n  TGUIDString = type string;\r\n\r\n  PMethod = ^TMethod;\r\n  TMethod = record\r\n    Code : CodePointer;\r\n    Data : Pointer;\r\n  end;\r\n\r\n  TClass = class of TObject;\r\n\r\n  { TObject }\r\n\r\n  {$DispatchField Msg} // enable checking message methods for record field name \"Msg\"\r\n  {$DispatchStrField MsgStr}\r\n  TObject = class\r\n  private\r\n    class var FClassName: String; external name '$classname';\r\n    class var FClassParent: TClass; external name '$ancestor';\r\n    class var FUnitName: String; external name '$module.$name';\r\n  public\r\n    constructor Create;\r\n    destructor Destroy; virtual;\r\n\r\n    // Free is using compiler magic.\r\n    // Reasons:\r\n    // 1. In JS calling obj.Free when obj=nil would crash.\r\n    // 2. In JS freeing memory requires to set all references to nil.\r\n    // Therefore any obj.free call is replaced by the compiler with some rtl magic.\r\n    procedure Free;\r\n\r\n    class function ClassType: TClass; assembler;\r\n    class property ClassName: String read FClassName;\r\n    class function ClassNameIs(const Name: string): boolean;\r\n    class property ClassParent: TClass read FClassParent;\r\n    class function InheritsFrom(aClass: TClass): boolean; assembler;\r\n    class property UnitName: String read FUnitName;\r\n    Class function MethodName(aCode : Pointer) : String;\r\n    Class function MethodAddress(aName : String) : Pointer;\r\n    Class Function FieldAddress(aName : String) : Pointer;\r\n    Class Function ClassInfo : Pointer;\r\n\r\n    procedure AfterConstruction; virtual;\r\n    procedure BeforeDestruction; virtual;\r\n\r\n    // message handling routines\r\n    procedure Dispatch(var aMessage); virtual;\r\n    procedure DispatchStr(var aMessage); virtual;\r\n    procedure DefaultHandler(var aMessage); virtual;\r\n    procedure DefaultHandlerStr(var aMessage); virtual;\r\n\r\n    function GetInterface(const iid: TGuid; out obj): boolean;\r\n    function GetInterface(const iidstr: String; out obj): boolean; inline;\r\n    function GetInterfaceByStr(const iidstr: String; out obj): boolean;\r\n    function GetInterfaceWeak(const iid: TGuid; out obj): boolean; // equal to GetInterface but the interface returned is not referenced\r\n\r\n    function Equals(Obj: TObject): boolean; virtual;\r\n    function ToString: String; virtual;\r\n  end;\r\n\r\n  { TCustomAttribute - base class of all user defined attributes. }\r\n\r\n  TCustomAttribute = class\r\n  end;\r\n  TCustomAttributeArray = array of TCustomAttribute;\r\n\r\nconst\r\n  { IInterface }\r\n  S_OK          = 0;\r\n  S_FALSE       = 1;\r\n  E_NOINTERFACE = -2147467262; // FPC: longint($80004002)\r\n  E_UNEXPECTED  = -2147418113; // FPC: longint($8000FFFF)\r\n  E_NOTIMPL     = -2147467263; // FPC: longint($80004001)\r\n\r\ntype\r\n  {$Interfaces COM}\r\n  IUnknown = interface\r\n    ['{00000000-0000-0000-C000-000000000046}']\r\n    function QueryInterface(const iid: TGuid; out obj): Integer;\r\n    function _AddRef: Integer;\r\n    function _Release: Integer;\r\n  end;\r\n  IInterface = IUnknown;\r\n\r\n  {$M+}\r\n  IInvokable = interface(IInterface)\r\n  end;\r\n  {$M-}\r\n\r\n  { Enumerator support }\r\n  IEnumerator = interface(IInterface)\r\n    function GetCurrent: TObject;\r\n    function MoveNext: Boolean;\r\n    procedure Reset;\r\n    property Current: TObject read GetCurrent;\r\n  end;\r\n\r\n  IEnumerable = interface(IInterface)\r\n    function GetEnumerator: IEnumerator;\r\n  end;\r\n\r\n  { TInterfacedObject }\r\n\r\n  TInterfacedObject = class(TObject,IUnknown)\r\n  protected\r\n    fRefCount: Integer;\r\n    { implement methods of IUnknown }\r\n    function QueryInterface(const iid: TGuid; out obj): Integer; virtual;\r\n    function _AddRef: Integer; virtual;\r\n    function _Release: Integer; virtual;\r\n  public\r\n    procedure BeforeDestruction; override;\r\n    property RefCount: Integer read fRefCount;\r\n  end;\r\n  TInterfacedClass = class of TInterfacedObject;\r\n\r\n  { TAggregatedObject - sub or satellite object using same interface as controller }\r\n\r\n  TAggregatedObject = class(TObject)\r\n  private\r\n    fController: Pointer;\r\n    function GetController: IUnknown;\r\n  protected\r\n    { implement methods of IUnknown }\r\n    function QueryInterface(const iid: TGuid; out obj): Integer; virtual;\r\n    function _AddRef: Integer; virtual;\r\n    function _Release: Integer; virtual;\r\n  public\r\n    constructor Create(const aController: IUnknown); reintroduce;\r\n    property Controller: IUnknown read GetController;\r\n  end;\r\n\r\n  { TContainedObject }\r\n\r\n  TContainedObject = class(TAggregatedObject,IInterface)\r\n  protected\r\n    function QueryInterface(const iid: TGuid; out obj): Integer; override;\r\n  end;\r\n\r\nconst\r\n  { for safe as operator support }\r\n  IObjectInstance: TGuid = '{D91C9AF4-3C93-420F-A303-BF5BA82BFD23}';\r\n\r\nfunction GUIDToString(const GUID: TGUID): string; external name 'rtl.guidrToStr';\r\n\r\n{*****************************************************************************\r\n                              Array of const support\r\n*****************************************************************************}\r\n\r\nconst\r\n  vtInteger       = 0;\r\n  vtBoolean       = 1;\r\n  //vtChar          = 2; // Delphi/FPC: ansichar\r\n  vtExtended      = 3; // Note: double in pas2js, PExtended in Delphi/FPC\r\n  //vtString        = 4; // Delphi/FPC: PShortString\r\n  vtPointer       = 5;\r\n  //vtPChar         = 6;\r\n  vtObject        = 7;\r\n  vtClass         = 8;\r\n  vtWideChar      = 9;\r\n  //vtPWideChar     = 10;\r\n  //vtAnsiString    = 11;\r\n  vtCurrency      = 12; // Note: currency in pas2js, PCurrency in Delphi/FPC\r\n  //vtVariant       = 13;\r\n  vtInterface     = 14;\r\n  //vtWideString    = 15;\r\n  //vtInt64         = 16;\r\n  //vtQWord         = 17;\r\n  vtUnicodeString = 18;\r\n  // only pas2js, not in Delphi/FPC:\r\n  vtNativeInt     = 19;\r\n  vtJSValue       = 20;\r\n\r\ntype\r\n  PVarRec = ^TVarRec;\r\n  TVarRec = record\r\n    VType: byte;\r\n    VJSValue: JSValue;\r\n    VInteger: LongInt external name 'VJSValue';\r\n    VBoolean: Boolean external name 'VJSValue';\r\n    VExtended: Double external name 'VJSValue';\r\n    VPointer: Pointer external name 'VJSValue';\r\n    VObject: TObject external name 'VJSValue';\r\n    VClass: TClass external name 'VJSValue';\r\n    VWideChar: WideChar external name 'VJSValue';\r\n    VCurrency: Currency external name 'VJSValue';\r\n    VInterface: Pointer external name 'VJSValue';\r\n    VUnicodeString: UnicodeString external name 'VJSValue';\r\n    VNativeInt: NativeInt external name 'VJSValue';\r\n  end;\r\n  TVarRecArray = array of TVarRec;\r\n\r\nfunction VarRecs: TVarRecArray; varargs;\r\n\r\n{*****************************************************************************\r\n                            Init / Exit / ExitProc\r\n*****************************************************************************}\r\nvar\r\n  ExitCode: Integer; external name 'rtl.exitcode';\r\n  IsConsole: Boolean = {$IFDEF NodeJS}true{$ELSE}false{$ENDIF};\r\n  FirstDotAtFileNameStartIsExtension : Boolean = False;\r\n\r\ntype\r\n  TOnParamCount = function: Longint;\r\n  TOnParamStr = function(Index: Longint): String;\r\nvar\r\n  OnParamCount: TOnParamCount;\r\n  OnParamStr: TOnParamStr;\r\n\r\nfunction ParamCount: Longint;\r\nfunction ParamStr(Index: Longint): String;\r\n\r\n{*****************************************************************************\r\n                                 Math\r\n*****************************************************************************}\r\nconst\r\n  PI: Double; external name 'Math.PI';\r\n  MathE: Double; external name 'Math.E'; // Euler's number\r\n  MathLN10: Double; external name 'Math.LN10'; // ln(10)\r\n  MathLN2: Double; external name 'Math.LN2'; // ln(2)\r\n  MathLog10E: Double; external name 'Math.Log10E'; // log10(e)\r\n  MathLog2E: Double; external name 'Math.LOG2E'; // log2(e)\r\n  MathSQRT1_2: Double; external name 'Math.SQRT1_2'; // sqrt(0.5)\r\n  MathSQRT2: Double; external name 'Math.SQRT2'; // sqrt(2)\r\n\r\nfunction Abs(const A: integer): integer; overload; external name 'Math.abs';\r\nfunction Abs(const A: NativeInt): integer; overload; external name 'Math.abs';\r\nfunction Abs(const A: Double): Double; overload; external name 'Math.abs';\r\nfunction ArcTan(const A: Double): Double; external name 'Math.atan';\r\nfunction ArcTan2(const A,B: Double): Double; external name 'Math.atan2';\r\nfunction Cos(const A: Double): Double; external name 'Math.cos';\r\nfunction Exp(const A: Double): Double; external name 'Math.exp';\r\nfunction Frac(const A: Double): Double; assembler;\r\nfunction Ln(const A: Double): Double; external name 'Math.log';\r\nfunction Odd(const A: Integer): Boolean; assembler;\r\nfunction Random(const Range: Integer): Integer; overload; assembler;\r\nfunction Random: Double; overload; external name 'Math.random';\r\nfunction Round(const A: Double): NativeInt; external name 'Math.round';\r\nfunction Sin(const A: Double): Double; external name 'Math.sin';\r\nfunction Sqr(const A: Integer): Integer; assembler; overload;\r\nfunction Sqr(const A: Double): Double; assembler; overload;\r\nfunction sqrt(const A: Double): Double; external name 'Math.sqrt';\r\nfunction Trunc(const A: Double): NativeInt;\r\n\r\n{*****************************************************************************\r\n                          String functions\r\n*****************************************************************************}\r\nconst\r\n  DefaultTextLineBreakStyle : TTextLineBreakStyle = tlbsLF;\r\n\r\nfunction Int(const A: Double): double;\r\nfunction Copy(const S: string; Index, Size: Integer): String; assembler; overload;\r\nfunction Copy(const S: string; Index: Integer): String; assembler; overload;\r\nprocedure Delete(var S: String; Index, Size: Integer); assembler; overload;\r\nfunction Pos(const Search, InString: String): Integer; assembler; overload;\r\nfunction Pos(const Search, InString: String; StartAt : Integer): Integer; assembler; overload;\r\nprocedure Insert(const Insertion: String; var Target: String; Index: Integer); overload;\r\nfunction upcase(c : char) : char; assembler;\r\nfunction HexStr(Val: NativeInt; cnt: byte): string; external name 'rtl.hexStr'; overload;\r\n\r\nprocedure val(const S: String; out NI : NativeInt; out Code: Integer); overload;\r\nprocedure val(const S: String; out NI : NativeUInt; out Code: Integer); overload;\r\nprocedure val(const S: String; out SI : ShortInt; out Code: Integer); overload;\r\nprocedure val(const S: String; out B : Byte; out Code: Integer); overload;\r\nprocedure val(const S: String; out SI : smallint; out Code: Integer); overload;\r\nprocedure val(const S: String; out W : word; out Code : Integer); overload;\r\nprocedure val(const S: String; out I : integer; out Code : Integer); overload;\r\nprocedure val(const S: String; out C : Cardinal; out Code: Integer); overload;\r\nprocedure val(const S: String; out d : double; out Code : Integer); overload;\r\nprocedure val(const S: String; out b : boolean; out Code: Integer); overload;\r\nfunction StringOfChar(c: Char; l: NativeInt): String;\r\n\r\n{*****************************************************************************\r\n                          Other functions\r\n*****************************************************************************}\r\nprocedure Write; varargs; // ToDo: should be compiler built-in function\r\nprocedure Writeln; varargs; // ToDo: should be compiler built-in function\r\n\r\nType\r\n  TConsoleHandler = Procedure (S : JSValue; NewLine : Boolean);\r\nFunction SetWriteCallBack(H : TConsoleHandler) : TConsoleHandler;\r\n\r\nfunction Assigned(const V: JSValue): boolean; assembler; overload;\r\nfunction StrictEqual(const A: JSValue; const B): boolean; assembler;\r\nfunction StrictInequal(const A: JSValue; const B): boolean; assembler;\r\n\r\nimplementation\r\n\r\ntype\r\n\r\n  { TJSObj - simple access to JS Object }\r\n\r\n  TJSObj = class external name 'Object'\r\n  private\r\n    function GetProperties(Name: String): JSValue; external name '[]';\r\n    procedure SetProperties(Name: String; const AValue: JSValue); external name '[]';\r\n  public\r\n    //constructor new;\r\n    //function hasOwnProperty(prop: String): boolean;\r\n    property Properties[Name: String]: JSValue read GetProperties write SetProperties; default;\r\n  end;\r\n\r\n  TJSArray = class external name 'Array'\r\n  public\r\n    //length: nativeint;\r\n    //constructor new; overload;\r\n    function push(aElement : JSValue) : NativeInt; varargs;\r\n  end;\r\n\r\n  TJSArguments = class external name 'arguments'\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n    function GetElements(Index: NativeInt): JSValue; external name '[]';\r\n  public\r\n    property Length: NativeInt read FLength;\r\n    property Elements[Index: NativeInt]: JSValue read GetElements; default;\r\n  end;\r\nvar\r\n  JSArguments: TJSArguments; external name 'arguments';\r\n\r\nfunction isNumber(const v: JSValue): boolean; external name 'rtl.isNumber';\r\nfunction isObject(const v: JSValue): boolean; external name 'rtl.isObject'; // true if not null and a JS Object\r\nfunction isString(const v: JSValue): boolean; external name 'rtl.isString';\r\nfunction isNaN(i: JSValue): boolean; external name 'isNaN'; // may result NaN\r\n\r\n// needed by ClassNameIs, the real SameText is in SysUtils\r\nfunction SameText(const s1, s2: String): Boolean; assembler;\r\nasm\r\n  return s1.toLowerCase() == s2.toLowerCase();\r\nend;\r\n\r\nfunction VarRecs: TVarRecArray;\r\nvar\r\n  i: nativeint;\r\n  v: PVarRec;\r\nbegin\r\n  Result:=nil;\r\n  while i<JSArguments.Length do\r\n    begin\r\n    new(v);\r\n    v^.VType:=byte(JSArguments[i]);\r\n    inc(i);\r\n    v^.VJSValue:=JSArguments[i];\r\n    inc(i);\r\n    TJSArray(Result).push(v^);\r\n    end;\r\nend;\r\n\r\nfunction ParamCount: Longint;\r\nbegin\r\n  if Assigned(OnParamCount) then\r\n    Result:=OnParamCount()\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nfunction ParamStr(Index: Longint): String;\r\nbegin\r\n  if Assigned(OnParamStr) then\r\n    Result:=OnParamStr(Index)\r\n  else if Index=0 then\r\n    Result:='js'\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nfunction Frac(const A: Double): Double; assembler;\r\nasm\r\n  return A % 1;\r\nend;\r\n\r\nfunction Odd(const A: Integer): Boolean; assembler;\r\nasm\r\n  return A&1 != 0;\r\nend;\r\n\r\nfunction Random(const Range: Integer): Integer; assembler;\r\nasm\r\n  return Math.floor(Math.random()*Range);\r\nend;\r\n\r\nfunction Sqr(const A: Integer): Integer; assembler;\r\nasm\r\n  return A*A;\r\nend;\r\n\r\nfunction Sqr(const A: Double): Double; assembler;\r\nasm\r\n  return A*A;\r\nend;\r\n\r\nfunction Trunc(const A: Double): NativeInt; assembler;\r\nasm\r\n  if (!Math.trunc) {\r\n    Math.trunc = function(v) {\r\n      v = +v;\r\n      if (!isFinite(v)) return v;\r\n      return (v - v % 1) || (v < 0 ? -0 : v === 0 ? v : 0);\r\n    };\r\n  }\r\n  $mod.Trunc = Math.trunc;\r\n  return Math.trunc(A);\r\nend;\r\n\r\nfunction Copy(const S: string; Index, Size: Integer): String; assembler;\r\nasm\r\n  if (Index<1) Index = 1;\r\n  return (Size>0) ? S.substring(Index-1,Index+Size-1) : \"\";\r\nend;\r\n\r\nfunction Copy(const S: string; Index: Integer): String; assembler;\r\nasm\r\n  if (Index<1) Index = 1;\r\n  return S.substr(Index-1);\r\nend;\r\n\r\nprocedure Delete(var S: String; Index, Size: Integer);\r\nvar\r\n  h: String;\r\nbegin\r\n  if (Index<1) or (Index>length(S)) or (Size<=0) then exit;\r\n  h:=S;\r\n  S:=copy(h,1,Index-1)+copy(h,Index+Size);\r\nend;\r\n\r\nfunction Pos(const Search, InString: String): Integer; assembler;\r\nasm\r\n  return InString.indexOf(Search)+1;\r\nend;\r\n\r\nfunction Pos(const Search, InString: String; StartAt : Integer): Integer; assembler; overload;\r\nasm\r\n  return InString.indexOf(Search,StartAt-1)+1;\r\nend;\r\n\r\nprocedure Insert(const Insertion: String; var Target: String; Index: Integer);\r\nvar\r\n  t: String;\r\nbegin\r\n  if Insertion='' then exit;\r\n  t:=Target;\r\n  if Index<1 then\r\n    Target:=Insertion+t\r\n  else if Index>length(t) then\r\n    Target:=t+Insertion\r\n  else\r\n    Target:=copy(t,1,Index-1)+Insertion+copy(t,Index,length(t));\r\nend;\r\n\r\nvar\r\n  WriteBuf: String;\r\n  WriteCallBack : TConsoleHandler;\r\n\r\nFunction SetWriteCallBack(H : TConsoleHandler) : TConsoleHandler;\r\n\r\nbegin\r\n  Result:=WriteCallBack;\r\n  WriteCallBack:=H;\r\nend;\r\n\r\nprocedure Write;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  for i:=0 to JSArguments.Length-1 do\r\n    if Assigned(WriteCallBack) then\r\n      WriteCallBack(JSArguments[i],False)\r\n    else\r\n      WriteBuf:=WriteBuf+String(JSArguments[i]);\r\nend;\r\n\r\nprocedure Writeln;\r\n\r\nvar\r\n  i,l: Integer;\r\n  s: String;\r\n\r\nbegin\r\n  L:=JSArguments.Length-1;\r\n  if Assigned(WriteCallBack) then\r\n    begin\r\n    for i:=0 to L do\r\n      WriteCallBack(JSArguments[i],I=L);\r\n    end\r\n  else\r\n    begin\r\n    s:=WriteBuf;\r\n    for i:=0 to L do\r\n      s:=s+String(JSArguments[i]);\r\n    asm\r\n      console.log(s);\r\n    end;\r\n    WriteBuf:='';\r\n    end;\r\nend;\r\n\r\nfunction Int(const A: Double): double;\r\n\r\nbegin\r\n  // trunc contains fix for missing Math.trunc in IE\r\n  Result:=Trunc(A);\r\nend;\r\n\r\nfunction Number(S: String): Double; external name 'Number';\r\n\r\nfunction valint(const S: String; MinVal, MaxVal: NativeInt; out Code: Integer): NativeInt;\r\nvar\r\n  x: double;\r\nbegin\r\n  x:=Number(S);\r\n  if isNaN(x) then\r\n    case copy(s,1,1) of\r\n    '$': x:=Number('0x'+copy(S,2));\r\n    '&': x:=Number('0o'+copy(S,2));\r\n    '%': x:=Number('0b'+copy(S,2));\r\n    else\r\n      Code:=1;\r\n      exit;\r\n    end;\r\n  if isNaN(x) or (X<>Int(X)) then\r\n    Code:=1\r\n  else if (x<MinVal) or (x>MaxVal) then\r\n    Code:=2\r\n  else\r\n    begin\r\n    Result:=Trunc(x);\r\n    Code:=0;\r\n    end;\r\nend;\r\n\r\nprocedure val(const S: String; out NI : NativeInt; out Code: Integer);\r\nbegin\r\n  NI:=valint(S,low(NI),high(NI),Code);\r\nend;\r\n\r\nprocedure val(const S: String; out NI: NativeUInt; out Code: Integer);\r\nvar\r\n  x : double;\r\nbegin\r\n  x:=Number(S);\r\n  if isNaN(x) or (X<>Int(X)) or (X<0) then\r\n    Code:=1\r\n  else\r\n    begin\r\n    Code:=0;\r\n    NI:=Trunc(x);\r\n    end;\r\nend;\r\n\r\nprocedure val(const S: String; out SI : ShortInt; out Code: Integer);\r\nbegin\r\n  SI:=valint(S,low(SI),high(SI),Code);\r\nend;\r\n\r\nprocedure val(const S: String; out SI: smallint; out Code: Integer);\r\nbegin\r\n  SI:=valint(S,low(SI),high(SI),Code);\r\nend;\r\n\r\nprocedure val(const S: String; out C: Cardinal; out Code: Integer);\r\nbegin\r\n  C:=valint(S,low(C),high(C),Code);\r\nend;\r\n\r\nprocedure val(const S: String; out B: Byte; out Code: Integer);\r\nbegin\r\n  B:=valint(S,low(B),high(B),Code);\r\nend;\r\n\r\nprocedure val(const S: String; out W: word; out Code: Integer);\r\nbegin\r\n  W:=valint(S,low(W),high(W),Code);\r\nend;\r\n\r\nprocedure val(const S : String; out I : integer; out Code : Integer);\r\nbegin\r\n  I:=valint(S,low(I),high(I),Code);\r\nend;\r\n\r\nprocedure val(const S : String; out d : double; out Code : Integer);\r\nVar\r\n  x: double;\r\nbegin\r\n  x:=Number(S);\r\n  if isNaN(x) then\r\n    Code:=1\r\n  else\r\n    begin\r\n    Code:=0;\r\n    d:=x;\r\n    end;\r\nend;\r\n\r\nprocedure val(const S: String; out b: boolean; out Code: Integer);\r\nbegin\r\n  if SameText(S,'true') then\r\n    begin\r\n    Code:=0;\r\n    b:=true;\r\n    end\r\n  else if SameText(S,'false') then\r\n    begin\r\n    Code:=0;\r\n    b:=false;\r\n    end\r\n  else\r\n    Code:=1;\r\nend;\r\n\r\nfunction upcase(c : char) : char; assembler;\r\nasm\r\n  return c.toUpperCase();\r\nend;\r\n\r\nfunction StringOfChar(c: Char; l: NativeInt): String;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  asm\r\n    if ((l>0) && c.repeat) return c.repeat(l);\r\n  end;\r\n  Result:='';\r\n  for i:=1 to l do Result:=Result+c;\r\nend;\r\n\r\nfunction Assigned(const V: JSValue): boolean; assembler;\r\nasm\r\n  return (V!=undefined) && (V!=null) && (!rtl.isArray(V) || (V.length > 0));\r\nend;\r\n\r\nfunction StrictEqual(const A: JSValue; const B): boolean; assembler;\r\nasm\r\n  return A === B;\r\nend;\r\n\r\nfunction StrictInequal(const A: JSValue; const B): boolean; assembler;\r\nasm\r\n  return A !== B;\r\nend;\r\n\r\n{ TContainedObject }\r\n\r\nfunction TContainedObject.QueryInterface(const iid: TGuid; out obj): Integer;\r\nbegin\r\n  if GetInterface(iid,obj) then\r\n    Result:=S_OK\r\n  else\r\n    Result:=Integer(E_NOINTERFACE);\r\nend;\r\n\r\n{ TAggregatedObject }\r\n\r\nfunction TAggregatedObject.GetController: IUnknown;\r\nbegin\r\n  Result := IUnknown(fController);\r\nend;\r\n\r\nfunction TAggregatedObject.QueryInterface(const iid: TGuid; out obj): Integer;\r\nbegin\r\n  Result := IUnknown(fController).QueryInterface(iid, obj);\r\nend;\r\n\r\nfunction TAggregatedObject._AddRef: Integer;\r\nbegin\r\n  Result := IUnknown(fController)._AddRef;\r\nend;\r\n\r\nfunction TAggregatedObject._Release: Integer;\r\nbegin\r\n  Result := IUnknown(fController)._Release;\r\nend;\r\n\r\nconstructor TAggregatedObject.Create(const aController: IUnknown);\r\nbegin\r\n  inherited Create;\r\n  { do not keep a counted reference to the controller! }\r\n  fController := Pointer(aController);\r\nend;\r\n\r\n{ TInterfacedObject }\r\n\r\nfunction TInterfacedObject.QueryInterface(const iid: TGuid; out obj): Integer;\r\nbegin\r\n  if GetInterface(iid,obj) then\r\n    Result:=S_OK\r\n  else\r\n    Result:=Integer(E_NOINTERFACE);\r\nend;\r\n\r\nfunction TInterfacedObject._AddRef: Integer;\r\nbegin\r\n  inc(fRefCount);\r\n  Result:=fRefCount;\r\nend;\r\n\r\nfunction TInterfacedObject._Release: Integer;\r\nbegin\r\n  dec(fRefCount);\r\n  Result:=fRefCount;\r\n  if fRefCount=0 then\r\n    Destroy;\r\nend;\r\n\r\nprocedure TInterfacedObject.BeforeDestruction;\r\nbegin\r\n  if fRefCount<>0 then\r\n    asm\r\n    rtl.raiseE('EHeapMemoryError');\r\n    end;\r\nend;\r\n\r\n{ TObject }\r\n\r\nconstructor TObject.Create;\r\nbegin\r\n\r\nend;\r\n\r\ndestructor TObject.Destroy;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TObject.Free;\r\nbegin\r\n  Destroy;\r\nend;\r\n\r\nclass function TObject.ClassType: TClass; assembler;\r\nasm\r\n  return this;\r\nend;\r\n\r\nclass function TObject.ClassNameIs(const Name: string): boolean;\r\nbegin\r\n  Result:=SameText(Name,ClassName);\r\nend;\r\n\r\nclass function TObject.InheritsFrom(aClass: TClass): boolean; assembler;\r\nasm\r\n  return (aClass!=null) && ((this==aClass) || aClass.isPrototypeOf(this));\r\nend;\r\n\r\n\r\nClass function TObject.MethodName(aCode : Pointer) : String;\r\n\r\nbegin\r\n  Result:='';\r\n  if aCode=Nil then\r\n    exit;\r\nasm\r\n  var i = 0;\r\n  var TI = this.$rtti;\r\n  // Callback ?\r\n  if ((typeof aCode[\"fn\"] === \"string\") && (typeof aCode[\"scope\"] === \"object\")) return aCode[\"fn\"];\r\n  // Not a callback, check rtti\r\n  while ((Result === \"\") && (TI != null)) {\r\n    i = 0;\r\n    while ((Result === \"\") && (i < TI.methods.length)) {\r\n      if (this[TI.getMethod(i).name] === aCode)\r\n        Result=TI.getMethod(i).name;\r\n      i += 1;\r\n    };\r\n    if (Result === \"\") TI = TI.ancestor;\r\n  };\r\n  return Result;\r\nend;\r\nend;\r\n\r\nClass function TObject.MethodAddress(aName : String) : Pointer;\r\n\r\n// We must do this in asm, because the typinfo unit is not available.\r\nbegin\r\n  Result:=Nil;\r\n  if AName='' then\r\n    exit;\r\nasm\r\n  var i = 0;\r\n  var TI = this.$rtti;\r\n  var N = \"\";\r\n  var MN = \"\";\r\n  N = aName.toLowerCase();\r\n  while ((MN === \"\") && (TI != null)) {\r\n    i = 0;\r\n    while ((MN === \"\") && (i < TI.methods.length)) {\r\n      if (TI.getMethod(i).name.toLowerCase() === N) MN = TI.getMethod(i).name;\r\n      i += 1;\r\n    };\r\n    if (MN === \"\") TI = TI.ancestor;\r\n  };\r\n  if (MN !== \"\") Result = this[MN];\r\n  return Result;\r\nend;\r\nend;\r\n\r\nclass function TObject.FieldAddress(aName: String): Pointer;\r\n\r\nbegin\r\n  Result:=Nil;\r\n  asm\r\n    var aClass = null;\r\n    var i = 0;\r\n    var ClassTI = null;\r\n    var myName = aName.toLowerCase();\r\n    var MemberTI = null;\r\n    aClass = this.$class;\r\n    while (aClass !== null) {\r\n      ClassTI = aClass.$rtti;\r\n      for (var $l1 = 0, $end2 = ClassTI.fields.length - 1; $l1 <= $end2; $l1++) {\r\n        i = $l1;\r\n        MemberTI = ClassTI.getField(i);\r\n        if (MemberTI.name.toLowerCase() === myName) {\r\n           return MemberTI;\r\n        };\r\n      };\r\n      aClass = aClass.$ancestor ? aClass.$ancestor : null;\r\n    };\r\n  end;\r\nend;\r\n\r\nClass Function TObject.ClassInfo : Pointer;\r\n\r\nbegin\r\n  // This works different from FPC/Delphi.\r\n  // We get the actual type info.\r\n  Result:=TypeInfo(Self);\r\nend;\r\n\r\nprocedure TObject.AfterConstruction;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TObject.BeforeDestruction;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TObject.Dispatch(var aMessage);\r\n// aMessage is a record with an integer field 'Msg'\r\nvar\r\n  aClass: TClass;\r\n  Msg: TJSObj absolute aMessage;\r\n  Id: jsvalue;\r\nbegin\r\n  if not isObject(Msg) then exit;\r\n  Id:=Msg['Msg'];\r\n  if not isNumber(Id) then exit;\r\n  aClass:=ClassType;\r\n  while aClass<>nil do\r\n    begin\r\n    asm\r\n      var Handlers = aClass.$msgint;\r\n      if (rtl.isObject(Handlers) && Handlers.hasOwnProperty(Id)){\r\n        this[Handlers[Id]](aMessage);\r\n        return;\r\n      }\r\n    end;\r\n    aClass:=aClass.ClassParent;\r\n    end;\r\n  DefaultHandler(aMessage);\r\nend;\r\n\r\nprocedure TObject.DispatchStr(var aMessage);\r\n// aMessage is a record with a string field 'MsgStr'\r\nvar\r\n  aClass: TClass;\r\n  Msg: TJSObj absolute aMessage;\r\n  Id: jsvalue;\r\nbegin\r\n  if not isObject(Msg) then exit;\r\n  Id:=Msg['MsgStr'];\r\n  if not isString(Id) then exit;\r\n  aClass:=ClassType;\r\n  while aClass<>nil do\r\n    begin\r\n    asm\r\n      var Handlers = aClass.$msgstr;\r\n      if (rtl.isObject(Handlers) && Handlers.hasOwnProperty(Id)){\r\n        this[Handlers[Id]](aMessage);\r\n        return;\r\n      }\r\n    end;\r\n    aClass:=aClass.ClassParent;\r\n    end;\r\n  DefaultHandlerStr(aMessage);\r\nend;\r\n\r\nprocedure TObject.DefaultHandler(var aMessage);\r\nbegin\r\n  if jsvalue(aMessage) then ;\r\nend;\r\n\r\nprocedure TObject.DefaultHandlerStr(var aMessage);\r\nbegin\r\n  if jsvalue(aMessage) then ;\r\nend;\r\n\r\nfunction TObject.GetInterface(const iid: TGuid; out obj): boolean;\r\nbegin\r\n  asm\r\n    var i = iid.$intf;\r\n    if (i){\r\n      // iid is the private TGuid of an interface\r\n      i = rtl.getIntfG(this,i.$guid,2);\r\n      if (i){\r\n        obj.set(i);\r\n        return true;\r\n      }\r\n    }\r\n  end;\r\n  Result := GetInterfaceByStr(GUIDToString(iid),obj);\r\nend;\r\n\r\nfunction TObject.GetInterface(const iidstr: String; out obj): boolean;\r\nbegin\r\n  Result := GetInterfaceByStr(iidstr,obj);\r\nend;\r\n\r\nfunction TObject.GetInterfaceByStr(const iidstr: String; out obj): boolean;\r\nbegin\r\n  if not TJSObj(IObjectInstance)['$str'] then\r\n    TJSObj(IObjectInstance)['$str']:=GUIDToString(IObjectInstance);\r\n  if iidstr = TJSObj(IObjectInstance)['$str'] then\r\n    begin\r\n    obj:=Self;\r\n    exit(true);\r\n    end;\r\n  asm\r\n    var i = rtl.getIntfG(this,iidstr,2);\r\n    obj.set(i);\r\n    return i!==null;\r\n  end;\r\n  Result:=false;\r\nend;\r\n\r\nfunction TObject.GetInterfaceWeak(const iid: TGuid; out obj): boolean;\r\nbegin\r\n  Result:=GetInterface(iid,obj);\r\n  asm\r\n    if (Result){\r\n      var o = obj.get();\r\n      if (o.$kind==='com'){\r\n        o._Release();\r\n      }\r\n    }\r\n  end;\r\nend;\r\n\r\nfunction TObject.Equals(Obj: TObject): boolean;\r\nbegin\r\n  Result:=Obj=Self;\r\nend;\r\n\r\nfunction TObject.ToString: String;\r\nbegin\r\n  Result:=ClassName;\r\nend;\r\n\r\n\r\ninitialization\r\n  ExitCode:=0; // set it here, so that WPO does not remove it\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit JS;\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\nuses\r\n  Types;\r\n\r\ntype\r\n  // We cannot use EConvertError or Exception, this would result in a circular dependency.\r\n\r\n  { EJS }\r\n\r\n  EJS = class(TObject)\r\n  private\r\n    FMessage: string;\r\n  Public\r\n    constructor Create(const Msg: String); reintroduce;\r\n    property Message : string Read FMessage Write FMessage;\r\n  end;\r\n\r\n  TJSObjectPropertyDescriptor = JSValue;\r\n  Float32 = Double;\r\n  Float64 = Double;\r\n\r\n  { TJSObject }\r\n\r\n  TJSObject = class external name 'Object'\r\n  private\r\n    function GetProperties(Name: String): JSValue; external name '[]';\r\n    procedure SetProperties(Name: String; const AValue: JSValue); external name '[]';\r\n  public\r\n    constructor new;\r\n    class function create(const proto: TJSObject): TJSObject;\r\n    class function create(const proto, propertiesObject: TJSObject): TJSObject;\r\n    class function assign(const Target, Source1: TJSObject): TJSObject; varargs;\r\n    class procedure defineProperty(const obj: TJSObject; propname: String; const descriptor: TJSObjectPropertyDescriptor);\r\n    //class procedure defineProperties\r\n    class function freeze(const obj: TJSObject): TJSObject;\r\n    class function getOwnPropertyDescriptor(const obj: TJSObject; propname: String): TJSObjectPropertyDescriptor;\r\n    //class function getOwnPropertyDescriptors\r\n    class function getOwnPropertyNames(const obj: TJSObject): TStringDynArray;\r\n    {$IFDEF FIREFOX}\r\n    class function getOwnPropertySymbols(const obj: TJSObject): TJSValueDynArray;\r\n    {$ENDIF}\r\n    class function getPrototypeOf(const obj: TJSObject): TJSObject;\r\n    {$IFDEF FIREFOX}\r\n    class function _is(const value1, value2: JSValue): boolean;\r\n    {$ENDIF}\r\n    class function isExtensible(const obj: TJSObject): boolean;\r\n    class function isFrozen(const obj: TJSObject): boolean;\r\n    class function isSealed(const obj: TJSObject): boolean;\r\n    class function keys(const obj: TJSObject): TStringDynArray;\r\n    class function preventExtensions(const obj: TJSObject): TJSObject;\r\n    class function seal(const obj: TJSObject): TJSObject;\r\n    class function setPrototypeOf(const obj, prototype: TJSObject): TJSObject;\r\n    function hasOwnProperty(prop: String): boolean;\r\n    function isPrototypeOf(const obj: TJSObject): boolean;\r\n    function propertyIsEnumerable(propname: String): boolean;\r\n    function toLocaleString: String;\r\n    function toString: String;\r\n    function valueOf: JSValue;\r\n    property Properties[Name: String]: JSValue read GetProperties write SetProperties; default;\r\n  end;\r\n\r\n  TJSObjectDynArray = Array of TJSObject;\r\n  TJSObjectDynArrayArray = Array of TJSObjectDynArray;\r\n  TJSStringDynArray = Array of String;\r\n\r\n  { TJSFunction }\r\n\r\n  TJSFunction = class external name 'Function'(TJSObject)\r\n  private\r\n    Flength: NativeInt external name 'length';\r\n    Fprototyp: TJSFunction external name 'prototyp';\r\n  public\r\n    name: String;\r\n    property prototyp: TJSFunction read Fprototyp;\r\n    property length: NativeInt read Flength;\r\n    function apply(thisArg: TJSObject; const ArgArray: TJSValueDynArray): JSValue; varargs;\r\n    function bind(thisArg: TJSObject): JSValue; varargs;\r\n    function call(thisArg: TJSObject): JSValue; varargs;\r\n  end;\r\n\r\n  { TJSDate - wrapper for JavaScript Date }\r\n\r\n  TJSDate = class external name 'Date'(TJSFunction)\r\n  private\r\n    function getDate: NativeInt;\r\n    function getFullYear: NativeInt;\r\n    function getHours: NativeInt;\r\n    function getMilliseconds: NativeInt;\r\n    function getMinutes: NativeInt;\r\n    function getMonth: NativeInt;\r\n    function getSeconds: NativeInt;\r\n    function getYear: NativeInt;\r\n    function getTime: NativeInt;\r\n    function getUTCDate: NativeInt;\r\n    function getUTCFullYear: NativeInt;\r\n    function getUTCHours: NativeInt;\r\n    function getUTCMilliseconds: NativeInt;\r\n    function getUTCMinutes: NativeInt;\r\n    function getUTCMonth: NativeInt;\r\n    function getUTCSeconds: NativeInt;\r\n    procedure setDate(const AValue: NativeInt);\r\n    procedure setFullYear(const AValue: NativeInt);\r\n    procedure setHours(const AValue: NativeInt);\r\n    procedure setMilliseconds(const AValue: NativeInt);\r\n    procedure setMinutes(const AValue: NativeInt);\r\n    procedure setMonth(const AValue: NativeInt);\r\n    procedure setSeconds(const AValue: NativeInt);\r\n    procedure setYear(const AValue: NativeInt);\r\n    procedure setTime(const AValue: NativeInt);\r\n    procedure setUTCDate(const AValue: NativeInt);\r\n    procedure setUTCFullYear(const AValue: NativeInt);\r\n    procedure setUTCHours(const AValue: NativeInt);\r\n    procedure setUTCMilliseconds(const AValue: NativeInt);\r\n    procedure setUTCMinutes(const AValue: NativeInt);\r\n    procedure setUTCMonth(const AValue: NativeInt);\r\n    procedure setUTCSeconds(const AValue: NativeInt);\r\n  public\r\n    constructor New; reintroduce;\r\n    constructor New(const MilliSecsSince1970: NativeInt); // milliseconds since 1 January 1970 00:00:00 UTC, with leap seconds ignored\r\n    constructor New(const aDateString: String); // RFC 2822, ISO8601\r\n    constructor New(aYear: NativeInt; aMonth: NativeInt; aDayOfMonth: NativeInt = 1;\r\n      TheHours: NativeInt = 0; TheMinutes: NativeInt = 0; TheSeconds: NativeInt = 0;\r\n      TheMilliseconds: NativeInt = 0);\r\n    class function now: NativeInt; // current date and time in milliseconds since 1 January 1970 00:00:00 UTC, with leap seconds ignored\r\n    class function parse(const aDateString: string): NativeInt; // format depends on browser\r\n    class function UTC(aYear: NativeInt; aMonth: NativeInt = 0; aDayOfMonth: NativeInt = 1;\r\n      TheHours: NativeInt = 0; TheMinutes: NativeInt = 0; TheSeconds: NativeInt = 0;\r\n      TheMilliseconds: NativeInt = 0): NativeInt;\r\n    function getDay: NativeInt;\r\n    function getTimezoneOffset: NativeInt;\r\n    function getUTCDay: NativeInt; // day of the week\r\n    function toDateString: string; // human readable date, without time\r\n    function toISOString: string; // ISO 8601 Extended Format\r\n    function toJSON: string;\r\n    function toGMTString: string; // in GMT timezone\r\n    function toLocaleDateString: string; // date in locale timezone, no time\r\n    function toLocaleString: string; reintroduce; // date and time in locale timezone\r\n    function toLocaleTimeString: string; // time in locale timezone, no date\r\n    function toTimeString: string; // time human readable, no date\r\n    function toUTCString: string; // date and time using UTC timezone\r\n    property Year: NativeInt read getYear write setYear;\r\n    property Time: NativeInt read getTime write setTime; // milliseconds since 1 January 1970 00:00:00 UTC, with leap seconds ignored\r\n    property FullYear: NativeInt read getFullYear write setFullYear;\r\n    property UTCDate: NativeInt read getUTCDate write setUTCDate; // day of month\r\n    property UTCFullYear: NativeInt read getUTCFullYear write setUTCFullYear;\r\n    property UTCHours: NativeInt read getUTCHours write setUTCHours;\r\n    property UTCMilliseconds: NativeInt read getUTCMilliseconds write setUTCMilliseconds;\r\n    property UTCMinutes: NativeInt read getUTCMinutes write setUTCMinutes;\r\n    property UTCMonth: NativeInt read getUTCMonth write setUTCMonth;\r\n    property UTCSeconds: NativeInt read getUTCSeconds write setUTCSeconds;\r\n    property Month: NativeInt read getMonth write setMonth;\r\n    property Date: NativeInt read getDate write setDate; // day of the month, starting at 1\r\n    property Hours: NativeInt read getHours write setHours;\r\n    property Minutes: NativeInt read getMinutes write setMinutes;\r\n    property Seconds: NativeInt read getSeconds write setSeconds;\r\n    property Milliseconds: NativeInt read getMilliseconds write setMilliseconds;\r\n  end;\r\n\r\n  TLocaleCompareOptions = record\r\n    localematched : string;\r\n    usage: string;\r\n    sensitivity : string;\r\n    ignorePunctuation : Boolean;\r\n    numeric : boolean;\r\n    caseFirst : string;\r\n  end;\r\n\r\n  TJSRegexp = class external name 'RegExp'\r\n  private\r\n  {$IFDEF FIREFOX}\r\n    // not on all browsers:\r\n    FFlags : string; external name 'flags';\r\n    FSticky : boolean; external name 'sticky';\r\n  {$endif}\r\n    fglobal: boolean; external name 'global';\r\n    fignoreCase : boolean; external name 'ignoreCase';\r\n    fmultiline : boolean; external name 'multiline';\r\n    fsource : string; external name 'source';\r\n    funicode : boolean; external name 'unicode';\r\n  public\r\n    Constructor New(Pattern : string);\r\n    Constructor New(Pattern, Flags : string);\r\n    lastIndex: NativeInt;\r\n    function exec(aString : string): TStringDynArray;\r\n    function test(aString : string) : boolean;\r\n    function toString : String;\r\n    property Global : boolean read fglobal;\r\n    property IgnoreCase : Boolean read FIgnoreCase;\r\n    property Multiline : Boolean Read FMultiLine;\r\n    Property Source : string Read FSource;\r\n    Property Unicode : boolean Read FUnicode;\r\n    {$IFDEF FIREFOX}\r\n    // not on all browsers:\r\n    property Flags : string read FFlags;\r\n    property Sticky : boolean read FSticky;\r\n    {$endif}\r\n  end;\r\n\r\n\r\n  TReplaceCallBack = Function () : string; varargs;\r\n\r\n  TJSString = class external name 'String'\r\n  private\r\n    flength : NativeInt; external name 'length';\r\n  public \r\n    constructor New(Const S : String);\r\n    constructor New(Const I : NativeInt);\r\n    constructor New(Const D : double);\r\n    property length : NativeInt read flength; \r\n    class function fromCharCode() : string; varargs;\r\n    class function fromCodePoint() : string; varargs;\r\n    function anchor(const aName : string) : string;\r\n    function charAt(aIndex : NativeInt) : string;\r\n    function charCodeAt(aIndex : NativeInt) : NativeInt;\r\n    function codePointAt(aIndex : NativeInt) : NativeInt;\r\n    function concat(s : string) : string; varargs;\r\n    function endsWith(aSearchString : string; Pos : NativeInt = 0) : boolean;\r\n    function includes(aSearchString : string; Pos : NativeInt = 0) : boolean;\r\n    function indexOf(aSearchString : String; Pos : NativeInt = 0) : Integer;\r\n    function lastIndexOf(aSearchString : String) : NativeInt;overload;\r\n    function lastIndexOf(aSearchString : String; Pos : NativeInt) : Integer;overload;\r\n    function link(aUrl : string) : String;\r\n    function localeCompare(aCompareString : string) : NativeInt; overload;\r\n    function localeCompare(aCompareString : string; aLocales: string) : integer; overload;\r\n    function localeCompare(compareString : string; locales: string; Options : TlocaleCompareOptions) : integer; overload;\r\n    function match(aRegexp : TJSRegexp) : TStringDynArray; overload;\r\n    function match(aRegexp : String) : TStringDynArray;overload;\r\n    {$IFDEF ECMAScript6}\r\n    function normalize : string;\r\n    function normalize(aForm : string) : string;\r\n    {$ENDIF}\r\n    function _repeat(aCount : NativeInt) : Integer; external name 'repeat';\r\n    function replace(aRegexp : String; NewString : String) : String; overload;\r\n    function replace(aRegexp : TJSRegexp; NewString : String) : String; overload;\r\n    function replace(Regexp : String; aCallback : TReplaceCallBack) : String; overload;\r\n    function replace(Regexp : TJSRegexp; aCallback : TReplaceCallBack) : String; overload;\r\n    function search(Regexp : TJSRegexp) : NativeInt; overload;\r\n    function search(Regexp : JSValue) : NativeInt; overload;\r\n    function slice(aBeginIndex : NativeInt) : String; overload;\r\n    function slice(aBeginIndex, aEndIndex : NativeInt) : String; overload;\r\n    function split : TStringDynArray; overload;\r\n    function split(aSeparator : string) : TStringDynArray; overload;\r\n    function split(aSeparator : string; aLimit : NativeInt) : TStringDynArray; overload;\r\n    function startsWith(aSearchString : String) : Boolean; overload;\r\n    function startsWith(aSearchString : String; aPosition : NativeInt) : Boolean; overload;\r\n    function substr(aStartIndex : NativeInt) : String; overload;\r\n    function substr(aStartIndex,aLength : NativeInt) : String; overload;\r\n    function substring(aStartIndex : NativeInt) : String; overload;\r\n    function substring(aStartIndex,aEndIndex : NativeInt) : String; overload;\r\n    function toLocaleLowerCase : String;\r\n    function toLocaleUpperCase : String;\r\n    function toLowerCase : String;\r\n    function toString : string;\r\n    function toUpperCase : String;\r\n    function trim : string;\r\n    function valueOf : string;\r\n  end;\r\n\r\n  TJSArray = Class;\r\n  \r\n  TJSArrayEvent = reference to function (element : JSValue; index: NativeInt; anArray : TJSArray) : Boolean;\r\n  TJSArrayMapEvent = reference to function (element : JSValue; index: NativeInt; anArray : TJSArray) : JSValue;\r\n  TJSArrayReduceEvent = reference to function (accumulator, currentValue : JSValue; currentIndex : NativeInt; anArray : TJSArray) : JSValue;\r\n  TJSArrayCompareEvent = reference to function (a,b : JSValue) : NativeInt;\r\n  TJSArrayCallback = TJSArrayEvent;\r\n  TJSArrayMapCallback = TJSArrayMapEvent;\r\n  TJSArrayReduceCallBack = TJSArrayReduceEvent;\r\n  TJSArrayCompareCallBack = TJSArrayCompareEvent;\r\n\r\n  { TJSArray }\r\n\r\n  TJSArray = Class external name 'Array'\r\n  private\r\n    function GetElements(Index: NativeInt): JSValue; external name '[]';\r\n    procedure SetElements(Index: NativeInt; const AValue: JSValue); external name '[]';\r\n  public\r\n    FLength : NativeInt; external name 'length';\r\n    constructor new; overload;\r\n    constructor new(aLength : NativeInt); overload;\r\n    constructor new(aElement1 : JSValue); varargs; overload;\r\n    class function _of() : TJSArray; varargs; external name 'of'; \r\n    class function isArray(a: JSValue) : Boolean;\r\n{$IFDEF JAVASCRIPT2015}    \r\n    class function from(a : JSValue) : TJSArray;\r\n{$ENDIF}    \r\n    function concat(el : JSValue) : TJSArray; varargs;\r\n    function copyWithin(aTarget : NativeInt) : TJSarray;overload; // not in IE\r\n    function copyWithin(aTarget, aStart : NativeInt) : TJSarray;overload; // not in IE\r\n    function copyWithin(aTarget, aStart, aEnd : NativeInt) : TJSarray;overload; // not in IE\r\n    Function every(const aCallback : TJSArrayCallBack) : boolean;overload;\r\n    Function every(const aCallback : TJSArrayEvent; aThis : TObject) : boolean;overload;\r\n    Function filter(const aCallBack : TJSArrayCallBack) : TJSArray; overload;\r\n    Function filter(const aCallBack : TJSArrayEvent; aThis : TObject) : TJSArray;overload;\r\n    Function fill(aValue : JSValue) : TJSArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex : NativeInt) : TJSArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex,aEndIndex : NativeInt) : TJSArray; overload;\r\n    Function find(const aCallBack : TJSArrayCallBack) : JSValue; overload;\r\n    Function find(const aCallBack : TJSArrayEvent; aThis : TObject) : JSValue; overload;\r\n    Function findIndex(const aCallBack : TJSArrayCallBack) : NativeInt; overload;\r\n    Function findIndex(const aCallBack : TJSArrayEvent; aThis : TObject) : NativeInt; overload;\r\n    procedure forEach(const aCallBack : TJSArrayEvent); overload;\r\n    procedure forEach(const aCallBack : TJSArrayEvent; aThis : TObject); overload;\r\n    function includes(aElement : JSValue) : Boolean; overload;\r\n    function includes(aElement : JSValue; FromIndex : NativeInt) : Boolean; overload;\r\n    function indexOf(aElement : JSValue) : NativeInt; overload;\r\n    function indexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n    function join : String; overload;\r\n    function join (aSeparator : string) : String; overload;\r\n    function lastIndexOf(aElement : JSValue) : NativeInt; overload;\r\n    function lastIndexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n    Function map(const aCallBack : TJSArrayMapCallBack) : TJSArray; overload;\r\n    Function map(const aCallBack : TJSArrayMapEvent; aThis : TObject) : TJSArray; overload;\r\n    function pop : JSValue; \r\n    function push(aElement : JSValue) : NativeInt; varargs;\r\n    function reduce(const aCallBack : TJSArrayReduceCallBack) : JSValue; overload;\r\n    function reduce(const aCallBack : TJSArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSArrayReduceCallBack) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    Function reverse : TJSArray;\r\n    Function shift : JSValue;\r\n    Function slice : TJSArray; overload;\r\n    function slice(aBegin : NativeInt) : TJSArray; overload;\r\n    function slice(aBegin,aEnd : NativeInt) : TJSArray; overload;\r\n    Function some(const aCallback : TJSArrayCallBack) : boolean; overload;\r\n    Function some(const aCallback : TJSArrayEvent; aThis : TObject) : boolean; overload;\r\n    Function sort(const aCallback : TJSArrayCompareCallBack) : TJSArray; overload;\r\n    Function sort() : TJSArray; overload;\r\n    function splice(aStart : NativeInt) : TJSArray; overload;\r\n    function splice(aStart,aDeleteCount : NativeInt) : TJSArray; varargs; overload;\r\n    function toLocaleString: String; overload;\r\n    function toLocaleString(locales : string) : String; overload;\r\n    function toLocaleString(locales : string; const Options : TLocaleCompareOptions) : String; overload;\r\n    function toString : String;\r\n    function unshift : NativeInt; varargs; \r\n    Property Length : NativeInt Read FLength Write FLength;\r\n    property Elements[Index: NativeInt]: JSValue read GetElements write SetElements; default;\r\n  end;\r\n\r\n  TJSArrayBuffer = Class external name 'ArrayBuffer'\r\n  private\r\n    fLength : NativeInt; external name 'byteLength';\r\n  public\r\n    constructor new(aByteLength : NativeInt);\r\n    class function isView(aValue : JSValue) : Boolean;   \r\n    function slice(aBegin : NativeInt) : TJSArrayBuffer; overload;\r\n    function slice(aBegin,aEnd : NativeInt) : TJSArrayBuffer; overload;\r\n    Property byteLength : NativeInt Read fLength;\r\n  end;\r\n\r\n  TJSBufferSource = class external name 'BufferSource'\r\n  end;\r\n\r\n  { TJSTypedArray }\r\n  TJSTypedArray = Class;\r\n\r\n  TJSTypedArrayCallBack = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : Boolean;\r\n  TJSTypedArrayEvent = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : Boolean of object;\r\n  TJSTypedArrayMapCallBack = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : JSValue;\r\n  TJSTypedArrayMapEvent = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : JSValue of object;\r\n  TJSTypedArrayReduceCallBack = function (accumulator, currentValue : JSValue; currentIndex : NativeInt; anArray : TJSTypedArray) : JSValue;\r\n  TJSTypedArrayCompareCallBack = function (a,b : JSValue) : NativeInt;\r\n\r\n  TJSTypedArray = class external name 'TypedArray' (TJSBufferSource)\r\n  Private\r\n    FBuffer: TJSArrayBuffer; external name 'buffer';\r\n    FByteLength: NativeInt; external name 'byteLength';\r\n    FLength: NativeInt; external name 'length';\r\n    FByteOffset: NativeInt; external name 'byteOffset';\r\n    function getValue(Index : NativeInt) : JSValue; external name '[]';\r\n    procedure setValue(Index : NativeInt;AValue : JSValue); external name '[]';\r\n  Public\r\n    class var BYTES_PER_ELEMENT : NativeInt;\r\n    class var name : string;\r\n//    class function from(aValue : jsValue) : TJSTypedArray;\r\n//    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSTypedArray;\r\n//    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSTypedArray;\r\n    class function _of(aValue : jsValue) : TJSTypedArray; varargs; external name 'of';\r\n    function copyWithin(aTarget : NativeInt) : TJSTypedArray;overload;\r\n    function copyWithin(aTarget, aStart : NativeInt) : TJSTypedArray;overload;\r\n    function copyWithin(aTarget, aStart, aEnd : NativeInt) : TJSTypedArray;overload;\r\n    Function every(const aCallback : TJSTypedArrayCallBack) : boolean;overload;\r\n    Function every(const aCallback : TJSTypedArrayEvent; aThis : TObject) : boolean;overload;\r\n    Function fill(aValue : JSValue) : TJSTypedArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex : NativeInt) : TJSTypedArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex,aEndIndex : NativeInt) : TJSTypedArray; overload;\r\n    Function filter(const aCallBack : TJSTypedArrayCallBack) : TJSTypedArray; overload;\r\n    Function filter(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : TJSTypedArray;overload;\r\n    Function find(const aCallBack : TJSTypedArrayCallBack) : JSValue; overload;\r\n    Function find(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : JSValue; overload;\r\n    Function findIndex(const aCallBack : TJSTypedArrayCallBack) : NativeInt; overload;\r\n    Function findIndex(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : NativeInt; overload;\r\n    procedure forEach(const aCallBack : TJSTypedArrayCallBack); overload;\r\n    procedure forEach(const aCallBack : TJSTypedArrayEvent; aThis : TObject); overload;\r\n    function includes(aElement : JSValue) : Boolean; overload;\r\n    function includes(aElement : JSValue; FromIndex : NativeInt) : Boolean; overload;\r\n    function indexOf(aElement : JSValue) : NativeInt; overload;\r\n    function indexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n    function join : String; overload;\r\n    function join (aSeparator : string) : String; overload;\r\n    function lastIndexOf(aElement : JSValue) : NativeInt; overload;\r\n    function lastIndexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n    Function map(const aCallBack : TJSTypedArrayCallBack) : TJSTypedArray; overload;\r\n    Function map(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : TJSTypedArray; overload;\r\n    function reduce(const aCallBack : TJSTypedArrayReduceCallBack) : JSValue; overload;\r\n    function reduce(const aCallBack : TJSTypedArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSTypedArrayReduceCallBack) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSTypedArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    Function reverse : TJSTypedArray;\r\n    procedure _set(anArray : TJSArray); external name 'set';\r\n    procedure _set(anArray : TJSArray; anOffset : NativeInt); external name 'set';\r\n    procedure _set(anArray : TJSTypedArray); external name 'set';\r\n    procedure _set(anArray : TJSTypedArray; anOffset : NativeInt); external name 'set';\r\n    Function slice : TJSTypedArray; overload;\r\n    function slice(aBegin : NativeInt) : TJSTypedArray; overload;\r\n    function slice(aBegin,aEnd : NativeInt) : TJSTypedArray; overload;\r\n    Function some(const aCallback : TJSTypedArrayCallBack) : boolean; overload;\r\n    Function some(const aCallback : TJSTypedArrayEvent; aThis : TObject) : boolean; overload;\r\n    Function sort(const aCallback : TJSTypedArrayCompareCallBack) : TJSTypedArray; overload;\r\n    Function sort() : TJSTypedArray; overload;\r\n    function splice(aStart : NativeInt) : TJSTypedArray; overload;\r\n    function splice(aStart,aDeleteCount : NativeInt) : TJSTypedArray; varargs; overload;\r\n    function toLocaleString: String; overload;\r\n    function toLocaleString(locales : string) : String; overload;\r\n    function toLocaleString(locales : string; const Options : TLocaleCompareOptions) : String; overload;\r\n    function toString : String;\r\n    function unshift : NativeInt; varargs;\r\n    property buffer : TJSArrayBuffer read FBuffer;\r\n    property byteLength : NativeInt Read FByteLength;\r\n    property byteOffset : NativeInt Read FByteOffset;\r\n    property length : NativeInt Read FLength;\r\n    property values[Index : NativeInt] : JSValue Read getValue Write SetValue; default;\r\n  end;\r\n\r\n  { TJSInt8Array }\r\n\r\n  TJSInt8Array = class external name 'Int8Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Shortint; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Shortint);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSInt8Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSInt8Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSInt8Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSInt8Array; varargs; external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of ShortInt); external name 'set'; reintroduce; overload;\r\n    procedure _set(anArray : Array of ShortInt; anOffset : NativeInt); external name 'set';\r\n    property values[Index : NativeInt] : Shortint Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint8Array  = class external name 'Uint8Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Byte; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Byte);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt8Array; reintroduce; overload;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt8Array; reintroduce;overload;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt8Array; reintroduce;overload;\r\n    class function _of(aValue : jsValue) : TJSUInt8Array; varargs; external name 'of'; reintroduce; overload;\r\n    procedure _set(anArray : Array of Byte); external name 'set'; reintroduce; overload;\r\n    procedure _set(anArray : Array of Byte; anOffset : NativeInt); external name 'set'; overload;\r\n    Property values[Index : NativeInt] : Byte Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint8ClampedArray  = class external name 'Uint8ClampedArray' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Byte; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Byte);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt8ClampedArray; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt8ClampedArray; reintroduce;overload;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt8ClampedArray; reintroduce;overload;\r\n    class function _of(aValue : jsValue) : TJSUInt8ClampedArray; varargs; external name 'of'; reintroduce;overload;\r\n    procedure _set(anArray : Array of Byte); external name 'set'; reintroduce;overload;\r\n    procedure _set(anArray : Array of Byte; anOffset : NativeInt); external name 'set';overload;\r\n    Property values[Index : NativeInt] : Byte Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSInt16Array = class external name 'Int16Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): smallint; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Smallint);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSInt16Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSInt16Array; reintroduce;overload;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSInt16Array; reintroduce;overload;\r\n    class function _of(aValue : jsValue) : TJSInt16Array; varargs; external name 'of'; reintroduce;overload;\r\n    procedure _set(anArray : Array of SmallInt); external name 'set'; reintroduce;overload;\r\n    procedure _set(anArray : Array of SmallInt; anOffset : NativeInt); external name 'set';overload;\r\n    Property values[Index : NativeInt] : SmallInt Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint16Array = class external name 'Uint16Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Word; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Word);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt16Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt16Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt16Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSUInt16Array; varargs; external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of Word); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of Word; anOffset : NativeInt); external name 'set';\r\n    Property values[Index : NativeInt] : Word Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSInt32Array = class external name 'Int32Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): longint; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: longint);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSInt32Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSInt32Array; varargs;external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of LongInt); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of LongInt; anOffset : NativeInt); external name 'set';\r\n    Property values[Index : NativeInt] : longint Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint32Array = class external name 'Uint32Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): LongWord; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: LongWord);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt32Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSUInt32Array; varargs; external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of Cardinal); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of Cardinal; anOffset : NativeInt); external name 'set';\r\n    Property values[Index : NativeInt] : LongWord Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSFloat32Array = class external name 'Float32Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Float32; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Float32);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSFloat32Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSFloat32Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSFloat32Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSFloat32Array; varargs; reintroduce;\r\n    procedure _set(anArray : Array of Double); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of Double; anOffset : NativeInt); external name 'set'; reintroduce;\r\n    Property values[Index : NativeInt] : Float32 Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSFloat64Array = class external name 'Float64Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Float64; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Float64);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSFloat64Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSFloat64Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSFloat64Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSFloat64Array; varargs; reintroduce;\r\n    procedure _set(anArray : Array of Double); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of Double; anOffset : NativeInt); external name 'set'; reintroduce;\r\n    Property values[Index : NativeInt] : Float64 Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSDataView = Class external name 'DataView' (TJSBufferSource)\r\n  private\r\n    fBuffer : TJSArrayBuffer; external name 'buffer';\r\n    fLength : NativeInt; external name 'byteLength';\r\n    fOffset : NativeInt; external name 'byteOffset';\r\n  public\r\n    constructor new(aBuffer : TJSArrayBuffer); overload;\r\n    constructor new(aBuffer : TJSArrayBuffer; aOffset : NativeInt); overload;\r\n    constructor new(aBuffer : TJSArrayBuffer; aOffset,aByteLength : NativeInt); overload;\r\n    function getFloat32(aByteOffset : NativeInt) : double; overload;\r\n    function getFloat32(aByteOffset : NativeInt; aLittleEndian: Boolean) : double; overload;\r\n    function getFloat64(aByteOffset : NativeInt) : double; overload;\r\n    function getFloat64(aByteOffset : NativeInt; aLittleEndian: Boolean) : double; overload;\r\n    function getInt8(aByteOffset : NativeInt) : ShortInt; \r\n    function getInt16(aByteOffset : NativeInt) : SmallInt; overload;\r\n    function getInt16(aByteOffset : NativeInt; aLittleEndian : Boolean) : SmallInt; overload;\r\n    function getInt32(aByteOffset : NativeInt) : Longint; overload;\r\n    function getInt32(aByteOffset : NativeInt; aLittleEndian : Boolean) : Longint; overload;\r\n    function getUint8(aByteOffset : NativeInt) : Byte; overload;\r\n    function getUint16(aByteOffset : NativeInt) : Word; overload;\r\n    function getUint16(aByteOffset : NativeInt; aLittleEndian : Boolean) : Word; overload;\r\n    function getUint32(aByteOffset : NativeInt) : LongWord; overload;\r\n    function getUint32(aByteOffset : NativeInt; aLittleEndian : Boolean) : LongWord; overload;\r\n\r\n    procedure setFloat32(aByteOffset : NativeInt; aValue : double); overload;\r\n    procedure setFloat32(aByteOffset : NativeInt; aValue : double; aLittleEndian: Boolean); overload;\r\n    procedure setFloat64(aByteOffset : NativeInt; aValue : double); overload;\r\n    procedure setFloat64(aByteOffset : NativeInt; aValue : double; aLittleEndian: Boolean); overload;\r\n    procedure setInt8(aByteOffset : NativeInt; aValue : ShortInt); \r\n    procedure setInt16(aByteOffset : NativeInt; aValue : SmallInt); overload;\r\n    procedure setInt16(aByteOffset : NativeInt; aValue : SmallInt; aLittleEndian : Boolean); overload;\r\n    procedure setInt32(aByteOffset : NativeInt; aValue : Longint); overload;\r\n    procedure setInt32(aByteOffset : NativeInt; aValue : Longint; aLittleEndian : Boolean); overload;\r\n    procedure setUint8(aByteOffset : NativeInt; aValue : Byte); overload;\r\n    procedure setUint16(aByteOffset : NativeInt; aValue : Word); overload;\r\n    procedure setUint16(aByteOffset : NativeInt; aValue : Word; aLittleEndian : Boolean); overload;\r\n    procedure setUint32(aByteOffset : NativeInt; aValue : LongWord); overload;\r\n    procedure setUint32(aByteOffset : NativeInt; aValue: LongWord; aLittleEndian : Boolean); overload;\r\n    Property byteLength : NativeInt Read fLength;\r\n    Property byteOffset : NativeInt read fOffset;\r\n    property buffer : TJSArrayBuffer Read fBuffer;\r\n  end;\r\n\r\n  TJSJSON = class external name 'JSON' (TJSObject)\r\n  Public\r\n    class function parse(aJSON : String) : JSValue;\r\n    // Use this only when you are sure you will get an object, no checking is done.\r\n    class function parseObject(aJSON : String) : TJSObject; external name 'parse';\r\n    class function stringify(aValue : JSValue) : string;\r\n    class function stringify(aValue,aReplacer : JSValue) : string;\r\n    class function stringify(aValue,aReplacer : JSValue; space:  NativeInt) : string;\r\n    class function stringify(aValue,aReplacer : JSValue; space:  String) : string;\r\n  end;\r\n\r\n  { TJSError }\r\n\r\n  TJSError = Class external name 'Error'\r\n  private\r\n    FMessage: String; external name 'message';\r\n    {$ifdef NodeJS}\r\n    FStack: JSValue; external name 'stack';\r\n    {$endif}\r\n  Public\r\n    Constructor new;\r\n    Constructor new(Const aMessage : string);\r\n    Constructor new(Const aMessage,aFileName : string);\r\n    Constructor new(Const aMessage,aFileName : string; aLineNumber : NativeInt);\r\n    Property Message : String Read FMessage;\r\n    {$ifdef NodeJS}\r\n    Property Stack: JSValue read FStack;\r\n    {$endif}\r\n  end;\r\n\r\n\r\n  TJSPromiseResolver = reference to function (aValue : JSValue) : JSValue;\r\n  TJSPromiseExecutor = reference to procedure (resolve,reject : TJSPromiseResolver);\r\n  TJSPromiseFinallyHandler = reference to procedure;\r\n  TJSPromise = Class;\r\n  TJSPromiseArray = array of TJSPromise;\r\n\r\n  TJSPromise = class external name 'Promise'\r\n    constructor new(Executor : TJSPromiseExecutor);\r\n    class function all(arg : Array of JSValue) : TJSPromise; overload;\r\n    class function all(arg : JSValue) : TJSPromise; overload;\r\n    class function all(arg : TJSPromiseArray) : TJSPromise; overload;\r\n    class function race(arg : Array of JSValue) : TJSPromise; overload;\r\n    class function race(arg : JSValue) : TJSPromise; overload;\r\n    class function race(arg : TJSPromiseArray) : TJSPromise; overload;\r\n    class function reject(reason : JSValue) : TJSPromise;\r\n    class function resolve(value : JSValue): TJSPromise; overload;\r\n    class function resolve : TJSPromise; overload;\r\n    function _then (onAccepted : TJSPromiseResolver) : TJSPromise; external name 'then';\r\n    function _then (onAccepted,OnRejected: TJSPromiseResolver) : TJSPromise; external name 'then';\r\n    function catch (onRejected : TJSPromiseResolver) : TJSPromise;\r\n    function _finally(value : TJSPromiseFinallyHandler): TJSPromise;\r\n  end;\r\n\r\n  TJSFunctionArguments = class external name 'arguments'\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n    function GetElements(Index: NativeInt): JSValue; external name '[]';\r\n    procedure SetElements(Index: NativeInt; const AValue: JSValue); external name '[]';\r\n  public\r\n    property Length: NativeInt read FLength;\r\n    property Elements[Index: NativeInt]: JSValue read GetElements write SetElements; default;\r\n  end;\r\n\r\nvar\r\n  // JSArguments can be used in procedures/functions to provide access to the 'arguments' array.\r\n  JSArguments: TJSFunctionArguments; external name 'arguments';\r\n  // JSThis can be used in all code to access the javascript 'this' object.\r\n  JSThis: TJSObject; external name 'this';\r\n  // JSExceptValue can be used in catch blocks to access the JS throw value\r\n  JSExceptValue: JSValue; external name '$e';\r\n\r\nfunction new(aElements: TJSValueDynArray) : TJSObject; overload;\r\nfunction JSDelete(const Obj: JSValue; const PropName: string): boolean; assembler; overload;\r\n\r\nfunction decodeURIComponent(encodedURI : String) : String; external name 'decodeURIComponent';\r\nfunction encodeURIComponent(str : String) : String; external name 'encodeURIComponent';\r\n\r\nfunction parseInt(s: String; Radix: NativeInt): NativeInt; overload; external name 'parseInt'; // may result NaN\r\nfunction parseInt(s: String): NativeInt; overload; external name 'parseInt'; // may result NaN\r\nfunction parseFloat(s: String): double; overload; external name 'parseFloat'; // may result NaN\r\n\r\nfunction hasString(const v: JSValue): boolean; external name 'rtl.hasString';// isString(v) and v<>''\r\nfunction hasValue(const v: JSValue): boolean; assembler; // returns the JS definition of if(v): v is not false, undefined, null, 0, NaN, or the empty string. Note: JS if(new Boolean(false)) returns true.\r\nfunction isArray(const v: JSValue): boolean; external name 'rtl.isArray';\r\nfunction isBoolean(const v: JSValue): boolean; assembler;\r\nfunction isCallback(const v: JSValue): boolean; assembler;\r\nfunction isChar(const v: JSValue): boolean; assembler;\r\nfunction isClass(const v: JSValue): boolean; assembler; // is a Pascal class, e.g. a TClass\r\nfunction isClassInstance(const v: JSValue): boolean; assembler;// is a Pascal class instance, e.g. a TObject\r\nfunction isFunction(const v: JSValue): boolean; external name 'rtl.isFunction';\r\nfunction isInteger(const v: JSValue): boolean; assembler;\r\nfunction isModule(const v: JSValue): boolean; external name 'rtl.isModule';\r\nfunction isNull(const v: JSValue): boolean; assembler;\r\nfunction isNumber(const v: JSValue): boolean; external name 'rtl.isNumber';\r\nfunction isObject(const v: JSValue): boolean; external name 'rtl.isObject'; // true if not null and a JS Object\r\nfunction isRecord(const v: JSValue): boolean; assembler;\r\nfunction isString(const v: JSValue): boolean; external name 'rtl.isString';\r\nfunction isUndefined(const v: JSValue): boolean; assembler;\r\nfunction isDefined(const v: JSValue): boolean; assembler;\r\nfunction isUTF16Char(const v: JSValue): boolean; assembler;\r\nfunction isExt(const InstanceOrClass, aClass: JSValue): boolean; external name 'rtl.isExt'; // aClass can be a JS object or function\r\nfunction jsInstanceOf(const aFunction, aFunctionWithPrototype: JSValue): String; assembler;\r\nfunction jsTypeOf(const v: JSValue): String; external name 'typeof';\r\nfunction jsIsNaN(const v: JSValue): boolean; external name 'isNaN';// true if value cannot be converted to a number. e.g. True on NaN, undefined, {}, '123'. False on true, null, '', ' ', '1A'\r\nfunction toNumber(const v: JSValue): double; assembler; // if not possible, returns NaN\r\nfunction toInteger(const v: JSValue): NativeInt; // if v is not an integer, returns 0\r\nfunction toObject(Value: JSValue): TJSObject; // If Value is not a Javascript object, returns Nil\r\nfunction toArray(Value: JSValue): TJSArray; // If Value is not a Javascript array, returns Nil\r\nfunction toBoolean(Value: JSValue): Boolean; // If Value is not a Boolean, returns False\r\nfunction toString(Value: JSValue): String; // If Value is not a string, returns ''\r\n\r\nType\r\n  TJSValueType = (jvtNull,jvtBoolean,jvtInteger,jvtFloat,jvtString,jvtObject,jvtArray);\r\n\r\nFunction GetValueType(JS : JSValue) : TJSValueType;\r\n\r\nConst\r\n  Null : JSValue; external name 'null';\r\n  Undefined : JSValue; external name 'undefined';\r\n\r\nimplementation\r\n\r\nfunction new(aElements: TJSValueDynArray): TJSObject;\r\n\r\n  function toString(I : Integer): string; external name 'String';\r\n\r\nVar\r\n  L,I : integer;\r\n  S : String;\r\n\r\nbegin\r\n  L:=length(aElements);\r\n  if (L mod 2)=1 then\r\n    raise EJS.Create('Number of arguments must be even');\r\n  I:=0;\r\n  // Check all arguments;\r\n  While (i<L) do\r\n    begin\r\n    if Not isString(aElements[i]) then\r\n      begin\r\n      S:=ToString(I);\r\n      raise EJS.Create('Argument '+S+' must be a string.');\r\n      end;\r\n    inc(I,2);\r\n    end;\r\n  I:=0;\r\n  Result:=TJSObject.New;\r\n  While (i<L) do\r\n    begin\r\n    S:=String(aElements[i]);\r\n    Result.Properties[S]:=aElements[i+1];\r\n    inc(I,2);\r\n    end;\r\nend;\r\n\r\nfunction JSDelete(const Obj: JSValue; const PropName: string): boolean; assembler;\r\nasm\r\n  return delete Obj[PropName];\r\nend;\r\n\r\nfunction hasValue(const v: JSValue): boolean; assembler;\r\nasm\r\n  if(v){ return true; } else { return false; };\r\nend;\r\n\r\nfunction isBoolean(const v: JSValue): boolean; assembler;\r\nasm\r\n  return typeof(v) == 'boolean';\r\nend;\r\n\r\nfunction isCallback(const v: JSValue): boolean; assembler;\r\nasm\r\n  return rtl.isObject(v) && rtl.isObject(v.scope) && (rtl.isString(v.fn) || rtl.isFunction(v.fn));\r\nend;\r\n\r\nfunction isChar(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)!=\"string\") && (v.length==1);\r\nend;\r\n\r\nfunction isClass(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)==\"object\") && (v!=null) && (v.$class == v);\r\nend;\r\n\r\nfunction isClassInstance(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)==\"object\") && (v!=null) && (v.$class == Object.getPrototypeOf(v));\r\nend;\r\n\r\nfunction isInteger(const v: JSValue): boolean; assembler;\r\nasm\r\n  return Math.floor(v)===v;\r\nend;\r\n\r\nfunction isNull(const v: JSValue): boolean; assembler;\r\n// Note: use identity, \"==\" would fit undefined\r\nasm\r\n  return v === null;\r\nend;\r\n\r\nfunction isRecord(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)===\"object\")\r\n      && (typeof(v.$new)===\"function\")\r\n      && (typeof(v.$clone)===\"function\")\r\n      && (typeof(v.$eq)===\"function\")\r\n      && (typeof(v.$assign)===\"function\");\r\nend;\r\n\r\nfunction isUndefined(const v: JSValue): boolean; assembler;\r\nasm\r\n  return v == undefined;\r\nend;\r\n\r\nfunction isDefined(const v: JSValue): boolean; assembler;\r\nasm\r\n  return !(v == undefined);\r\nend;\r\n\r\nfunction isUTF16Char(const v: JSValue): boolean; assembler;\r\nasm\r\n  if (typeof(v)!=\"string\") return false;\r\n  if ((v.length==0) || (v.length>2)) return false;\r\n  var code = v.charCodeAt(0);\r\n  if (code < 0xD800){\r\n    if (v.length == 1) return true;\r\n  } else if (code <= 0xDBFF){\r\n    if (v.length==2){\r\n      code = v.charCodeAt(1);\r\n      if (code >= 0xDC00 && code <= 0xDFFF) return true;\r\n    };\r\n  };\r\n  return false;\r\nend;\r\n\r\nfunction jsInstanceOf(const aFunction, aFunctionWithPrototype: JSValue\r\n  ): String; assembler;\r\nasm\r\n  return aFunction instanceof aFunctionWithPrototype;\r\nend;\r\n\r\nfunction toNumber(const v: JSValue): double; assembler;\r\nasm\r\n  return v-0;\r\nend;\r\n\r\nfunction toInteger(const v: JSValue): NativeInt;\r\nbegin\r\n  if IsInteger(v) then\r\n    Result:=NativeInt(v)\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nfunction toObject(Value: JSValue): TJSObject;\r\n\r\nbegin\r\n  if IsObject(Value) then\r\n    Result:=TJSObject(Value)\r\n  else\r\n    Result:=Nil;\r\nend;\r\n\r\nfunction toArray(Value: JSValue): TJSArray; // If not possible, returns Nil\r\n\r\nbegin\r\n  if IsArray(Value) then\r\n    Result:=TJSArray(Value)\r\n  else\r\n    Result:=Nil;\r\nend;\r\n\r\nfunction toBoolean(Value: JSValue): Boolean; // If not possible, returns False\r\n\r\nbegin\r\n  if isBoolean(Value) then\r\n    Result:=Boolean(Value)\r\n  else\r\n    Result:=False;\r\nend;\r\n\r\nfunction toString(Value: JSValue): String; // If not possible, returns ''\r\n\r\nbegin\r\n  if IsString(Value) then\r\n    Result:=String(Value)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\n{ EJS }\r\n\r\nconstructor EJS.Create(const Msg: String);\r\nbegin\r\n  FMessage:=Msg;\r\nend;\r\n\r\n\r\nfunction GetValueType(JS: JSValue): TJSValueType;\r\n\r\nVar\r\n  t : string;\r\n\r\nbegin\r\n  if isNull(js) then   // null reported as object\r\n    result:=jvtNull\r\n  else\r\n    begin\r\n    t:=jsTypeOf(js);\r\n    if (t='string') then\r\n      Result:=jvtString\r\n    else if (t='boolean') then\r\n      Result:=jvtBoolean\r\n    else if (t='object') then\r\n      begin\r\n      if IsArray(JS) then\r\n        Result:=jvtArray\r\n      else\r\n        Result:=jvtObject;\r\n      end\r\n    else if (t='number') then\r\n      if isInteger(JS) then\r\n        result:=jvtInteger\r\n      else\r\n        result:=jvtFloat\r\n    end;\r\nend;\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017-2019 by the Pas2JS development team.\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\nunit Web;\r\n\r\ninterface\r\n\r\nuses Types, JS;\r\n\r\nType\r\n  TJSEvent = Class;\r\n  // Forward definitions\r\n  TJSWindow = class;\r\n  TJSDOMTokenList = class;\r\n  TJSXPathResult = CLass;\r\n  TJSNodeList = class;\r\n  TJSDocument = class;\r\n  TJSElement = class;\r\n  TJSCSSStyleSheet = Class;\r\n  TJSNodeFilter = Class;\r\n  TJSIDBObjectStore = Class;\r\n  TIDBDatabase = class;\r\n  TJSIDBRequest = class;\r\n  TJSEventTarget = class;\r\n  TJSMouseEvent = Class;\r\n  TJSWheelEvent = Class;\r\n  TJSKeyBoardEvent = class;\r\n  TJSPointerEvent = Class;\r\n  TJSUIEvent = class;\r\n  TJSTouchEvent = Class;\r\n\r\n  TJSAttr = class external name 'Attr' (TJSObject)\r\n  Private\r\n    fLocalName : String; external name 'localName';\r\n    fNameSpaceURI : String external name 'namespaceURI';\r\n    fPrefix : string; external name 'prefix';\r\n    fName : string; external name 'name';\r\n  public\r\n    value : JSValue;\r\n    property localName : String Read fLocalName;\r\n    property namespaceURI : string Read fNameSpaceURI;\r\n    property prefix : string read fPrefix;\r\n    property name : string Read fName;\r\n  end;\r\n\r\n\r\n  { TEventListenerEvent }\r\n\r\n  TEventListenerEvent = class external name 'EventListener_Event' (TJSObject)\r\n  private\r\n    FTarget: TJSEventTarget; external name 'target';\r\n  public\r\n    Property target: TJSEventTarget Read FTarget;\r\n  end;\r\n\r\n  TJSEventHandler = reference to function(Event: TEventListenerEvent): boolean;\r\n  TJSRawEventHandler = reference to Procedure(Event: TJSEvent);\r\n\r\n  TJSEventTarget = class external name 'EventTarget' (TJSObject)\r\n  public\r\n    procedure addEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure addEventListener(aname : string; aListener : TJSRawEventHandler);\r\n    procedure addEventListener(aname : string; aListener : JSValue);\r\n    function dispatchEvent(event : JSValue) : Boolean;\r\n    procedure RemoveEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure RemoveEventListener(aname : string; aListener : TJSRawEventHandler);\r\n    procedure removeEventListener(aname : string; aListener : JSValue);\r\n  end;\r\n\r\n  TJSNode = class external name 'Node' (TJSEventTarget)\r\n  Private\r\n    FBaseURI : String; external name 'baseURI';\r\n    FChildNodes: TJSNodeList; external name 'childNodes';\r\n    FFirstChild : TJSNode; external name 'firstChild';\r\n    FNextSibling : TJSNode; external name 'nextSibling';\r\n    FNodeName : String; external name 'nodeName';\r\n    FNodeType : NativeInt; external name 'nodeType';\r\n    FOwnerDocument : TJSDocument; external name 'ownerDocument';\r\n    FParentElement : TJSElement; external name 'parentElement';\r\n    FParentNode : TJSNode; external name 'parentNode';\r\n    FPreviousSibling : TJSNode; external name 'previousSibling';\r\n  Public \r\n    Const\r\n      ELEMENT_NODE \t=1;\r\n      TEXT_NODE \t=3;\r\n      PROCESSING_INSTRUCTION_NODE = \t7;\r\n      COMMENT_NODE \t=8;\r\n      DOCUMENT_NODE \t=9;\r\n      DOCUMENT_TYPE_NODE \t= 10;\r\n      DOCUMENT_FRAGMENT_NODE  = 11;\r\n\r\n      DOCUMENT_POSITION_DISCONNECTED \t= 1;\r\n      DOCUMENT_POSITION_PRECEDING \t= 2;\r\n      DOCUMENT_POSITION_FOLLOWING \t= 4;\r\n      DOCUMENT_POSITION_CONTAINS \t= 8;\r\n      DOCUMENT_POSITION_CONTAINED_BY \t= 16;\r\n      DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC = 32;\r\n  Public  \r\n    nodeValue: string;\r\n    innerText : string;\r\n    textContent : string;\r\n    function appendChild(aChild : TJSNode) : TJSNode;\r\n    function cloneNode(deep:  boolean): TJSNode;\r\n    function compareDocumentPosition(aNode : TJSNode) : NativeInt;\r\n    function contains(aNode : TJSNode) : boolean;\r\n    function hasChildNodes : boolean;\r\n    function insertBefore(newNode, referenceNode : TJSNode) : TJSNode;\r\n    function isDefaultNameSpace(aNameSpaceURI : String) : Boolean;\r\n    function isEqualNode(aNode : TJSNode) : boolean;\r\n    function isSameNode(aNode : TJSNode) : boolean;\r\n    function lookupNamespaceURI(aPrefix : string) : string;\r\n    function lookupPrefix(aPrefix : string) : string;\r\n    procedure normalize;\r\n    function removeChild(aChild: TJSNode) : TJSNode;\r\n    function replaceChild(aNewChild, aOldChild : TJSNode) : TJSNode;\r\n    property baseURI : string read FBaseURI;\r\n    property childNodes : TJSNodeList read FChildNodes;\r\n    property firstChild : TJSNode Read FFirstChild;\r\n    property nextSibling : TJSNode Read FNextSibling;\r\n    property nodeName : String Read FNodeName;\r\n    property nodeType : NativeInt Read FNodeType;\r\n    property ownerDocument : TJSDocument read FOwnerDocument;    \r\n    property parentElement : TJSElement read FParentElement;\r\n    property parentNode : TJSNode read FParentNode;\r\n    property previousSibling : TJSNode Read FPreviousSibling;\r\n  end;\r\n\r\n  TJSNodeListCallBack = procedure (currentValue : TJSNode; currentIndex: NativeInt; list : TJSNodeList);\r\n  TJSNodeListEvent = procedure (currentValue : TJSNode; currentIndex: NativeInt; list : TJSNodeList) of object;\r\n  \r\n  TJSNodeList = class external name 'NodeList' (TJSObject)\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  Public\r\n    procedure forEach(const aCallBack : TJSNodeListCallBack);\r\n    procedure forEach(const aCallBack : TJSNodeListEvent);\r\n    function item(aIndex : NativeInt) : TJSNode;\r\n    Property length : NativeInt Read FLength;\r\n    Property Nodes [aIndex : NativeInt] : TJSNode Read item; default;\r\n  end;\r\n  \r\n  TJSNamedNodeMap = class external name 'NamedNodeMap'  (TJSObject)\r\n  Public\r\n    function getNamedItem(aName : string) : TJSAttr;\r\n    Property Attrs[aIndex : String] : TJSattr Read getNamedItem; default;\r\n  end;\r\n  \r\n  TJSHTMLCollection = class external name 'HTMLCollection'  (TJSObject)\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  public\r\n    Function item(aIndex : Integer) : TJSNode;\r\n    Function namedItem(aName : string) : TJSNode;\r\n    property Items[aIndex : Integer] : TJSNode Read item; default;\r\n    property NamedItems[aName : String] : TJSNode Read namedItem; \r\n    Property length : NativeInt Read FLength;\r\n  end;  \r\n  \r\n  TJSDOMString = String;\r\n\r\n  TDOMTokenlistCallBack = Procedure (Current : JSValue; currentIndex : NativeInt; list : TJSDOMTokenList);\r\n  \r\n  // Interface\r\n  TJSDOMTokenList = class external name 'DOMTokenList'  (TJSObject)\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  public\r\n    Procedure add(aToken : TJSDOMString); varargs;\r\n    Procedure remove(aToken : TJSDOMString); varargs;\r\n    function item(aIndex : NativeInt) : String;\r\n    function contains(aToken : TJSDOMString) : Boolean;\r\n    Procedure replace(aOldToken, ANewToken : TJSDOMString);\r\n    function supports(aToken : TJSDOMString) : Boolean;\r\n    function toggle(aToken : TJSDOMString) : Boolean;\r\n    // entries,keys, values\r\n    procedure forEach(const callback: TDOMTokenlistCallBack);\r\n    property length : NativeInt read FLength;\r\n  end;\r\n\r\n  TJSDOMRect = class external name 'DOMRect'  (TJSObject)\r\n  public\r\n    left,top,right,bottom,x,y,width,height : double;\r\n    {$IFDEF FIREFOX}\r\n    constructor New;\r\n    {$ENDIF}\r\n  end;\r\n  TJSClientRect = record\r\n    left,top,right,bottom : double;\r\n    {$IFDEF FIREFOX}\r\n    width, height: double;\r\n    {$ENDIF}\r\n  end;\r\n  \r\n  TJSClientRectArray = array of TJSClientRect;\r\n  \r\n  TJSElement = class external name 'Element' (TJSNode)\r\n  Private\r\n    FAttributes : TJSNamedNodeMap; external name 'attributes';\r\n    FChildElementCount : NativeInt; external name 'childElementCount';\r\n    FChildren : TJSHTMLCollection; external name 'children';\r\n    FClassList : TJSDOMTokenList; external name 'classList';\r\n    FCLientHeight : NativeInt; external name 'clientHeight';\r\n    FCLientLeft : NativeInt; external name 'clientLeft';\r\n    FCLientTop : NativeInt; external name 'clientTop';\r\n    FCLientWidth : NativeInt; external name 'clientWidth';\r\n    FFirstElementChild : TJSElement; external name 'firstElementChild';\r\n    FLastElementChild : TJSElement; external name 'lastElementChild';\r\n    FLocalName : string; external name 'localName';\r\n    FNameSpaceURI : String; external name 'namespaceURI';\r\n    FNextElementSibling : TJSElement; external name 'nextElementSibling';\r\n    FPreviousElementSibling : TJSElement; external name 'previousElementSibling';\r\n    FPrefix : String; external name 'prefix';\r\n    FScrollHeight : NativeInt; external name 'scrollHeight';\r\n{$IFDEF FIREFOX}\r\n    FScrollLeftMax : NativeInt; external name 'scrollLeftMax';\r\n    FScrollTopMax : NativeInt; external name 'scrollTopMax';\r\n{$endif}\r\n    FScrollWidth : NativeInt; external name 'scrollWidth';\r\n    FTagName : string; external name 'tagName';\r\n  Public\r\n    name : string;\r\n    className : string;\r\n    id : string;\r\n    innerHTML : String;\r\n    outerHTML : string;\r\n    scrollLeft : NativeInt;\r\n    scrollTop : NativeInt;\r\n    procedure append(aText : String); overload;\r\n    procedure append(aNode : TJSElement); overload;\r\n    procedure append(aText : String; aNode : TJSElement); varargs; overload;\r\n    procedure append(aNode1,aNode2: TJSElement); varargs; overload;\r\n    function getAttribute(aName : string) : string;\r\n    function getAttributeNode(aName : string) : TJSAttr;\r\n    function getAttributeNodeNS(aNameSpace, aName : string) : TJSAttr;\r\n    function getAttributeNS(aNameSpace, aName : string) : string;\r\n    function getBoundingClientRect : TJSDOMRect;\r\n    function getClientRects : TJSClientRectArray;\r\n    function getElementsByClassName(aClassName: string) : TJSHTMLCollection;\r\n    function getElementsByTagNameNS(aNameSpace, aTagName : String): TJSHTMLCollection;\r\n    function getElementsByTagName(aTagName : String): TJSHTMLCollection;\r\n    function hasAttribute(aName : String) : Boolean;\r\n    function hasAttributeNS(aNameSpace,aName : String) : Boolean;\r\n    function hasAttributes : Boolean;\r\n    function insertAdjacentElement(aPosition : string; aElement : TJSElement) : TJSElement;\r\n    procedure insertAdjacentHTML(aPosition,aHTML : string);\r\n    procedure insertAdjacentText(aPosition,aText : string);\r\n    function matches(aSelectorString : String) : Boolean;\r\n    function querySelector(aSelectors : String) : TJSElement;\r\n    function querySelectorAll(aSelectors : String) : TJSNodeList;\r\n    procedure releasePointerCapture(evID : JSValue);\r\n    procedure removeAttribute(aName: string);\r\n    procedure removeAttributeNS(aNameSpace,aName: string);\r\n    function removeAttributeNode(aAttr : TJSAttr) : TJSAttr;\r\n    procedure setAttribute(aName : string; AValue : String);\r\n    function setAttributeNode(aNode: TJSAttr) : TJSAttr;\r\n    function setAttributeNodeNS(aNode: TJSAttr) : TJSAttr;\r\n    procedure setAttributeNS(aNameSpace,aName : string; AValue : String);\r\n    procedure setCapture(retargetToElement : Boolean);\r\n    procedure setPointerCapture(pointerID : JSValue);\r\n    procedure requestFullScreen;    \r\n    Property attributes : TJSNamedNodeMap read FAttributes;\r\n    Property childElementCount : NativeInt Read FChildElementCount;\r\n    Property children : TJSHTMLCollection Read FChildren;\r\n    Property classList : TJSDOMTokenList read FClassList;\r\n    property clientHeight : NativeInt read FClientHeight;\r\n    property clientLeft : NativeInt read FClientLeft;\r\n    property clientTop : NativeInt read FClientTop;\r\n    property clientWidth : NativeInt read FClientWidth;\r\n    property firstElementChild : TJSElement Read FFirstElementChild;\r\n    property lastElementChild : TJSElement Read FLastElementChild;\r\n    property localName : string Read FLocalName;\r\n    property namespaceURI : String read FNameSpaceURI;\r\n    property nextElementSibling : TJSElement Read FNextElementSibling;\r\n    property previousElementSibling : TJSElement Read FPreviousElementSibling;\r\n    property prefix : String read FPrefix;\r\n    property scrollHeight : NativeInt Read FScrollHeight;\r\n{$IFDEF FIREFOX}\r\n    property scrollLeftMax  : NativeInt Read FScrollLeftMax;\r\n    property scrollTopMax  : NativeInt Read FScrollTopMax;\r\n{$ENDIF}\r\n    property scrollWidth : NativeInt Read FScrollWidth;\r\n    property tagName : String read FTagName;\r\n    Property Attrs[aName : string] : String read getAttribute write setAttribute; default;\r\n  end;\r\n   \r\n  TJSElementCreationOptions = record\r\n    named : string;\r\n  end;\r\n \r\n  TJSDocumentType = class external name 'DocumentType' (TJSNode)\r\n  private\r\n    FName : String; external name 'name';\r\n    FPublicID : String; external name 'publicId';\r\n    FSystemID : String; external name 'systemId';\r\n  public\r\n    property name : String read FName;\r\n    property publicId : String Read FPublicID;\r\n    property systemId : String read FSystemID;\r\n  end;\r\n\r\n  TJSDOMImplementation  = class external name 'DocumentImplementation'  (TJSObject)\r\n  Public  \r\n    function createDocument(aNamespaceURI, aQualifiedNameStr : String; aDocumentType : TJSDocumentType) : TJSDocument;\r\n    function createDocumentType(aQualifiedNameStr,aPublicId,aSystemId : String) : TJSDocumentType;\r\n    function createHTMLDocument(aTitle : String) : TJSDocument;\r\n  end;\r\n\r\n  TJSLocation = class external name 'Location'  (TJSObject)\r\n  Private\r\n    FOrigin : string;\r\n  Public\r\n    hash : string;\r\n    host : string;\r\n    hostname : string;\r\n    href : string;\r\n    password : string;\r\n    pathname : string;\r\n    port : string;\r\n    protocol : string;\r\n    search : string;\r\n    username : string;\r\n    procedure assign(aURL : String); overload;\r\n    procedure reload(aForce : Boolean);\r\n    procedure replace(aURL : String);\r\n    property origin : string read FOrigin;\r\n  end;\r\n  \r\n  TJSStyleSheet = class external name 'StyleSheet' (TJSEventTarget)\r\n  Private\r\n    FHRef : String; external name 'href';\r\n    FOwnerNode : TJSNode; external name 'ownerNode';\r\n    FParentStyleSheet : TJSStyleSheet; external name 'parentStyleSheet';\r\n    FTitle : String; external name 'title';\r\n    FType : String; external name 'type';\r\n  Public\r\n    disabled : String;\r\n    Property href : String read FHRef;\r\n    property ownerNode : TJSNode Read FOwnerNode;\r\n    property parentStyleSheet : TJSStyleSheet read FParentStyleSheet;\r\n    property title : string Read FTitle;\r\n    property _type : String read FType;\r\n  end;\r\n\r\n\r\n  TJSCSSRule = class external name 'CSSRule'  (TJSObject)\r\n  Private\r\n    FCSSText : String; external name 'cssText';\r\n    FParentStyleSheet : TJSCSSStyleSheet; external name 'parentStyleSheet';\r\n    FparentRule : TJSCSSRule; external name 'parentRule';\r\n  Public\r\n    property cssText : String Read FCSSText;\r\n    property parentRule : TJSCSSRule read FparentRule;\r\n    property parentStyleSheet : TJSCSSStyleSheet Read FParentStyleSheet;\r\n  end;\r\n  \r\n  TJSCSSRuleList = Class external name 'CSSRuleList'  (TJSObject)\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  Public\r\n    function item(index : NativeInt) : TJSCSSRule;\r\n    property length : NativeInt Read FLength;\r\n    Property items[aIndex : NativeInt] : TJSCSSRule read item; default;\r\n  end;\r\n  \r\n  \r\n  TJSCSSStyleSheet = class external name 'CSSStyleSheet' (TJSStyleSheet)\r\n  Private\r\n    FCSSRules : TJSCSSRuleList; external name 'cssRules';\r\n  Public\r\n    procedure deleteRule(aIndex : NativeInt);\r\n    function insertRule(aRule : String; aIndex : NativeInt) : NativeInt;\r\n    Property cssRules : TJSCSSRuleList read FCSSRules;\r\n  end;\r\n\r\n  TJSStyleSheetList = Class external name 'StyleSheetList'  (TJSObject)\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  Public\r\n    function item(index : NativeInt) : TJSStyleSheet;\r\n    property length : NativeInt Read FLength;\r\n    Property items[aIndex : NativeInt] : TJSStyleSheet read item; default;\r\n  end;\r\n\r\n  { TJSDocumentFragment }\r\n\r\n  TJSDocumentFragment = Class external name 'DocumentFragment' (TJSNode)\r\n  private\r\n    FchildElementCount: Integer; external name 'childElementCount';\r\n    Fchildren: TJSHTMLCollection; external name 'children';\r\n    FfirstElementChild: TJSElement; external name 'firstElementChild';\r\n    FlastElementChild: TJSElement; external name 'lastElementChild';\r\n  public\r\n    constructor new;\r\n    function querySelector(aSelector : String) : TJSElement;\r\n    function querySelectorAll(aSelector : String) : TJSNodeList;\r\n    property childElementCount : Integer read FchildElementCount;\r\n    property children : TJSHTMLCollection read Fchildren;\r\n    property firstElementChild : TJSElement read FfirstElementChild;\r\n    property lastElementChild : TJSElement read FlastElementChild;\r\n  end;\r\n\r\n  TJSEventInit = record\r\n    bubbles : boolean;\r\n    cancelable : boolean;\r\n    scoped : boolean;\r\n    composed : boolean;\r\n  end;\r\n\r\n  TJSEvent = class external name 'Event'  (TJSObject)\r\n  Private\r\n    FBubbles : Boolean; external name 'bubbles';\r\n    FCancelable : Boolean; external name 'cancelable';\r\n    FComposed : Boolean; external name 'composed';\r\n    FCurrentTarget : TJSElement; external name 'currentTarget';\r\n    FdefaultPrevented : Boolean; external name 'defaultPrevented';\r\n    FEventPhase : NativeInt; external name 'eventPhase';\r\n    FTarget : TJSElement; external name 'target';\r\n    FTimeStamp : NativeInt; external name 'timestamp';\r\n    FType : String; external name 'type';\r\n    FIsTrusted : Boolean; external name 'isTrusted';\r\n  Public\r\n    Const\r\n      NONE = 0;\r\n      CAPTURING_PHASE = 1;\r\n      AT_TARGET  = 2;\r\n      BUBBLING_PHASE = 3;\r\n  public    \r\n    cancelBubble : Boolean;\r\n    constructor new (aType : String; const aInit : TJSEventInit); overload;\r\n    constructor new (aType : String); overload;\r\n    procedure preventDefault;\r\n    procedure stopImmediatePropagation;\r\n    procedure stopPropagation;\r\n    Property bubbles : Boolean Read FBubbles;\r\n    Property cancelable : Boolean Read FCancelable;\r\n    Property composed : Boolean Read FComposed;\r\n    property currentTarget : TJSElement Read FCurrentTarget;\r\n    property defaultPrevented : Boolean Read FdefaultPrevented;\r\n    property eventPhase : NativeInt Read FEventPhase;\r\n    property target : TJSElement Read FTarget;\r\n    Property timestamp : NativeInt Read FTimeStamp;\r\n    property _type : string read FType;\r\n    property isTrusted : Boolean Read FIsTrusted;\r\n  end;\r\n\r\n\r\n  TJSXPathExpression = class external name 'XPathExpression'  (TJSObject)\r\n  Public\r\n    function evaluate(contextNode : TJSNode; aType : NativeInt; aResult : TJSXPathResult) : TJSXPathResult;\r\n    function evaluateWithContext(contextNode : TJSNode; aPosition, aSize, aType : NativeInt; aResult : TJSXPathResult) : TJSXPathResult;\r\n  end;\r\n\r\n  TJSXPathNSResolver = class external name 'XPathNSResolver'  (TJSObject)\r\n  Public\r\n    function lookupNamespaceURI(prefix : string) : string;\r\n  end;\r\n\r\n  { TJSCharacterData }\r\n\r\n  TJSCharacterData = class external name 'CharacterData' (TJSNode)\r\n  private\r\n    FnextElementSibling: TJSElement; external name 'nextElementSibling';\r\n    FpreviousElementSibling: TJSElement; external name 'previousElementSibling';\r\n  public\r\n    property nextElementSibling : TJSElement read FnextElementSibling;\r\n    property previousElementSibling : TJSElement read FpreviousElementSibling;\r\n  end;\r\n\r\n  TJSProcessingInstruction = class external name 'ProcessingInstruction' (TJSCharacterData);\r\n\r\n  { TJSRange }\r\n\r\n  TJSRange = class external name 'Range'  (TJSObject)\r\n  private\r\n    FCollapsed: boolean; external name 'collapsed';\r\n    FcommonAncestorContainer: TJSNode; external name 'commonAncestorContainer';\r\n    FendContainer: TJSNode; external name 'endContainer';\r\n    FEndOffset: NativeInt; external name 'endOffset';\r\n    FstartContainer: TJSNode; external name 'startContainer';\r\n    FstartOffset: NativeInt; external name 'startOffset';\r\n  Public\r\n    const\r\n      END_TO_END     = 0;\r\n      END_TO_START   = 1;\r\n      START_TO_END   = 2;\r\n      START_TO_START = 3;\r\n  Public\r\n    constructor new;\r\n    function cloneContents : TJSDocumentFragment;\r\n    function cloneRange : TJSRange;\r\n    procedure collapse;\r\n    function compareBoundaryPoints(aHow : NativeInt) : NativeInt;\r\n    function createContextualFragment(aTagstring : String) : TJSDocumentFragment;\r\n    procedure deleteContents;\r\n    procedure detach;\r\n    function extractContents : TJSDocumentFragment;\r\n    procedure insertNode(aNode : TJSNode);\r\n    procedure selectNode(aNode : TJSNode);\r\n    procedure selectNodeContents(aNode : TJSNode);\r\n    procedure setEnd(aEndNode : TJSNode; aEndOffset : NativeInt); \r\n    procedure setEndAfter(aEndNode : TJSNode);\r\n    procedure setEndBefore(aEndNode : TJSNode);\r\n    procedure setStart(aStartNode : TJSNode; aStartOffset : NativeInt); \r\n    procedure setStartAfter(aStartNode : TJSNode);\r\n    procedure setStartBefore(aStartNode : TJSNode);\r\n    procedure surroundContents(aNode : TJSNode);\r\n    property collapsed : boolean read FCollapsed;\r\n    property commonAncestorContainer : TJSNode read FcommonAncestorContainer ;\r\n    property endContainer : TJSNode read FendContainer;\r\n    property endOffset : NativeInt Read FEndOffset;\r\n    property startContainer : TJSNode read FstartContainer;\r\n    property startOffset : NativeInt Read FstartOffset;\r\n  end;\r\n\r\n\r\n  { TJSTreeWalker }\r\n\r\n  TJSTreeWalker = class external name 'TreeWalker' (TJSObject)\r\n  private\r\n    FCurrentNode: TJSNode; external name 'currentNode';\r\n    FexpandEntityReference: Boolean; external name 'expandEntityReference';\r\n    FFilter: TJSNodeFilter; external name 'filter';\r\n    FRoot: TJSNode; external name 'root';\r\n    FWhatToShow: NativeInt; external name 'whatToShow';\r\n  Public\r\n    function firstChild : TJSNode;\r\n    function lastChild : TJSNode;\r\n    function nextNode : TJSNode;\r\n    function nextSibling : TJSNode;\r\n    function parentNode : TJSNode;\r\n    function previousNode : TJSNode;\r\n    function previousSibling : TJSNode;\r\n\r\n    property root : TJSNode read FRoot;\r\n    property whatToShow : NativeInt read FWhatToShow;\r\n    property filter : TJSNodeFilter Read FFilter;\r\n    property expandEntityReference : Boolean Read FexpandEntityReference;\r\n    property currentNode : TJSNode Read FCurrentNode;\r\n  end;\r\n\r\n  TJSNodeFilter = class external name 'NodeFilter'  (TJSObject)\r\n    const\r\n      SHOW_ALL                    = -1;\r\n      SHOW_ATTRIBUTE              = 2;\r\n      SHOW_CDATA_SECTION          = 8;\r\n      SHOW_COMMENT                = 128;\r\n      SHOW_DOCUMENT               = 256;\r\n      SHOW_DOCUMENT_FRAGMENT      = 1024;\r\n      SHOW_DOCUMENT_TYPE          = 512;\r\n      SHOW_ELEMENT                = 1;\r\n      SHOW_ENTITY                 = 32;\r\n      SHOW_ENTITY_REFERENCE       = 16;\r\n      SHOW_NOTATION               = 2048;\r\n      SHOW_PROCESSING_INSTRUCTION = 64;\r\n      SHOW_TEXT                   = 4;\r\n    function acceptNode (aNode : TJSNode) : NativeInt;\r\n  end;\r\n\r\n  TJSXPathResult = class external name 'XPathResult'  (TJSObject)\r\n  private\r\n    FBooleanValue : Boolean; external name 'booleanValue';\r\n    FNumberValue : Double; external name 'numberValue';\r\n    FResultType : NativeInt; external name 'resultType';\r\n    FSingleNodeValue : TJSNode;  external name 'singleNodeValue';\r\n    FSnaphotLength : NativeInt; external name 'snapshotLength';\r\n    FStringValue : String; external name 'stringValue';\r\n  public  \r\n    Function iterateNext : TJSNode;\r\n    Function snapshotItem(Index: NativeInt) : TJSNode;\r\n    Property booleanValue : Boolean Read FBooleanValue;\r\n    Property numberValue : Double Read FNumberValue;\r\n    property resultType : NativeInt Read FResultType;\r\n    Property singleNodeValue : TJSNode Read FSingleNodeValue;\r\n    property snapshotLength : NativeInt read FSnaphotLength;\r\n    property stringValue : String Read FStringValue;\r\n  end;\r\n\r\n  TJSSelection = class external name 'Selection'  (TJSObject)\r\n  Private\r\n    FanchorNode : TJSNode ; external name 'anchorNode';\r\n    FanchorOffset : NativeInt ; external name 'anchorOffset';\r\n    FfocusNode : TJSNode ; external name 'focusNode';\r\n    FfocusOffset : NativeInt ; external name 'focusOffset';\r\n    FisCollapsed : Boolean ; external name 'isCollapsed';\r\n    FrangeCount : NativeInt ; external name 'rangeCount';\r\n    Ftype : String ; external name 'type';\r\n  Public\r\n    function getRangeAt(aIndex : NativeInt) : TJSRange;\r\n    procedure collapse(aParentNode : TJSNode; Offset : NativeInt);\r\n    procedure extend(aParentNode : TJSNode; Offset : NativeInt);\r\n    procedure collapseToStart;\r\n    procedure collapseToEnd;\r\n    procedure selectAllChildren(aParentNode : TJSNode);\r\n    procedure addRange(aRange : TJSRange);\r\n    procedure removeRange(aRange : TJSRange);\r\n    procedure removeAllRanges;\r\n    procedure deleteFromDocument;\r\n    function containsNode(aNode : TJSNode; aPartlyContained : Boolean) : Boolean;\r\n    procedure setBaseAndExtent(aAnchorNode : TJSNode; aAnchorOffset : NativeInt; aFocusNode : TJSNode; aFocusOffset : NativeInt);\r\n    property anchorNode : TJSNode read FAnchorNode;\r\n    property anchorOffset : NativeInt read FAnchorOffset;\r\n    property focusNode : TJSNode read FFocusNode;\r\n    property focusOffset : NativeInt read FFocusOffset;\r\n    property isCollapsed : Boolean read FIsCollapsed;\r\n    property rangeCount : NativeInt read FRangeCount;\r\n    property _type : String Read FType;\r\n  end;\r\n  TJSNameSpaceMapperCallback = function (aNameSpace : string ) : String;\r\n\r\n  TJSHTMLFile = class;\r\n  TJSHTMLFileList = Class;\r\n\r\n  { TJSDataTransferItem }\r\n\r\n  TJSDataTransferItemCallBack = reference to Procedure(aData : String);\r\n\r\n  TJSDataTransferItem = class external name 'DataTransferItem'  (TJSObject)\r\n  private\r\n    FKind: String; external name 'kind';\r\n    FType: string; external name 'type';\r\n  Public\r\n    function getAsFile : TJSHTMLFile;\r\n    Procedure getAsString(aCallBack : TJSDataTransferItemCallBack);\r\n    property Kind : String read FKind;\r\n    property _Type : string read FType;\r\n  end;\r\n\r\n  TJSDataTransferItemList = class external name 'DataTransferItemList'  (TJSObject)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n    function getitem(aIndex : nativeInt) : TJSDataTransferItem ; external name '[]';\r\n  Public\r\n    Function add(aData : string; AType: string) : TJSDataTransferItem; overload;\r\n    Function add(aFile : TJSHTMLFile) : TJSDataTransferItem; overload;\r\n    Procedure clear;\r\n    procedure remove(aIndex : integer);\r\n    property length : NativeInt read FLength;\r\n    property Items[aIndex : NativeInt] : TJSDataTransferItem Read getitem; default;\r\n  end;\r\n\r\n  { TJSDataTransfer }\r\n\r\n  TJSDataTransfer = class external name 'DataTransfer'  (TJSObject)\r\n  private\r\n    FFiles: TJSHTMLFileList; external name 'files';\r\n    FItems: TJSDataTransferItemList; external name 'items';\r\n    FTypes: TJSStringDynArray; external name 'types';\r\n  Public\r\n    dropEffect : string;\r\n    effectAllowed : string;\r\n    Procedure clearData; overload;\r\n    Procedure clearData(aFormat : string); overload;\r\n    function getData(aFormat : string) : String;\r\n    procedure setData(aFormat : String; aData : String);\r\n    procedure setDragImage(aImage: TJSElement; xOffset,yOffset : integer);\r\n    property files : TJSHTMLFileList Read FFiles;\r\n    property items : TJSDataTransferItemList read FItems;\r\n    property types : TJSStringDynArray read FTypes;\r\n  end;\r\n\r\n  { TJSDragEvent }\r\n\r\n  TJSDragEvent = class external name 'DragEvent' (TJSEvent)\r\n  Private\r\n    FDataTransfer: TJSDataTransfer; external name 'dataTransfer';\r\n    FrelatedTarget : TJSEventTarget external name 'relatedTarget';\r\n    FscreenX : NativeInt external name 'screenX';\r\n    FscreenY : NativeInt external name 'screenY';\r\n    FclientX : NativeInt external name 'clientX';\r\n    FclientY : NativeInt external name 'clientY';\r\n    Fbutton : NativeInt external name 'button';\r\n    Fbuttons : NativeInt external name 'buttons';\r\n    FctrlKey : Boolean external name 'ctrlKey';\r\n    FshiftKey : Boolean external name 'shiftKey';\r\n    FaltKey  : Boolean external name 'altKey';\r\n    FmetaKey  : Boolean external name 'metaKey';\r\n  Public\r\n    Property relatedTarget : TJSEventTarget Read FRelatedTarget;\r\n    Property screenX : NativeInt Read FScreenX;\r\n    Property screenY : NativeInt Read FScreenY;\r\n    Property clientX : NativeInt Read FClientX;\r\n    Property clientY : NativeInt Read FClientY;\r\n    Property button : NativeInt Read FButton;\r\n    Property buttons : NativeInt Read FButtons;\r\n    Property ctrlKey : Boolean Read FctrlKey;\r\n    Property shiftKey : Boolean Read FshiftKey;\r\n    Property altKey  : Boolean Read FaltKey;\r\n    Property metaKey  : Boolean Read FmetaKey;\r\n    property dataTransfer : TJSDataTransfer Read FDataTransfer;\r\n  end;\r\n  TJSDragDropEventHandler = reference to function(aEvent: TJSDragEvent) : Boolean;\r\n  THTMLClickEventHandler = reference to function(aEvent : TJSMouseEvent) : boolean;\r\n  { Various events }\r\n\r\n{$IFNDEF FIREFOX}\r\n  TJSFocusEvent = TJSEvent;\r\n{$ELSE}\r\n  TJSFocusEvent = Class(TJSEvent)\r\n  private\r\n    FrelatedTarget : TJSElement external name 'relatedTarget';\r\n  public\r\n    property relatedTarget : TJSElement Read FrelatedTarget;\r\n  end;\r\n{$ENDIF}\r\n  TJSAnimationEvent = Class(TJSEvent);\r\n  TJSLoadEvent = Class(TJSEvent);\r\n\r\n  TJSErrorEvent = class external name 'ErrorEvent' (TJSEvent)\r\n  Private\r\n    Fmessage : String external name 'message';\r\n    Ffilename : string external name 'filename';\r\n    Flineno : integer external name 'lineno';\r\n    Fcolno : integer external name 'colno';\r\n    Ferror : TJSObject external name 'error';\r\n  Public\r\n    Property message : String read FMessage;\r\n    property filename : string Read FFileName;\r\n    property lineno : integer read FLineNo;\r\n    Property colno : integer read FColNo;\r\n    Property error : TJSObject read FError;\r\n  end;\r\n\r\n  TJSPageTransitionEvent = class(TJSEvent)\r\n  end;\r\n\r\n  TJSHashChangeEvent = class external name 'HashChangeEvent' (TJSEvent)\r\n  Private\r\n    FnewURL : String external name 'newURL';\r\n    FoldURL : String external name 'oldURL';\r\n  public\r\n    property newURL : String Read FNewURL;\r\n    property oldURL : String Read FOldURL;\r\n  end;\r\n\r\n  TJSPopStateEvent = class external name 'PopStateEvent'  (TJSEvent)\r\n  Private\r\n    FState : JSValue; external name 'state';\r\n  Public\r\n    property state : JSValue read FState;\r\n  end;\r\n\r\n  TJSStorageEvent = class external name 'StorageEvent' (TJSEvent)\r\n  private\r\n    Fkey : String external name 'key';\r\n    FoldValue : String external name 'oldValue';\r\n    FnewValue : String external name 'newValue';\r\n    Furl : String external name 'url';\r\n    FstorageArea : String external name 'storageArea';\r\n  public\r\n    Property key : String Read FKey;\r\n    Property oldValue : String Read FOldValue;\r\n    Property newValue : String Read FNewValue;\r\n    Property url : String Read FURL;\r\n    Property storageArea : String Read FstorageArea;\r\n  end;\r\n\r\n  { TJSProgressEvent }\r\n\r\n  TJSProgressEvent = class external name 'ProgressEvent' (TJSEvent)\r\n  Private\r\n    FlengthComputable : Boolean external name 'lengthComputable';\r\n    Floaded : NativeUINT external name 'loaded';\r\n    FTotal : NativeUINT external name 'Total';\r\n  Public\r\n    property lengthComputable : Boolean Read FlengthComputable;\r\n    property loaded : NativeUINT Read FLoaded;\r\n    property Total : NativeUINT Read FTotal;\r\n  end;\r\n\r\n  TJSPageTransitionEventHandler = reference to function(aEvent : TJsPageTransitionEvent) : boolean;\r\n  TJSHashChangeEventhandler = reference to function(aEvent : TJSHashChangeEvent) : boolean;\r\n  TJSMouseWheelEventHandler = reference to function(aEvent : TJSWheelEvent) : boolean;\r\n  TJSMouseEventHandler = reference to function(aEvent : TJSMouseEvent) : boolean;\r\n  THTMLAnimationEventHandler = reference to function(aEvent : TJSAnimationEvent) : boolean;\r\n  TJSErrorEventHandler = reference to function(aEvent : TJSErrorEvent) : boolean;\r\n  TJSFocusEventHandler = reference to function(aEvent : TJSFocusEvent) : boolean;\r\n  TJSKeyEventhandler = reference to function (aEvent : TJSKeyBoardEvent) : boolean;\r\n  TJSLoadEventhandler = reference to function (aEvent : TJSLoadEvent) : boolean;\r\n  TJSPointerEventHandler = reference to function(aEvent : TJSPointerEvent) : boolean;\r\n  TJSUIEventHandler = reference to function(aEvent : TJSUIEvent) : Boolean;\r\n  TJSPopStateEventHandler = reference to function(aEvent : TJSPopStateEvent) : Boolean;\r\n  TJSStorageEventHandler = reference to function(aEvent : TJSStorageEvent) : Boolean;\r\n  TJSProgressEventhandler =  reference to function(aEvent : TJSProgressEvent) : Boolean;\r\n  TJSTouchEventHandler = reference to function(aEvent : TJSTouchEvent) : boolean;\r\n\r\n  TJSDocument = class external name 'Document' (TJSNode)\r\n  Private\r\n    fActiveElement : TJSElement; external name 'activeElement';\r\n    FCharacterSet: String; external name 'characterSet';\r\n    FChildElementCount: NativeInt; external name 'childElementCount';\r\n    FCompatMode: String; external name 'compatMode';\r\n    FCurrentScript: TJSElement; external name 'currentScript';\r\n    FDefaultView: TJSWindow; external name 'defaultView';\r\n    FDocType: TJSDocumentType; external name 'docrype';\r\n    FDocumentElement: TJSElement; external name 'documentElement';\r\n    FDocumentURI: String; external name 'documentURI';\r\n    FEmbeds: TJSHTMLCollection; external name 'embeds';\r\n    FFirstElementChild : TJSElement; external name 'firstElementChild';\r\n    FForms: TJSHTMLCollection; external name 'forms';\r\n    FFullScreenElement: TJSElement; external name 'fullscreenElement';\r\n    FFullscreenEnabled: Boolean; external name 'fullscreenEnabled';\r\n    FHead: TJSElement; external name 'head';\r\n    FHidden: Boolean; external name 'hidden';\r\n    FImages: TJSHTMLCollection; external name 'images';\r\n    FImplementation: TJSDOMImplementation; external name 'implementation';\r\n    FLastElementChild : TJSElement; external name 'lastElementChild';\r\n    FLastModified: String; external name 'lastModified';\r\n    FLastStyleSheetSet: String; external name 'lastStyleSheetSet';\r\n    FLinks: TJSHTMLCollection; external name 'links';\r\n    FLocation: TJSLocation; external name 'location';\r\n    FLocationString: String; external name 'location';\r\n    FPlugins: TJSHTMLCollection; external name 'plugins';\r\n    FPointerLockElement: TJSElement; external name 'pointerLockElement';\r\n    FPreferredStyleSheetSet: String; external name 'preferredStyleSheetSet';\r\n    FReadyState: String; external name 'readyState';\r\n    FReferrer: String; external name 'referrer';\r\n    FScripts: TJSHTMLCollection; external name 'scripts';\r\n    FStyleSheets: TJSStyleSheetList; external name 'styleSheets';\r\n    FStyleSheetSets: TJSValueDynArray; external name 'styleSheetSets';\r\n    FURL: String; external name 'URL';\r\n    FVisibilityState: string; external name 'visibilityState';\r\n  Public\r\n    function adoptNode(aExternalNode : TJSNode) : TJSNode;\r\n    procedure close;\r\n    function createAttribute(aName : string) : TJSAttr;\r\n    function createCDATASection(S : String) : TJSNode;\r\n    function createComment(S : String) : TJSNode;\r\n    function createDocumentFragment : TJSDocumentFragment;\r\n    function createElement(tagName : string) : TJSElement; overload;\r\n    function createElement(tagName : string; const options : TJSElementCreationOptions) : TJSElement; overload;\r\n    function createElementNS(aNameSpace,tagName : string) : TJSElement; overload;\r\n    function createElementNS(aNameSpace,tagName : string; const options : TJSElementCreationOptions) : TJSElement; overload;\r\n    function createEvent(aType : string) : TJSEvent;\r\n    function createExpression(xPathText : String; aNameSpaceMapper: TJSNameSpaceMapperCallback) : TJSXPathExpression;\r\n    function createNSResolver(aNode : TJSNode) : TJSXPathNSResolver;\r\n    function createProcessingInstruction(target, data : String) : TJSProcessingInstruction;\r\n    function createRange : TJSRange;\r\n    function createTextNode(S : String) : TJSNode;\r\n    function createTreeWalker(root : TJSNode; whatToShow : NativeInt; filter : TJSNodeFilter) : TJSTreeWalker;\r\n    function elementFromPoint(x,y : integer) : TJSElement;\r\n    procedure enableStyleSheetsForSet(aSet : String);\r\n    function evaluate(xpathExpression : String; ContextNode : TJSNode; NameSpaceResolver : TJSNamespaceMapperCallBack; resultType : NativeInt; aResult : TJSXPathResult) : TJSXPathResult;\r\n    function execCommand(aCommandName : String; aShowDefaultUI : Boolean; AValueArgument : String) : boolean; overload;\r\n    function execCommand(aCommandName : String; aShowDefaultUI : Boolean) : boolean; overload;\r\n    Procedure exitFullScreen;\r\n    function getElementById(aID : String) : TJSElement;\r\n    function getElementsByClassName(aNames : string) : TJSHTMLCollection;\r\n    function getElementsByName(aName : String) : TJSNodeList;\r\n    function getElementsByTagName(aName : String) : TJSHTMLCollection;\r\n    function getElementsByTagNameNS(aNameSpace,aName : String) : TJSHTMLCollection;\r\n    function getSelection : TJSSelection;\r\n    function hasFocus : boolean;\r\n    function importNode(aExternalNode : TJSNode; Deep: boolean) : TJSNode;\r\n    function querySelector(aSelectors : String) : TJSElement;\r\n    function querySelectorAll(aSelectors : String) : TJSNodeList;\r\n    procedure open;\r\n    procedure releaseCapture;\r\n    procedure write(aLine : string);\r\n    procedure writeln(aLine : String);\r\n  Public\r\n    body : TJSElement;\r\n    designMode : string;\r\n    dir : string;\r\n    domain : string;\r\n    selectedStyleSheetSet : string;\r\n    title : string;\r\n    onabort : TJSEventHandler;\r\n    onblur : TJSEventHandler;\r\n    oncancel : TJSEventHandler;\r\n    oncanplay : TJSEventHandler;\r\n    oncanplaythrough : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onclick: THTMLClickEventHandler;\r\n    onclose : TJSEventHandler;\r\n    oncontextmenu : TJSEventHandler;\r\n    oncuechange : TJSEventHandler;\r\n    ondblclick : THTMLClickEventHandler;\r\n    ondrag : TJSDragDropEventHandler;\r\n    ondragend : TJSDragDropEventHandler;\r\n    ondragenter : TJSDragDropEventHandler;\r\n    ondragexit : TJSDragDropEventHandler;\r\n    ondragover : TJSDragDropEventHandler;\r\n    ondragleave : TJSDragDropEventHandler;\r\n    ondragstart: TJSDragDropEventHandler;\r\n    ondrop : TJSDragDropEventHandler;\r\n    ondurationchange : TJSEventHandler;\r\n    onemptied : TJSEventHandler;\r\n    onended : TJSEventHandler;\r\n    onerror : TJSErrorEventHandler;\r\n    onfocus : TJSFocusEventhandler;\r\n    ongotpointercapture : TJSPointerEventHandler;\r\n    oninput : TJSEventhandler;\r\n    oninvalid : TJSEventhandler;\r\n    onkeydown : TJSKeyEventhandler;\r\n    onkeypress : TJSKeyEventhandler;\r\n    onkeyup : TJSKeyEventhandler;\r\n    onload : TJSEventhandler;\r\n    onloadeddata : TJSEventhandler;\r\n    onloadedmetadata : TJSEventhandler;\r\n    onloadend : TJSProgressEventhandler;\r\n    onloadstart : TJSProgressEventhandler;\r\n    onlostpointercapture : TJSPointerEventHandler;\r\n    onmessage : TJSEventHandler;\r\n    onmousedown : TJSMouseEventHandler;\r\n    onmouseenter : TJSMouseEventHandler;\r\n    onmouseleave : TJSMouseEventHandler;\r\n    onmousemove : TJSMouseEventHandler;\r\n    onmouseout : TJSMouseEventHandler;\r\n    onmouseover : TJSMouseEventHandler;\r\n    onmouseup : TJSMouseEventHandler;\r\n    onmousewheel : TJSMouseEventHandler;\r\n    onpause : TJSEventHandler;\r\n    onplay : TJSEventHandler;\r\n    onplaying : TJSEventHandler;\r\n    onpointercancel : TJSPointerEventHandler;\r\n    onpointerdown : TJSPointerEventHandler;\r\n    onpointerenter : TJSPointerEventHandler;\r\n    onpointerleave : TJSPointerEventHandler;\r\n    onpointermove : TJSPointerEventHandler;\r\n    onpointerout : TJSPointerEventHandler;\r\n    onpointerover : TJSPointerEventHandler;\r\n    onpointerup : TJSPointerEventHandler;\r\n    onpointerlockchange : TJSPointerEventHandler;\r\n    onprogress : TJSProgressEventhandler;\r\n    onreset : TJSUIEventHandler;\r\n    onratechange : TJSEventHandler;\r\n    onscroll : TJSUIEventHandler;\r\n    onseekend : TJSEventHandler;\r\n    onseeking : TJSEventHandler;\r\n    onselect : TJSEventHandler;\r\n    onselectionchange : TJSEventHandler;\r\n    onsshow : TJSEventHandler;\r\n    onsubmit : TJSEventHandler;\r\n    onunload : TJSUIEventHandler;\r\n    onwaiting : TJSEventHandler;\r\n    touchstart : TJSTouchEventHandler;\r\n    touchend : TJSTouchEventHandler;\r\n    touchmove : TJSTouchEventHandler;\r\n    touchcancel : TJSTouchEventHandler;\r\n    Property activeElement : TJSElement Read FActiveElement;\r\n    Property characterSet : String Read FCharacterSet;\r\n    property childElementCount : NativeInt Read FChildElementCount;\r\n    property compatMode : String Read FCompatMode;\r\n    property currentScript : TJSElement Read FCurrentScript;\r\n    property defaultView : TJSWindow Read FDefaultView;\r\n    property doctype : TJSDocumentType read FDocType;\r\n    property documentElement : TJSElement read FDocumentElement;\r\n    property documentURI : String Read FDocumentURI;\r\n    property embeds : TJSHTMLCollection Read FEmbeds;\r\n    property firstElementChild : TJSElement Read FFirstElementChild;\r\n    property lastElementChild : TJSElement Read FLastElementChild;\r\n    property Forms : TJSHTMLCollection Read FForms;\r\n    property fullscreenElement : TJSElement Read FFullScreenElement;\r\n    property fullscreenEnabled : Boolean Read FFullscreenEnabled;\r\n    property head : TJSElement read FHead;\r\n    Property hidden : Boolean read FHidden;\r\n    property images : TJSHTMLCollection Read FImages;\r\n    property _implementation : TJSDOMImplementation Read FImplementation;\r\n    property lastModified : String Read FLastModified;\r\n    property lastStyleSheetSet : String read FLastStyleSheetSet;\r\n    property links : TJSHTMLCollection Read FLinks;\r\n    property location : TJSLocation read FLocation;\r\n    Property LocationString : String Read FURL Write FLocationString; // On purpose\r\n    property plugins : TJSHTMLCollection Read FPlugins;\r\n    property pointerLockElement : TJSElement Read FPointerLockElement;\r\n    property preferredStyleSheetSet : String Read FPreferredStyleSheetSet;\r\n    Property readyState : String Read FReadyState;\r\n    Property referrer : String Read FReferrer;\r\n    property scripts : TJSHTMLCollection Read FScripts;\r\n    property styleSheets : TJSStyleSheetList Read FStyleSheets;\r\n    property styleSheetSets : TJSValueDynArray Read FStyleSheetSets; // No type documented ?\r\n    Property URL : String Read FURL;\r\n    property visibilityState : string read FVisibilityState;\r\n  end;\r\n\r\n  TJSConsole = class external name 'Console'  (TJSObject)\r\n  Public\r\n    procedure assert(anAssertion : string; Obj1 : JSValue); varargs;\r\n    Procedure clear;  \r\n    procedure count; overload;\r\n    procedure count(aCounter : String);\r\n    procedure error(Obj1 : JSValue); varargs;\r\n    procedure group; overload;\r\n    procedure group(aLabel : String); overload;\r\n    procedure groupCollapsed; overload;\r\n    procedure groupCollapsed(aLabel : String);overload;\r\n    procedure groupEnd;\r\n    procedure info(Obj1 : JSValue); varargs;\r\n    procedure log(Obj1 : JSValue); varargs;\r\n    procedure table(args: array of JSValue); overload;\r\n    procedure table(args: array of JSValue; Columns : Array of string);\r\n    procedure table(args: TJSObject); overload;\r\n    procedure table(args: TJSObject; Columns : Array of string); overload;\r\n    procedure time(aName : string);\r\n    procedure timeEnd(aName : string);\r\n    procedure trace;\r\n    procedure warn(Obj1 : JSValue); varargs;\r\n  end;\r\n\r\n//  TJSBufferSource = class external name 'BufferSource' end;\r\n//  TJSTypedArray = class external name 'TypedArray' end;\r\n\r\n  // Forward class definitions\r\n  TJSCryptoKey = Class;\r\n  TJSSubtleCrypto = Class;\r\n  KeyType = String;\r\n  KeyUsage = String;\r\n  NamedCurve = String;\r\n  BigInteger = TJSUint8Array;\r\n  KeyFormat = String;\r\n  // Union of object, DOMString\r\n  AlgorithmIdentifier = JSValue; \r\n  \r\n  { --------------------------------------------------------------------\r\n    Algorithm\r\n    --------------------------------------------------------------------}\r\n  \r\n  Algorithm = record\r\n    name : String;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    AesCbcParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  AesCbcParams = record\r\n    iv : TJSBufferSource;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    AesCtrParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  AesCtrParams = record\r\n    counter : TJSBufferSource;\r\n    length_ : Byte;external name 'length';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    AesGcmParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  AesGcmParams = record\r\n    iv : TJSBufferSource;\r\n    additionalData : TJSBufferSource;\r\n    tagLength : Byte;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    HmacImportParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  HmacImportParams = record\r\n    hash : AlgorithmIdentifier;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    Pbkdf2Params\r\n    --------------------------------------------------------------------}\r\n  \r\n  Pbkdf2Params = record\r\n    salt : TJSBufferSource;\r\n    iterations : NativeInt;\r\n    hash : AlgorithmIdentifier;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    RsaHashedImportParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  RsaHashedImportParams = record\r\n    hash : AlgorithmIdentifier;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    AesKeyGenParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  AesKeyGenParams = record\r\n    length_ : Integer;external name 'length';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    HmacKeyGenParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  HmacKeyGenParams = record\r\n    hash : AlgorithmIdentifier;\r\n    length_ : Integer;external name 'length';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    RsaHashedKeyGenParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  RsaHashedKeyGenParams = record\r\n    modulusLength : Integer;\r\n    publicExponent : BigInteger;\r\n    hash : AlgorithmIdentifier;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    RsaOaepParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  RsaOaepParams = record\r\n    label_ : TJSBufferSource;external name 'label';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    RsaPssParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  RsaPssParams = record\r\n    saltLength : Integer;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    DhKeyGenParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  DhKeyGenParams = record\r\n    prime : BigInteger;\r\n    generator : BigInteger;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    EcKeyGenParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  EcKeyGenParams = record\r\n    _namedCurve : NamedCurve;external name 'namedCurve';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    AesDerivedKeyParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  AesDerivedKeyParams = record\r\n    length_ : Integer;external name 'length';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    HmacDerivedKeyParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  HmacDerivedKeyParams = record\r\n    length_ : Integer;external name 'length';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    EcdhKeyDeriveParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  EcdhKeyDeriveParams = record\r\n    public_ : TJSCryptoKey; external name 'public';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    DhKeyDeriveParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  DhKeyDeriveParams = record\r\n    public_ : TJSCryptoKey;  external name 'public';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    DhImportKeyParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  DhImportKeyParams = record\r\n    prime : BigInteger;\r\n    generator : BigInteger;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    EcdsaParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  EcdsaParams = record\r\n    hash : AlgorithmIdentifier;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    EcKeyImportParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  EcKeyImportParams = record\r\n    _namedCurve : NamedCurve;external name 'namedCurve';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    HkdfParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  HkdfParams = record\r\n    hash : AlgorithmIdentifier;\r\n    salt : TJSBufferSource;\r\n    info : TJSBufferSource;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    RsaOtherPrimesInfo\r\n    --------------------------------------------------------------------}\r\n  \r\n  RsaOtherPrimesInfo = record\r\n    r : String;\r\n    d : String;\r\n    t : String;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    JsonWebKey\r\n    --------------------------------------------------------------------}\r\n  \r\n  TStringDynArray = Array of String;\r\n  TRsaOtherPrimesInfoDynArray = Array of RsaOtherPrimesInfo;\r\n  JsonWebKey = record\r\n    kty : String;\r\n    use : String;\r\n    key_ops : TStringDynArray;\r\n    alg : String;\r\n    ext : boolean;\r\n    crv : String;\r\n    x : String;\r\n    y : String;\r\n    d : String;\r\n    n : String;\r\n    e : String;\r\n    p : String;\r\n    q : String;\r\n    dp : String;\r\n    dq : String;\r\n    qi : String;\r\n    oth : TRsaOtherPrimesInfoDynArray;\r\n    k : String;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    CryptoKeyPair\r\n    --------------------------------------------------------------------}\r\n  \r\n  CryptoKeyPair = record\r\n    publicKey : TJSCryptoKey;\r\n    privateKey : TJSCryptoKey;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    TJSCryptoKey\r\n    --------------------------------------------------------------------}\r\n  \r\n  TKeyUsageDynArray = Array of KeyUsage;\r\n  TJSCryptoKey = class external name 'CryptoKey' \r\n  Private\r\n    Ftype_ : KeyType; external name 'type'; \r\n    Fextractable : boolean; external name 'extractable'; \r\n    Falgorithm : TJSObject; external name 'algorithm'; \r\n    Fusages : TKeyUsageDynArray; external name 'usages'; \r\n  Public\r\n    \r\n    Property type_ : KeyType Read Ftype_; \r\n    Property extractable : boolean Read Fextractable; \r\n    Property algorithm : TJSObject Read Falgorithm; \r\n    Property usages : TKeyUsageDynArray Read Fusages; \r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    TJSSubtleCrypto\r\n    --------------------------------------------------------------------}\r\n  \r\n  TJSSubtleCrypto = class external name 'SubtleCrypto' \r\n  Private\r\n  Public\r\n    function encrypt(algorithm : AlgorithmIdentifier; key : TJSCryptoKey; data : TJSBufferSource): TJSPromise;\r\n    function decrypt(algorithm : AlgorithmIdentifier; key : TJSCryptoKey; data : TJSBufferSource): TJSPromise;\r\n    function sign(algorithm : AlgorithmIdentifier; key : TJSCryptoKey; data : TJSBufferSource): TJSPromise;\r\n    function verify(algorithm : AlgorithmIdentifier; key : TJSCryptoKey; signature : TJSBufferSource; data : TJSBufferSource): TJSPromise;\r\n    function digest(algorithm : AlgorithmIdentifier; data : TJSBufferSource): TJSPromise;\r\n    function generateKey(algorithm : AlgorithmIdentifier; extractable : boolean; keyUsages : TKeyUsageDynArray): TJSPromise;\r\n    function deriveKey(algorithm : AlgorithmIdentifier; baseKey : TJSCryptoKey; derivedKeyType : AlgorithmIdentifier; extractable : boolean; keyUsages : TKeyUsageDynArray): TJSPromise;\r\n    function deriveBits(algorithm : AlgorithmIdentifier; baseKey : TJSCryptoKey; length_ : NativeInt): TJSPromise;\r\n    function importKey(format : KeyFormat; keyData : TJSObject; algorithm : AlgorithmIdentifier; extractable : boolean; keyUsages : TKeyUsageDynArray): TJSPromise;\r\n    function exportKey(format : KeyFormat; key : TJSCryptoKey): TJSPromise;\r\n    function wrapKey(format : KeyFormat; key : TJSCryptoKey; wrappingKey : TJSCryptoKey; wrapAlgorithm : AlgorithmIdentifier): TJSPromise;\r\n    function unwrapKey(format : KeyFormat; wrappedKey : TJSBufferSource; unwrappingKey : TJSCryptoKey; unwrapAlgorithm : AlgorithmIdentifier; unwrappedKeyAlgorithm : AlgorithmIdentifier; extractable : boolean; keyUsages : TKeyUsageDynArray): TJSPromise;\r\n  end;\r\n  { TJSCrypto }\r\n\r\n  TJSCrypto = class external name 'Crypto'  (TJSObject)\r\n  private\r\n    Fsubtle: TJSSubtleCrypto; external name 'subtle';\r\n  Public\r\n    procedure getRandomValues (anArray : TJSTypedArray);\r\n    property subtle : TJSSubtleCrypto Read Fsubtle;\r\n  end;\r\n  \r\n  { TJSHistory }\r\n\r\n  TJSHistory = class external name 'History'  (TJSObject)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n{$IFDEF FIREFOX}\r\n    FState : JSValue; external name 'state';\r\n{$ENDIF}\r\n  Public\r\n    procedure back;\r\n    procedure forward;\r\n    procedure go(aIndex : NativeInt);\r\n    procedure go;\r\n    procedure pushState(aState : jsValue; aTitle : String; AURL : String);\r\n    procedure pushState(aState : jsValue; aTitle : String);\r\n    procedure replaceState(aState : jsValue; aTitle : String; AURL : String);\r\n    procedure replaceState(aState : jsValue; aTitle : String);\r\n    procedure replaceState(aState : jsValue);\r\n{$IFDEF FIREFOX}\r\n    property state : JSValue read FState;\r\n{$ENDIF}\r\n    property length: NativeInt read FLength;\r\n  end;\r\n\r\n  TJSIDBTransactionMode = class\r\n  const\r\n    readonly = 'readonly';\r\n    readwrite = 'readwrite';\r\n    versionchange = 'versionchange';\r\n  end;\r\n\r\n\r\n  { TJSIDBTransaction }\r\n\r\n  TJSIDBTransaction = class external name 'IDBTransaction'  (TJSEventTarget)\r\n  private\r\n    FDB : TIDBDatabase; external name 'db';\r\n    FError: JSValue; external name 'error';\r\n    FMode: String; external name 'mode';\r\n    FObjectStoreNames: TStringDynArray; external name 'objectStoreNames';\r\n  public\r\n    procedure abort;\r\n    function objectStore(aName : String) : TJSIDBObjectStore;\r\n    property db : TIDBDatabase read FDB;\r\n    property mode : String read FMode;\r\n    property objectStoreNames : TStringDynArray read FObjectStoreNames;\r\n    property error : JSValue read FError;\r\n  end;\r\n\r\n\r\n  { TJSIDBKeyRange }\r\n\r\n  TJSIDBKeyRange = class external name 'IDBKeyRange'  (TJSObject)\r\n  private\r\n    FLower: JSValue;\r\n    FLowerOpen: Boolean;\r\n    FUpper: JSValue;\r\n    FUpperOpen: Boolean;\r\n  Public\r\n    Class Function bound(aLower,aUpper : JSValue) : TJSIDBKeyRange; overload;\r\n    Class Function bound(aLower,aUpper : JSValue; aLowerOpen : Boolean) : TJSIDBKeyRange; overload;\r\n    Class Function bound(aLower,aUpper : JSValue; aLowerOpen,aUpperOpen : Boolean) : TJSIDBKeyRange; overload;\r\n    Class Function lowerBound(aLower : JSValue) : TJSIDBKeyRange; overload;\r\n    Class Function lowerBound(aLower : JSValue; aOpen: Boolean) : TJSIDBKeyRange; overload;\r\n    Class Function only(aValue : JSValue) : TJSIDBKeyRange;\r\n    Class Function upperBound(aUpper : JSValue) : TJSIDBKeyRange; overload;\r\n    Class Function upperBound(aUpper : JSValue; aOpen: Boolean) : TJSIDBKeyRange; overload;\r\n    function includes (aValue : JSValue) : Boolean;\r\n    property lower : JSValue read FLower;\r\n    property lowerOpen : Boolean read FLowerOpen;\r\n    property upper : JSValue read FUpper;\r\n    property upperOpen : Boolean read FUpperOpen;\r\n  end;\r\n\r\n  TJSIDBIndexParameters = record\r\n    unique : boolean;\r\n    multiEntry : boolean;\r\n    locale : string;\r\n  end;\r\n\r\n\r\n  { TJSIDBIndex }\r\n\r\n  TJSIDBIndex = class external name 'IDBIndex'  (TJSObject)\r\n  private\r\n    FKeyPath: JSValue; external name 'keyPath';\r\n    FMultiEntry: Boolean; external name 'multiEntry';\r\n    FObjectStore: TJSIDBObjectStore; external name 'objectStore';\r\n    FUnique: boolean; external name 'unique';\r\n  public\r\n    name : string;\r\n    function count : TJSIDBRequest;\r\n    function get(aKey : jsValue) : TJSIDBRequest; overload;\r\n    function get(aKey : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll(aKey : jsValue) : TJSIDBRequest; overload;\r\n    function getAll(aKey : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll(aKey : jsValue; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getAll(aKey : TJSIDBKeyRange; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : jsValue) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : jsValue; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : TJSIDBKeyRange; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getKey(aKey : jsValue) : TJSIDBRequest;\r\n    function openCursor : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange; ADirection : String) : TJSIDBRequest;overload;\r\n    function openKeyCursor : TJSIDBRequest;overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest;overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange; ADirection : String) : TJSIDBRequest;overload;\r\n    Property keyPath : JSValue Read FKeyPath;\r\n    property multiEntry : Boolean read FMultiEntry;\r\n    property objectStore : TJSIDBObjectStore read FObjectStore;\r\n    property unique : boolean read FUnique;\r\n  end;\r\n\r\n  TJSIDBCursorDirection = class external name 'IDBCursorDirection'  (TJSObject)\r\n  Const\r\n    next = 'next';\r\n    nextUnique = 'nextUnique';\r\n    prev = 'prev';\r\n    prevUnique = 'prevUnique';\r\n  end;\r\n\r\n\r\n  { TJSIDBCursor }\r\n\r\n  TJSIDBCursor = class external name 'IDBCursor'  (TJSObject)\r\n  private\r\n    FDirection: string; external name 'direction';\r\n    FKey: JSValue; external name 'key';\r\n    FValue : JSValue; external name 'value';\r\n    FPrimaryKey: JSValue; external name 'primaryKey';\r\n    FSource: JSValue; external name 'source';\r\n    FSourceAsIndex: TJSIDBIndex; external name 'source';\r\n    FSourceAsStore: TJSIDBObjectStore; external name 'source';\r\n  Public\r\n    procedure advance(aCount : NativeInt); overload;\r\n    procedure advance(aKey : JSValue); overload;\r\n    procedure continue(aKey : JSValue); overload;\r\n    procedure continue; overload;\r\n    procedure continuePrimaryKey(aKey : JSValue); overload;\r\n    procedure continuePrimaryKey(aKey,aPrimaryKey : JSValue); overload;\r\n    procedure delete;\r\n    procedure update(aValue : JSValue);\r\n    property source : JSValue read FSource;\r\n    property sourceAsStore : TJSIDBObjectStore read FSourceAsStore;\r\n    property sourceAsIndex : TJSIDBIndex read FSourceAsIndex;\r\n    property key : JSValue read FKey;\r\n    Property Value : JSValue Read FValue;\r\n    property primaryKey : JSValue read FPrimaryKey;\r\n    property direction : string read FDirection;\r\n  end;\r\n\r\n  TJSIDBObjectStore = class external name 'IDBObjectStore'  (TJSEventTarget)\r\n  public\r\n    function add(aValue : JSValue; aKey : String) : TJSIDBRequest;\r\n    function add(aValue : JSValue) : TJSIDBRequest;\r\n    function clear : TJSIDBRequest;\r\n    function delete(aKey : string) : TJSIDBRequest;\r\n    function delete(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest;\r\n    function get(aKey : string) : TJSIDBRequest; overload;\r\n    function get(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getKey(aKey : string) : TJSIDBRequest; overload;\r\n    function getKey(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll : TJSIDBRequest; overload;\r\n    function getAll(aKey : String) : TJSIDBRequest; overload;\r\n    function getAll(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll(aKey : String; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function getAll(aKeyRange : TJSIDBKeyRange; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : String) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : String; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKeyRange : TJSIDBKeyRange; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function createIndex (aIndexName : String; KeyPath : String)  : TJSIDBIndex; overload;\r\n    function createIndex (aIndexName : String; KeyPath : String; Options : TJSIDBIndexParameters)  : TJSIDBIndex; overload;\r\n    function createIndex (aIndexName : String; KeyPath : Array of String)  : TJSIDBIndex; overload;\r\n    function createIndex (aIndexName : String; KeyPath : Array of String; Options : TJSIDBIndexParameters)  : TJSIDBIndex; overload;\r\n    Procedure deleteIndex (aIndexName : String);\r\n    function index (aIndexName : String)  : TJSIDBIndex;\r\n    function put(aValue : JSValue; aKey : String) : TJSIDBRequest; overload;\r\n    function put(aValue : JSValue) : TJSIDBRequest; overload;\r\n    function openCursor : TJSIDBRequest; overload;\r\n    function openCursor(aKey : String) : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function openCursor(aKey : String; aDirection : string) : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange; aDirection : string) : TJSIDBRequest; overload;\r\n    function openKeyCursor : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKey : String) : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKey : String; aDirection : string) : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange; aDirection : string) : TJSIDBRequest; overload;\r\n    function count : TJSIDBRequest; overload;\r\n    function count(aKey : String) : TJSIDBRequest; overload;\r\n    function count(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    property Indexes [aIndexName : String] : TJSIDBIndex read index;\r\n  end;\r\n\r\n  { TJSIDBRequest }\r\n\r\n  TJSIDBRequest = class external name 'IDBRequest'  (TJSEventTarget)\r\n  private\r\n    Ferror : JSValue; external name 'error'; // standards are not quite clear on this one\r\n    FReadyState: string; external name 'readyState';\r\n    FResult: JSValue; external name 'result';\r\n    FResultDatabase: TIDBDatabase; external name 'result';\r\n    FResultIndex: TJSIDBIndex; external name 'result';\r\n    FResultObjectStore : TJSIDBObjectStore; external name 'result';\r\n    FResultCursor : TJSIDBCursor; external name 'result';\r\n    FSourceDatabase: TIDBDatabase; external name 'source';\r\n    FSourceIndex: TJSIDBIndex; external name 'source';\r\n    FSourceObjectStore : TJSIDBObjectStore; external name 'source';\r\n    FSourceCursor : TJSIDBCursor; external name 'source';\r\n    FSource: JSValue; external name 'source';\r\n    FTransaction: TJSIDBTransaction; external name 'transaction';\r\n  Public\r\n    onerror : TJSEventHandler;\r\n    onsuccess : TJSEventHandler;\r\n    Property error : JSValue read FError;\r\n    property readyState : string read FReadyState;\r\n\r\n    property result : JSValue read FResult;\r\n    property resultAsObjectStore : TJSIDBObjectStore read FResultObjectStore;\r\n    property resultAsCursor : TJSIDBCursor read FResultCursor;\r\n    property resultAsIndex : TJSIDBIndex read FResultIndex;\r\n    property resultAsDatabase : TIDBDatabase read FResultDatabase;\r\n\r\n    property source : JSValue read FSource;\r\n    property sourceAsObjectStore : TJSIDBObjectStore read FSourceObjectStore;\r\n    property sourceAsCursor : TJSIDBCursor read FSourceCursor;\r\n    property sourceAsIndex : TJSIDBIndex read FSourceIndex;\r\n    property sourceAsDatabase : TIDBDatabase read FSourceDatabase;\r\n\r\n    property transaction : TJSIDBTransaction read FTransaction;\r\n  end;\r\n\r\n  TJSIDBOpenDBRequest = class external name 'IDBOpenDBRequest' (TJSIDBRequest)\r\n  Public\r\n    onblocked : TJSEventHandler;\r\n    onupgradeneeded : TJSEventHandler;\r\n  end;\r\n\r\n  TJSCreateObjectStoreOptions = record\r\n    keyPath : jsValue;\r\n    autoIncrement : boolean;\r\n  end;\r\n\r\n  { TIDBDatabase }\r\n\r\n  TIDBDatabase = class external name 'IDBDatabase' (TJSEventTarget)\r\n  private\r\n    FName: string; external name 'name';\r\n    FobjectStoreNames: TStringDynArray; external name 'objectStoreNames';\r\n    FVersion: integer; external name 'version';\r\n  public\r\n    procedure close;\r\n    function createObjectStore(aName : string) : TJSIDBObjectStore; overload;\r\n    function createObjectStore(aName : string; Options: TJSCreateObjectStoreOptions) : TJSIDBObjectStore; overload;\r\n    procedure deleteObjectStore(aName : string);\r\n    function transaction(aStoreNames : array of string) : TJSIDBTransaction; overload;\r\n    function transaction(aStoreNames : array of string; aMode : string) : TJSIDBTransaction; overload;\r\n    property name : string read FName;\r\n    property version : integer read FVersion;\r\n    property objectStoreNames : TStringDynArray read FobjectStoreNames;\r\n  end;\r\n\r\n  TJSIDBFactory = class external name 'IDBFactory' (TJSEventTarget)\r\n  public\r\n    function open(aName : string) : TJSIDBOpenDBRequest;\r\n    function open(aName : string; aVersion : Integer) : TJSIDBOpenDBRequest;\r\n    function deleteDatabase(aName : string) : TJSIDBOpenDBRequest;\r\n    function cmp (a,b : jsValue) : NativeInt;\r\n  end;\r\n  \r\n  { TJSStorage }\r\n\r\n  TJSStorage = class external name 'Storage' (TJSEventTarget)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n  public\r\n    function key(aIndex : Integer) : String;\r\n    function getItem(aKeyName : string) : string;\r\n    procedure setItem(aKeyName : string; aValue : string);\r\n    procedure removeItem(aKeyName : string);\r\n    procedure clear;\r\n    property Keys[AIndex : Integer] : String read key;\r\n    property Items[aKeyName: String] : String read getItem write setItem; default;\r\n    property length : NativeInt Read FLength;\r\n  end;\r\n\r\n  // Fake object, used for objects whose visible can be checked\r\n  TJSVisibleItem = class external name 'IVisible'  (TJSObject)\r\n  Private\r\n    FVisible : boolean; external name 'visible';\r\n  Public\r\n    Property visible : boolean read FVisible;\r\n  end;\r\n  \r\n  TJSLocationBar = class external name 'LocationBar' (TJSVisibleItem);\r\n  TJSMenuBar = class external name 'MenuBar' (TJSVisibleItem);\r\n  TJSToolBar = class external name 'ToolBar' (TJSVisibleItem);\r\n  TJSPersonalBar = class external name 'PersonalBar' (TJSVisibleItem);\r\n  TJSScrollBars = class external name 'ScrollBars' (TJSVisibleItem);\r\n\r\n  TJSPositionError = record\r\n    code : integer;\r\n    message : string;\r\n  end;\r\n\r\n  TJSPositionOptions = record\r\n    enableHighAccuracy : boolean;\r\n    timeout : integer;\r\n    maximumAge : integer;\r\n  end;\r\n\r\n  TJSCoordinates = record\r\n    latitude : double;\r\n    longitude : double;\r\n    altitude : double;\r\n    accuracy : double;\r\n    altitudeAccuracy : double;\r\n    heading : double;\r\n    speed : double;\r\n  end;\r\n\r\n  TJSPosition = record\r\n    coords : TJSCoordinates;\r\n    timestamp : String;\r\n  end;\r\n\r\n  TJSGeoLocationCallback = procedure (aPosition : TJSPosition);\r\n  TJSGeoLocationEvent = procedure (aPosition : TJSPosition) of object;\r\n  TJSGeoLocationErrorCallback = procedure (aValue : TJSPositionError);\r\n  TJSGeoLocationErrorEvent = procedure (aValue : TJSPositionError) of object;\r\n\r\n  TJSGeoLocation  = class external name 'GeoLocation'  (TJSObject)\r\n  Public\r\n    Procedure getCurrentPosition(ASuccess : TJSGeoLocationCallback); overload;\r\n    Procedure getCurrentPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback); overload;\r\n    Procedure getCurrentPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback; AOptions : TJSPositionOptions); overload;\r\n    Function watchPosition(ASuccess : TJSGeoLocationCallback) : NativeInt; overload;\r\n    Function watchPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback) : NativeInt; overload;\r\n    Function watchPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback; AOptions : TJSPositionOptions) : NativeInt; overload;\r\n    procedure clearWatch(AID : NativeInt);\r\n  end;\r\n\r\n  TJSMediaDevices = class external name 'MediaDevices' (TJSEventTarget)\r\n  end;\r\n\r\n  TJSWorker = class external name 'Worker' (TJSEventTarget)\r\n  public\r\n    constructor new(aURL : string);\r\n    procedure postMessage(aValue : JSValue);\r\n    procedure postMessage(aValue : JSValue; aList : TJSValueDynArray);\r\n    procedure terminate;\r\n  end;\r\n\r\n  TJSMessagePort = class external name 'MessagePort' (TJSEventTarget)\r\n  Public\r\n    procedure close;\r\n    procedure postMessage(aValue : JSValue);\r\n    procedure postMessage(aValue : JSValue; aList : TJSValueDynArray);\r\n    procedure start;\r\n  end;\r\n\r\n  { TJSSharedWorker }\r\n\r\n  TJSSharedWorker = class external name 'SharedWorker' (TJSEventTarget)\r\n  private\r\n    FPort: TJSMessagePort; external name 'port';\r\n  Public\r\n    constructor new(aURL : String); overload;\r\n    constructor new(aURL : String; aName : string); overload;\r\n    property port : TJSMessagePort Read FPort;\r\n  end;\r\n\r\n  { TJSServiceWorker }\r\n\r\n  TJSServiceWorker = class external name 'ServiceWorker' (TJSWorker)\r\n  private\r\n    FscriptURL: String;  external name 'scriptURL';\r\n    FState: string;  external name 'state';\r\n  Public\r\n    property state : string read FState;\r\n    property scriptURL : String Read FscriptURL;\r\n  end;\r\n\r\n  { TJSServiceWorkerRegistration }\r\n\r\n  TJSServiceWorkerRegistration = class external name 'ServiceWorkerRegistration'  (TJSObject)\r\n  private\r\n    FActive: TJSServiceWorker; external name 'active';\r\n    FInstalling: TJSServiceWorker; external name 'installing';\r\n    FScope: string; external name 'scope';\r\n    FWaiting: TJSServiceWorker; external name 'waiting';\r\n  public\r\n    function unregister : TJSPromise;\r\n    procedure update;\r\n    property active : TJSServiceWorker read FActive;\r\n    property scope : string read FScope;\r\n    property waiting : TJSServiceWorker read FWaiting;\r\n    property installing : TJSServiceWorker read FInstalling;\r\n  end;\r\n\r\n  TJSServiceWorkerContainerOptions = record\r\n    scope : string;\r\n  end;\r\n\r\n  { TJSServiceWorkerContainer }\r\n\r\n  TJSServiceWorkerContainer = class external name 'ServiceWorkerContainer'  (TJSObject)\r\n  private\r\n    FController: TJSServiceWorker; external name 'controller';\r\n    FReady: TJSPromise; external name 'ready';\r\n  Public\r\n    function register(aURL : String) : TJSPromise; overload;\r\n    function register(aURL : String; aOptions : TJSServiceWorkerContainerOptions) : TJSPromise; overload;\r\n    function getRegistration(aURL : String) : TJSPromise; overload;\r\n    function getRegistration : TJSPromise; overload;\r\n    function getRegistrations : TJSPromise;\r\n    property controller : TJSServiceWorker read FController;\r\n    property ready : TJSPromise read FReady;\r\n  end;\r\n\r\n\r\n  { TJSNavigator }\r\n\r\n  TJSNavigator = class external name 'Navigator'  (TJSObject)\r\n{$IFDEF FIREFOX}\r\n    FbuildID : String ; external name 'buildID';\r\n    FOSCPU : String ; external name 'oscpu';\r\n    FproductSub : string; external name 'productSub';\r\n    FVendor : string; external name 'vendor';\r\n{$ENDIF}\r\n  private\r\n    FCookieEnabled: Boolean; external name 'cookieEnabled';\r\n    FGeoLocation: TJSGeoLocation; external name 'geolocation';\r\n    FLanguage: String; external name 'language';\r\n    FMaxTouchPoints: NativeInt; external name 'maxTouchPoints';\r\n    FMediaDevices: TJSMediaDevices; external name 'mediaDevices';\r\n    FOnline: boolean; external name 'onLine';\r\n    FPlatform: string; external name 'platform';\r\n    FServiceWorker: TJSServiceWorkerContainer; external name 'serviceWorker';\r\n    FUserAgent: string; external name 'userAgent';\r\n  public\r\n    function getBattery : TJSPromise;\r\n    function requestMediaKeySystemAccess(aKeySystem : String; supportedConfigurations : TJSValueDynArray) : TJSPromise;\r\n    Procedure registerContentHandler(aMimeType,aURI,aTitle : string);\r\n    Procedure registerProtocolHandler(aProtocol,aURI,aTitle : string);\r\n    Procedure vibrate(aPattern : NativeInt);\r\n    Procedure vibrate(aPattern : Array of NativeInt);\r\n{$IFDEF FIREFOX}\r\n    property buildID : String read FBuildID;\r\n    property oscpu : string read FOSCPU;\r\n    property productSub: string read FproductSub;\r\n    property vendor : string read Fvendor;\r\n{$ENDIF}\r\n    property cookieEnabled : Boolean read FCookieEnabled;\r\n    property geoLocation : TJSGeoLocation Read FGeoLocation;\r\n    property language : String read FLanguage;\r\n    property maxTouchPoints : NativeInt read FMaxTouchPoints;\r\n    property mediaDevices : TJSMediaDevices read FMediaDevices;\r\n    property onLine : boolean read FOnline;\r\n    property platform : string read FPlatform;\r\n    property userAgent : string read FUserAgent;\r\n    property serviceWorker : TJSServiceWorkerContainer read FServiceWorker;\r\n  end;\r\n\r\n  { TJSTouchEvent }\r\n  TTouchCoord = longint;\r\n\r\n  TJSTouch = class external name 'Touch'  (TJSObject)\r\n  private\r\n    FClientX: TTouchCoord; external name 'clientX';\r\n    FClientY: TTouchCoord; external name 'clientY';\r\n    FIDentifier: longint; external name 'identifier';\r\n    FPageX: TTouchCoord; external name 'pageX';\r\n    FPageY: TTouchCoord; external name 'pageY';\r\n    FScreenX: TTouchCoord; external name 'screenX';\r\n    FScreenY: TTouchCoord; external name 'screenY';\r\n    FTarget: TJSElement; external name 'target';\r\n  Public\r\n    Property identifier : longint read FIDentifier;\r\n    Property ScreenX : TTouchCoord Read FScreenX;\r\n    Property ScreenY : TTouchCoord Read FScreenY;\r\n    Property ClientX : TTouchCoord Read FClientX;\r\n    Property ClientY : TTouchCoord Read FClientY;\r\n    Property PageX : TTouchCoord Read FPageX;\r\n    Property PageY : TTouchCoord Read FPageY;\r\n    Property Target : TJSElement Read FTarget;\r\n  end;\r\n\r\n  { TJSTouchList }\r\n\r\n  TJSTouchList = class external name 'TouchList' (TJSObject)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n  Public\r\n    function item (aIndex : Integer) : TJSTouch;\r\n    property length : NativeInt Read FLength;\r\n    Property Touches[AIndex : Integer] : TJSTouch Read item; default;\r\n  end;\r\n\r\n\r\n  TJSPerformance = class external name 'Performance' (TJSObject);\r\n\r\n  TJSScreen = class external name 'Screen' (TJSObject)\r\n  private\r\n    FavailHeight: Integer; external name 'availHeight';\r\n    FavailWidth: Integer; external name 'availWidth';\r\n    FcolorDepth: Integer; external name 'colorDepth';\r\n    FPixelDepth: Integer; external name 'pixelDepth';\r\n    Fheight: Integer; external name 'height';\r\n    Fwidth: Integer; external name 'width';\r\n  public\r\n  { Properties declarations }\r\n    property availHeight: Integer read FavailHeight;\r\n    property availWidth: Integer read FavailWidth;\r\n    property colorDepth: Integer read FcolorDepth;\r\n    property pixelDepth: Integer read FPixelDepth;\r\n    property height: Integer read Fheight;\r\n    property width: Integer read Fwidth;\r\n  end;\r\n\r\n\r\n  TJSURL = class external name 'URL' (TJSObject);\r\n  \r\n  TJSCSSStyleDeclaration = class; // forward\r\n\r\n  TJSTimerCallBack = reference to procedure;\r\n\r\n  { TJSMediaQueryList }\r\n\r\n  TJSMediaQueryList = class external name 'MediaQueryList' (TJSObject)\r\n  private\r\n    FMatches: Boolean; external name 'matches';\r\n    FMedia: String; external name 'media';\r\n  Public\r\n    Property matches : Boolean Read FMatches;\r\n    Property media : String Read FMedia;\r\n  end;\r\n\r\n  TJSReadableStream = class external name 'ReadableStream' (TJSObject)\r\n  private\r\n    flocked: Boolean; external name 'locked';\r\n  public\r\n    property locked: Boolean read flocked;\r\n    constructor new(underlyingSource: TJSObject);\r\n    constructor new(underlyingSource, queueingStrategy: TJSObject);\r\n    function cancel(reason: TJSDOMString): TJSPromise;\r\n    function getReader(): TJSObject; overload;\r\n    function getReader(mode: TJSObject): TJSObject; overload;\r\n    function pipeThrough(transformStream: TJSObject): TJSReadableStream; overload;\r\n    function pipeThrough(transformStream, options: TJSObject): TJSReadableStream; overload;\r\n    function pipeTo(destination: TJSObject): TJSPromise; overload;\r\n    function pipeTo(destination, options: TJSObject): TJSPromise; overload;\r\n    function tee(): TJSArray; // array containing two TJSReadableStream instances\r\n  end;\r\n\r\n  TJSBody = class external name 'Body' (TJSObject)\r\n  private\r\n    fbody: TJSReadableStream; external name 'body';\r\n    fbodyUsed: Boolean; external name 'bodyUsed';\r\n  public\r\n    property body: TJSReadableStream read fbody;\r\n    property bodyUsed: Boolean read fbodyUsed;\r\n    function arrayBuffer(): TJSPromise; // resolves to TJSArrayBuffer\r\n    function blob(): TJSPromise; // resolves to TJSBlob\r\n    function json(): TJSPromise; // resolves to JSON / TJSValue\r\n    function text(): TJSPromise; // resolves to USVString, always decoded using UTF-8\r\n  end;\r\n\r\n  TJSResponse = class external name 'Response' (TJSBody)\r\n  private\r\n    fheaders: TJSObject;external name 'headers';\r\n    fok: Boolean; external name 'ok';\r\n    fredirected: Boolean; external name 'redirected';\r\n    fstatus: NativeInt; external name 'status';\r\n    fstatusText: String; external name 'statusText';\r\n    ftype: String; external name 'type';\r\n    furl: String; external name 'url';\r\n    fuseFinalUrl: Boolean; external name 'useFinalUrl';\r\n  public\r\n    property headers: TJSObject read fheaders; //\r\n    property ok: Boolean read fok;\r\n    property redirected: Boolean read fredirected;\r\n    property status: NativeInt read fstatus;\r\n    property statusText: String read fstatusText; //\r\n    property type_: String read ftype; //\r\n    property url: String read furl; //\r\n    property useFinalUrl: Boolean read fuseFinalUrl write fuseFinalUrl;\r\n    constructor new(body: TJSObject; init: TJSObject); varargs; external name 'new';\r\n    function clone(): TJSResponse;\r\n    function error(): TJSResponse;\r\n    function redirect(url: String; Status: NativeInt): TJSResponse;\r\n  end;\r\n\r\n  { TJSWindow }\r\n  TJSDOMHighResTimeStamp = Double;\r\n  TFrameRequestCallback = procedure (aTime: TJSDOMHighResTimeStamp);\r\n\r\n  TJSWindowArray = Array of TJSWindow;\r\n  TJSWindow = class external name 'Window' (TJSObject)\r\n  Private\r\n    FClosed: boolean; external name 'closed';\r\n    FConsole : TJSConsole;  external name 'console';\r\n    FCrypto: TJSCrypto; external name 'crypto';\r\n    FDevicePixelRatio: Double; external name 'devicePixelRatio';\r\n    FDocument: TJSDocument; external name 'document';\r\n    FFrameElement: TJSElement; external name 'frameElement';\r\n    FFrames: TJSWindowArray; external name 'frames';\r\n    FHistory: TJSHistory; external name 'history';\r\n    FIndexedDB: TJSIDBFactory; external name 'indexedDB';\r\n    FInnerheight: NativeInt; external name 'innerHeight';\r\n    FInnerWidth: NativeInt; external name 'innerWidth';\r\n    FLength: NativeInt; external name 'length';\r\n    FLocalStorage: TJSStorage; external name 'localStorage';\r\n    FLocation: TJSLocation; external name 'location';\r\n    FLocationBar: TJSLocationBar; external name 'locationbar';\r\n    FLocationString: string; external name 'location';\r\n    FMenuBar: TJSMenuBar; external name 'menubar';\r\n    FNavigator: TJSNavigator; external name 'navigator';\r\n    FOpener: TJSWindow; external name 'opener';\r\n    FOuterheight: NativeInt; external name 'outerHeight';\r\n    FOuterWidth: NativeInt; external name 'outerWidth';\r\n    FParent: TJSWindow; external name 'parent';\r\n    FPerformance: TJSPerformance; external name 'Performance';\r\n    FPersonalBar: TJSPersonalBar; external name 'personalbar';\r\n    FScreen: TJSScreen; external name 'screen';\r\n    FScreenX: NativeInt; external name 'screenX';\r\n    FScreenY: NativeInt; external name 'screenY';\r\n    FScrollbar: TJSScrollBars; external name 'scrollbar';\r\n    FScrollX: NativeInt; external name 'scrollX';\r\n    FScrollY: NativeInt; external name 'scrollY';\r\n    FSelf: TJSWindow; external name 'self';\r\n    FSessionStorage: TJSStorage; external name 'sessionStorage';\r\n    FToolBar: TJSToolBar; external name 'toolbar';\r\n    FTop: TJSWindow; external name 'top';\r\n    FURL: TJSURL; external name 'URL';\r\n  Public\r\n    fullSreen : Boolean;   \r\n    name : string;\r\n    status : string;\r\n    onabort : TJSEventHandler;\r\n    onafterprint : TJSEventHandler;\r\n    onbeforeprint : TJSEventHandler;\r\n    onbeforeinstallprompt : TJSEventHandler;\r\n    onbeforeunloadprompt : TJSEventHandler;\r\n    onblur : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onclick: THTMLClickEventHandler;\r\n    onclose : TJSEventHandler;\r\n    oncontextmenu : TJSEventHandler;\r\n    ondblclick : THTMLClickEventHandler;\r\n    onerror : TJSErrorEventHandler;\r\n    onfocus : TJSFocusEventhandler;\r\n    onhashchange : TJSHashChangeEventhandler;\r\n    oninput : TJSEventhandler;\r\n    onkeydown : TJSKeyEventhandler;\r\n    onkeypress : TJSKeyEventhandler;\r\n    onkeyup : TJSKeyEventhandler;\r\n    onlanguagechange : TJSEventhandler;\r\n    onload : TJSEventhandler;\r\n    onloadend : TJSLoadEventhandler;\r\n    onloadstart : TJSLoadEventhandler;\r\n    onmessage : TJSEventHandler;\r\n    onmousedown : TJSMouseEventHandler;\r\n    onmouseenter : TJSMouseEventHandler;\r\n    onmouseleave : TJSMouseEventHandler;\r\n    onmousemove : TJSMouseEventHandler;\r\n    onmouseout : TJSMouseEventHandler;\r\n    onmouseover : TJSMouseEventHandler;\r\n    onmouseup : TJSMouseEventHandler;\r\n    onmousewheel : TJSMouseEventHandler;\r\n    onoffline : TJSEventHandler;\r\n    ononline : TJSEventHandler;\r\n    onpagehide : TJSPageTransitionEventHandler;\r\n    onpageshow : TJSPageTransitionEventHandler;\r\n    onpaint : TJSEventHandler;\r\n    onpointercancel : TJSPointerEventHandler;\r\n    onpointerdown : TJSPointerEventHandler;\r\n    onpointerenter : TJSPointerEventHandler;\r\n    onpointerleave : TJSPointerEventHandler;\r\n    onpointermove : TJSPointerEventHandler;\r\n    onpointerout : TJSPointerEventHandler;\r\n    onpointerover : TJSPointerEventHandler;\r\n    onpointerup : TJSPointerEventHandler;\r\n    onpointerlockchange : TJSPointerEventHandler;\r\n    onprogress : TJSProgressEventhandler;\r\n    onpopstate : TJSPopStateEventHandler;\r\n    onreset : TJSUIEventHandler;\r\n    onscroll : TJSUIEventHandler;\r\n    onselect : TJSEventHandler;\r\n    onselectionchange : TJSEventHandler;\r\n    onstorage : TJSStorageEventHandler;\r\n    onsubmit : TJSEventHandler;\r\n    onunload : TJSUIEventHandler;\r\n    touchstart : TJSTouchEventHandler;\r\n    touchend : TJSTouchEventHandler;\r\n    touchmove : TJSTouchEventHandler;\r\n    touchcancel : TJSTouchEventHandler;\r\n    procedure addEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure addEventListener(aname : string; aListener : JSValue);\r\n    Procedure alert(Const Msg : String);\r\n    Function atob(Const aValue : string) : string;\r\n    procedure blur;\r\n    Procedure clearInterval(aID: NativeInt);\r\n    Procedure clearTimeout(aID: NativeInt);\r\n    Function btoa(Const aValue : string) : string;\r\n    procedure cancelAnimationFrame(aHandle: Integer);\r\n    Procedure close;\r\n    Function confirm(Const aMsg : String) :  boolean;\r\n    function fetch(resource: String; init: TJSObject): TJSPromise; overload; external name 'fetch';\r\n    function fetch(resource: String): TJSPromise; overload; external name 'fetch';\r\n    function fetch(resource: TJSObject; init: TJSObject): TJSPromise; overload; external name 'fetch';\r\n    function fetch(resource: TJSObject): TJSPromise; overload; external name 'fetch';\r\n    procedure focus;\r\n    Function getComputedStyle(aElement : TJSElement) : TJSCSSStyleDeclaration; overload;\r\n    Function getComputedStyle(aElement,aPseudoElement : TJSElement) : TJSCSSStyleDeclaration; overload;\r\n    function matchMedia(aQuery : String) : TJSMediaQueryList;\r\n    procedure moveBy(x,y : NativeInt);\r\n    procedure moveTo(x,y : NativeInt);\r\n    function open : TJSWindow;\r\n    function open(Const aURL : String) : TJSWindow; overload;\r\n    function open(Const aURL,aTarget : String) : TJSWindow; overload;\r\n    function open(Const aURL,aTarget : String; AOptions : TJSObject) : TJSWindow; overload;\r\n    procedure print;\r\n    function prompt(const aMessage : String) : String; overload;\r\n    function prompt(const aMessage,aDefault : String) : String; overload;\r\n    procedure removeEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure removeEventListener(aname : string; aListener : JSValue);\r\n    function requestAnimationFrame(aCallback: TFrameRequestCallback): Integer;\r\n    procedure resizeBy(aWidth,aHeight : NativeInt);\r\n    procedure resizeTo(aWidth,aHeight : NativeInt);\r\n    procedure scrollBy(x,y : NativeInt);\r\n    procedure scrollTo(x,y : NativeInt);\r\n    Function setInterval(ahandler : TJSTimerCallBack; aInterval : NativeUInt) : NativeInt; varargs;\r\n    Function setTimeout(ahandler : TJSTimerCallBack; aTimeout : NativeUInt) : NativeInt; varargs;\r\n    Function setTimeout(ahandler : TJSTimerCallBack) : NativeInt;\r\n    procedure stop;\r\n    { public properties }\r\n    property console : TJSConsole Read FConsole;\r\n    property closed : boolean read FClosed;\r\n    property crypto : TJSCrypto Read FCrypto;\r\n    property devicePixelRatio : Double read FDevicePixelRatio;\r\n    property document : TJSDocument read FDocument;\r\n    property frameElement : TJSElement Read FFrameElement;\r\n    Property frames  : TJSWindowArray read FFrames;\r\n    Property history : TJSHistory read FHistory;\r\n    Property indexedDB : TJSIDBFactory read FIndexedDB;\r\n    Property innerHeight : NativeInt Read FInnerheight;\r\n    Property innerWidth : NativeInt Read FInnerWidth;\r\n    Property length : NativeInt Read FLength;\r\n    Property localStorage : TJSStorage Read FLocalStorage; \r\n    property location : TJSLocation Read FLocation;\r\n    Property locationString : String read FLocationString write FLocationString;\r\n    property locationbar : TJSLocationBar Read FLocationBar;\r\n    property menubar : TJSMenuBar Read FMenuBar;\r\n    property navigator : TJSNavigator Read FNavigator;\r\n    property opener : TJSWindow read FOpener;\r\n    Property outerHeight : NativeInt Read FOuterheight;\r\n    Property outerWidth : NativeInt Read FOuterWidth;\r\n    Property parent : TJSWindow Read FParent;\r\n    Property Performance : TJSPerformance Read FPerformance;\r\n    property personalbar : TJSPersonalBar Read FPersonalBar;\r\n    property screen : TJSScreen read FScreen;\r\n    property screenX : NativeInt read FScreenX;\r\n    Property screenY : NativeInt read FScreenY;\r\n    Property scrollbar : TJSScrollBars Read FScrollbar;\r\n    property scrollX : NativeInt read FScrollX;\r\n    Property scrollY : NativeInt read FScrollY;\r\n    Property _Self : TJSWindow read FSelf;\r\n    Property sessionStorage : TJSStorage Read FSessionStorage; \r\n    property toolbar : TJSToolBar Read FToolBar;\r\n    property top : TJSWindow Read FTop;\r\n    property URL : TJSURL Read FURL; \r\n  end;\r\n\r\n  { TJSCSSStyleDeclaration }\r\n\r\n  TJSCSSStyleDeclaration = class external name 'CSSStyleDeclaration'  (TJSObject)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n    FParentRule: TJSCSSRule; external name 'parentRule';\r\n  public\r\n    cssText : string;\r\n    function item(aIndex : Integer) : string;\r\n    function removeProperty(const aProperty : String) : string;\r\n    function getPropertyPriority(const aProperty : String) : string;\r\n    function getPropertyValue(const aProperty : String) : string;\r\n    procedure setProperty(const aProperty,aValue : String);overload;\r\n    procedure setProperty(const aProperty,aValue,aPriority : string); overload;\r\n    property length : NativeInt read FLength;\r\n    property parentRule : TJSCSSRule read FParentRule;\r\n  end;\r\n\r\n\r\n\r\n\r\n\r\n  { TJSHTMLElement }\r\n  TJSHTMLElement = class external name 'HTMLELement' (TJSElement)\r\n  private\r\n    FDataset: TJSObject ; external name 'dataset';\r\n    FIsContentEditable: Boolean ; external name 'isContentEditable';\r\n    FOffsetHeight: Double; external name 'offsetHeight';\r\n    FOffsetLeft: Double; external name 'offsetLeft';\r\n    FOffsetParent: TJSElement; external name 'offsetParent';\r\n    FOffsetTop: Double; external name 'offsetTop';\r\n    FOffsetWidth: Double; external name 'offsetWidth';\r\n  Public\r\n    accessKey : string;\r\n    contentEditable : string;\r\n    dir : string;\r\n    draggable : boolean;\r\n    hidden : boolean;\r\n    lang : string;\r\n    spellcheck : boolean;\r\n    style : TJSCSSStyleDeclaration;\r\n    tabIndex : Integer;\r\n    title: string;\r\n    onabort : TJSEventHandler;\r\n    onanimationcancel: THTMLAnimationEventHandler;\r\n    onanimationend: THTMLAnimationEventHandler;\r\n    onblur : TJSEventHandler;\r\n    oncancel : TJSEventHandler;\r\n    oncanplay : TJSEventHandler;\r\n    oncanplaythrough : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onclick: THTMLClickEventHandler;\r\n    onclose : TJSEventHandler;\r\n    oncontextmenu : TJSEventHandler;\r\n    ondblclick : THTMLClickEventHandler;\r\n    ondrag : TJSDragDropEventHandler;\r\n    ondragend : TJSDragDropEventHandler;\r\n    ondragenter : TJSDragDropEventHandler;\r\n    ondragexit : TJSDragDropEventHandler;\r\n    ondragover : TJSDragDropEventHandler;\r\n    ondragleave : TJSDragDropEventHandler;\r\n    ondragstart: TJSDragDropEventHandler;\r\n    ondrop : TJSDragDropEventHandler;\r\n    onerror : TJSErrorEventHandler;\r\n    onfocus : TJSFocusEventhandler;\r\n    ondurationchange : TJSEventHandler;\r\n    onemptied : TJSEventHandler;\r\n    onended : TJSEventHandler;\r\n    ongotpointercapture : TJSPointerEventHandler;\r\n    oninput : TJSEventhandler;\r\n    oninvalid : TJSEventhandler;\r\n    onkeydown : TJSKeyEventhandler;\r\n    onkeypress : TJSKeyEventhandler;\r\n    onkeyup : TJSKeyEventhandler;\r\n    onload : TJSEventhandler;\r\n    onloadeddata : TJSEventhandler;\r\n    onloadedmetadata : TJSEventhandler;\r\n    onloadend : TJSLoadEventhandler;\r\n    onloadstart : TJSLoadEventhandler;\r\n    onlostpointercapture : TJSPointerEventHandler;\r\n    onmousedown : TJSMouseEventHandler;\r\n    onmouseenter : TJSMouseEventHandler;\r\n    onmouseleave : TJSMouseEventHandler;\r\n    onmousemove : TJSMouseEventHandler;\r\n    onmouseout : TJSMouseEventHandler;\r\n    onmouseover : TJSMouseEventHandler;\r\n    onmouseup : TJSMouseEventHandler;\r\n    onmousewheel : TJSMouseEventHandler;\r\n    onpause : TJSPointerEventHandler;\r\n    onplay : TJSPointerEventHandler;\r\n    onplaying : TJSPointerEventHandler;\r\n    onpointercancel : TJSPointerEventHandler;\r\n    onpointerdown : TJSPointerEventHandler;\r\n    onpointerenter : TJSPointerEventHandler;\r\n    onpointerleave : TJSPointerEventHandler;\r\n    onpointermove : TJSPointerEventHandler;\r\n    onpointerout : TJSPointerEventHandler;\r\n    onpointerover : TJSPointerEventHandler;\r\n    onpointerup : TJSPointerEventHandler;\r\n    onpointerlockchange : TJSPointerEventHandler;\r\n    onprogress : TJSProgressEventhandler;\r\n    onseeked : TJSEventHandler;\r\n    onseeking : TJSEventHandler;\r\n    onreset : TJSUIEventHandler;\r\n    onscroll : TJSUIEventHandler;\r\n    onselect : TJSEventHandler;\r\n    onselectstart : TJSEventHandler;\r\n    onselectionchange : TJSEventHandler;\r\n    onshow : TJSEventHandler;\r\n    onstalled : TJSEventHandler;\r\n    ontimeupdate : TJSEventHandler;\r\n    ontransitioncancel : TJSEventHandler;\r\n    ontransitionend : TJSEventHandler;\r\n    onvolumechange : TJSEventHandler;\r\n    onsubmit : TJSEventHandler;\r\n    onwheel : TJSMouseWheelEventHandler;\r\n    onwaiting : TJSEventHandler;\r\n    touchstart : TJSTouchEventHandler;\r\n    touchend : TJSTouchEventHandler;\r\n    touchmove : TJSTouchEventHandler;\r\n    touchcancel : TJSTouchEventHandler;\r\n    Procedure blur;\r\n    Procedure focus;\r\n    Procedure click;\r\n    property dataset : TJSObject read FDataset;\r\n    property isContentEditable : Boolean read FIsContentEditable;\r\n    property offsetHeight : Double Read FOffsetHeight;\r\n    property offsetLeft : Double Read FOffsetLeft;\r\n    property offsetTop : Double Read FOffsetTop;\r\n    property offsetWidth : Double Read FOffsetWidth;\r\n    property offsetParent : TJSElement Read FOffsetParent;\r\n  end;\r\n\r\n  TJSHTMLFormControlsCollection = class external name 'HTMLFormControlsCollection' (TJSHTMLCollection)\r\n  Public\r\n    function namedItem(S : String) : TJSElement; reintroduce; external name 'namedItem';\r\n    property Items[S : String] : TJSElement read namedItem; default;\r\n  end;\r\n\r\n  { TJSHTMLFormElement }\r\n\r\n  TJSHTMLFormElement = class external name 'HTMLFormElement' (TJSHTMLElement)\r\n  private\r\n    FElements: TJSHTMLFormControlsCollection; external name 'elements';\r\n    FLength: NativeInt; external name 'length';\r\n  Public\r\n    method : string;\r\n    target : string;\r\n    action : string;\r\n    encoding : string;\r\n    enctype : string;\r\n    acceptCharset :  string;\r\n    autocomplete : string;\r\n    noValidate : boolean;\r\n    property elements : TJSHTMLFormControlsCollection read FElements;\r\n    Property length : NativeInt Read FLength;\r\n  end;\r\n\r\n  { TJSValidityState }\r\n\r\n  TJSValidityState = class external name 'ValidityState'  (TJSObject)\r\n  private\r\n    FBadInput: Boolean; external name 'badInput';\r\n    FCustomError: Boolean; external name 'customError';\r\n    FPatternMismatch: Boolean; external name 'patternMisMatch';\r\n    FRangeOverflow: Boolean; external name 'rangeOverflow';\r\n    FRangeUnderflow: Boolean; external name 'rangeUnderflow';\r\n    FStepMismatch: Boolean; external name 'stepMismatch';\r\n    FTooLong: Boolean; external name 'tooLong';\r\n    FTooShort: Boolean; external name 'tooShort';\r\n    FTypeMismatch: Boolean; external name 'typeMisMatch';\r\n    FValid: Boolean; external name 'valid';\r\n    FValueMissing: Boolean; external name 'valueMissing';\r\n  public\r\n    property badInput : Boolean read FBadInput;\r\n    property customError : Boolean read FCustomError;\r\n    property patternMisMatch : Boolean read FPatternMismatch;\r\n    property rangeOverflow : Boolean read FRangeOverflow;\r\n    property rangeUnderflow : Boolean read FRangeUnderflow;\r\n    property stepMismatch : Boolean read FStepMismatch;\r\n    property tooLong : Boolean read FTooLong;\r\n    property tooShort : Boolean read FTooShort;\r\n    property typeMisMatch : Boolean read FTypeMismatch;\r\n    property valid : Boolean Read FValid;\r\n    property valueMissing : Boolean read FValueMissing;\r\n  end;\r\n\r\n  { TJSBlob }\r\n\r\n  TJSBlob = class external name 'Blob' (TJSEventTarget)\r\n  private\r\n    FSize: NativeInt; external name 'size';\r\n    FType: string; external name  'type';\r\n  Public\r\n    procedure close;\r\n    function slice : TJSBlob; overload;\r\n    function slice(aStart : NativeInt) : TJSBlob; overload;\r\n    function slice(aStart,aEnd : NativeInt) : TJSBlob; overload;\r\n    function slice(aStart,aEnd : NativeInt; AContentType : String) : TJSBlob; overload;\r\n    property size : NativeInt read FSize;\r\n    property _type : string read FType;\r\n  end;\r\n\r\n\r\n  { TJSHTMLFile }\r\n\r\n  TJSHTMLFile = class external name 'File' (TJSBlob)\r\n  private\r\n    FLastModified: NativeInt; external name 'lastModified';\r\n    FLastModifiedDate: TJSDate; external name 'lastModifiedDate';\r\n    FName: string; external name 'name';\r\n  Public\r\n    property name : string read FName;\r\n    property lastModified : NativeInt read FLastModified;\r\n    property lastModifiedDate : TJSDate read FLastModifiedDate;\r\n  end;\r\n\r\n  { TJSHTMLFileList }\r\n\r\n  TJSHTMLFileList = class external name 'FileList' (TJSEventTarget)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n  Public\r\n    function item(aIndex : NativeInt) : TJSHTMLFile;\r\n    property length : NativeInt read FLength;\r\n    property Files[aIndex : NativeInt] : TJSHTMLFile Read item; default;\r\n  end;\r\n\r\n   { TJSHTMLInputElement }\r\n  // https://html.spec.whatwg.org/multipage/forms.html#the-input-element\r\n\r\n  TJSHTMLInputElement = class external name 'HTMLInputElement' (TJSHTMLElement)\r\n  private\r\n    FFiles: TJSHTMLFileList; external name 'files';\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FLabels: TJSNodeList; external name 'labels';\r\n    FList: TJSHTMLElement; external name 'list';\r\n    FValidationmMessage: string; external name 'validationMessage';\r\n    FValidity: TJSValidityState; external name 'validity';\r\n    FWillValidate: boolean; external name 'willValidate';\r\n  Public\r\n    procedure select;\r\n    procedure setCustomValidity(aText : string);\r\n    procedure stepUp; overload;\r\n    procedure stepUp(n : Integer); overload;\r\n    function checkValidity : Boolean;\r\n    function reportValidity : Boolean;\r\n    procedure setSelectionRange(selectionStart, selectionEnd: NativeInt) ; overload;\r\n    procedure setSelectionRange(selectionStart, selectionEnd: NativeInt; Direction : string) ; overload;\r\n    procedure setRangeText(aText : string; selectionStart, selectionEnd: NativeInt) ; overload;\r\n    procedure setRangeText(aText : string; selectionStart, selectionEnd: NativeInt; Direction : string) ; overload;\r\n  Public\r\n    accept : string;\r\n    allowDirs : boolean;\r\n    align : string;\r\n    alt : string;\r\n    autofocus : boolean;\r\n    autocapitalize : string;\r\n    autocomplete : string;\r\n    defaultValue : string;\r\n    defaultChecked : string;\r\n    checked : boolean;\r\n    dirName : string;\r\n    disabled : boolean;\r\n    formAction : string;\r\n    formEncType : string;\r\n    formMethod : string;\r\n    formNoValidate : Boolean;\r\n    formTarget : string;\r\n    height : string;\r\n    indeterminate : boolean;\r\n    inputMode : string;\r\n    max : string;\r\n    maxLength : NativeInt;\r\n    min : string;\r\n    minLength : NativeInt;\r\n    multiple : boolean;\r\n    pattern : string;\r\n    placeholder : string;\r\n    readOnly : boolean;\r\n    required : boolean;\r\n    size : NativeInt;\r\n    src : string;\r\n    step : string;\r\n    _type : string; external name 'type';\r\n    selectionStart : NativeInt;\r\n    selectionEnd : NativeInt;\r\n    selectionDirection : string;\r\n    useMap : string;\r\n    value : string;\r\n    width : string;\r\n    property files : TJSHTMLFileList Read FFiles;\r\n    property form : TJSHTMLFormElement read FForm;\r\n    property labels : TJSNodeList read FLabels;\r\n    property list : TJSHTMLElement Read FList;\r\n    property validationMessage : string read FValidationmMessage;\r\n    property willValidate : boolean read FWillValidate;\r\n    property validity : TJSValidityState read FValidity;\r\n  end;\r\n\r\n  { TJSHTMLImageElement }\r\n\r\n  TJSHTMLImageElement = class external name 'Image' (TJSHTMLElement)\r\n  Private\r\n    FComplete: boolean; external name 'complete';\r\n    FCurrentSrc: String; external name 'currentSrc';\r\n    FNaturalHeight: NativeUInt; external name 'naturalHeight';\r\n    FNaturalWidth: NativeUInt; external name 'naturalWidth';\r\n    FX: NativeInt; external name 'x';\r\n    FY: NativeInt; external name 'y';\r\n  Public\r\n    constructor New(x,y : Cardinal);\r\n    alt: String;\r\n    crossOrigin: String;\r\n    decoding: String;\r\n    height: NativeUInt;\r\n    isMap: boolean;\r\n    referrerPolicy: String;\r\n    src: String;\r\n    sizes: String;\r\n    srcset: String;\r\n    useMap: String;\r\n    width: NativeUInt;\r\n    function decode : TJSPromise;\r\n    property complete: boolean read FComplete;\r\n    property currentSrc: String read FCurrentSrc;\r\n    property naturalHeight: NativeUInt read FNaturalHeight;\r\n    property naturalWidth: NativeUInt read FNaturalWidth;\r\n    property x: NativeInt read FX;\r\n    property y: NativeInt read FY;\r\n  end;\r\n\r\n  { TJSHTMLMenuElement }\r\n\r\n  TJSHTMLMenuElement = class external name 'HTMLMenuElement' (TJSHTMLElement) //  uhm... should it be declared? it is experimental at Mozilla docs...\r\n  end;\r\n\r\n  { TJSHTMLButtonElement }\r\n\r\n  TJSHTMLButtonElement = class external name 'HTMLButtonElement' (TJSHTMLElement)\r\n  private\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FLabels: TJSNodeList; external name 'labels';\r\n    FValidationmMessage: String; external name 'validationMessage';\r\n    FValidity: TJSValidityState; external name 'validity';\r\n    FWillValidate: boolean; external name 'willValidate';\r\n  Public\r\n    autofocus : boolean;\r\n    disabled : boolean;\r\n    formAction : String;\r\n    formEnctype : String;\r\n    formMethod : String;\r\n    formNoValidate : Boolean;\r\n    formTarget : String;\r\n    menu: TJSHTMLMenuElement;\r\n    _type : String; external name 'type';\r\n  Public\r\n    property form : TJSHTMLFormElement Read FForm;\r\n    property labels : TJSNodeList Read FLabels;\r\n    property validationMessage : String Read FValidationmMessage;\r\n    property validity : TJSValidityState Read FValidity;\r\n    property willValidate : boolean read FWillValidate;\r\n  end;\r\n\r\n  TJSHTMLLabelElement = class external name 'HTMLLabelElement' (TJSHTMLElement)\r\n  Public\r\n    For_ : String; external name 'for';\r\n    form : String;\r\n  end;\r\n\r\n  { TJSHTMLTextAreaElement }\r\n\r\n  TJSHTMLTextAreaElement = class external name 'HTMLTextAreaElement' (TJSHTMLElement)\r\n  private\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FTextLength: NativeInt; external name 'textKength';\r\n    FType: String; external name 'type';\r\n    FValidationMessage: String; external name 'validationMessage';\r\n    FValidity: TJSValidityState;  external name 'validity';\r\n    FWillValidate: boolean; external name 'willValidate';\r\n  Public\r\n    defaultValue : string;\r\n    value : string;\r\n    rows : cardinal;\r\n    cols : cardinal;\r\n    autofocus : boolean;\r\n    disabled : boolean;\r\n    maxLength : nativeInt;\r\n    readOnly : Boolean;\r\n    required : Boolean;\r\n    selectionStart : Cardinal;\r\n    selectionEnd : Cardinal;\r\n    selectionDirection : String;\r\n    wrap : string;\r\n    Property Form : TJSHTMLFormElement Read FForm;\r\n    Property Type_: String Read FType;\r\n    Property textLength : NativeInt Read FTextLength;\r\n    Property validity : TJSValidityState Read FValidity;\r\n    property willValidate : boolean read FWillValidate;\r\n    property validationMessage : String Read FValidationMessage;\r\n  end;\r\n\r\n  { TJSHTMLEmbedElement }\r\n\r\n  TJSHTMLEmbedElement = class external name 'HTMLEmbedElement' (TJSHTMLElement)\r\n  Public\r\n    height: String;\r\n    src: String;\r\n    _type : String; external name 'type';\r\n    width: String;\r\n  end;\r\n\r\n  { TJSHTMLOptionElement }\r\n\r\n  TJSHTMLOptionElement = class external name 'Option' (TJSHTMLElement)\r\n  private\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FIndex: NativeInt; external name 'index';\r\n  Public\r\n    Constructor New; overload;\r\n    Constructor New(aText : String); overload;\r\n    Constructor New(aText,aValue : String); overload;\r\n    Constructor New(aText,aValue : String; aDefaultSelected : Boolean); overload;\r\n    Constructor New(aText,aValue : String; aDefaultSelected,Selected : Boolean); overload;\r\n  Public\r\n    defaultSelected : boolean;\r\n    disabled : boolean;\r\n    _label : string ; external name 'label';\r\n    selected : boolean;\r\n    text : string;\r\n    value : string;\r\n    property index : NativeInt Read FIndex;\r\n    property form : TJSHTMLFormElement Read FForm;\r\n  end;\r\n\r\n  TJSHTMLOptGroupElement = class external name 'HTMLOptGroupElement' (TJSHTMLElement)\r\n  end;\r\n\r\n  TJSHTMLOptionsCollection = class external name 'HTMLOptionsCollection' (TJSHTMLCollection)\r\n  end;\r\n\r\n  { TJSHTMLSelectElement }\r\n\r\n  TJSHTMLSelectElement = Class external name 'HTMLSelectElement' (TJSHTMLElement)\r\n  private\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FLabels: TJSNodeList; external name 'labels';\r\n    FLength: NativeInt; external name 'length';\r\n    FOptions: TJSHTMLOptionsCollection; external name 'options';\r\n    FSelectedOptions: TJSHTMLCollection; external name 'selectedOptions';\r\n    FType: String; external name 'type';\r\n    FValidationMessage: string; external name 'validationMessage';\r\n    FValidity: TJSValidityState; external name 'validity';\r\n    fwillValidate: Boolean; external name 'willValidate';\r\n  Public\r\n    Procedure add(anItem : TJSHTMLOptionElement); overload;\r\n    Procedure add(anItem, before : TJSHTMLOptionElement); overload;\r\n    function item(aIndex : NativeInt): TJSHTMLOptionElement;\r\n    function namedItem(aName : String): TJSHTMLOptionElement;\r\n    procedure remove(aIndex : NativeInt);\r\n    procedure checkValidity;\r\n    procedure setCustomValidity(aMessage : String);\r\n  Public\r\n    multiple : boolean;\r\n    required: boolean;\r\n    selectedIndex : NativeInt;\r\n    size : NativeInt;\r\n    value : string;\r\n    property length : NativeInt read FLength;\r\n    Property options : TJSHTMLOptionsCollection read FOptions;\r\n    Property selectedOptions : TJSHTMLCollection read FSelectedOptions;\r\n    Property form : TJSHTMLFormElement read FForm;\r\n    property labels : TJSNodeList Read FLabels;\r\n    property _type : String Read FType;\r\n    property validity : TJSValidityState Read FValidity;\r\n    property validationMessage : string Read FValidationMessage;\r\n    property willValidate : Boolean read fwillValidate;\r\n  end;\r\n\r\n  { TJSHTMLTableElement }\r\n\r\n  TJSHTMLTableSectionElement = class;\r\n  TJSHTMLTableRowElement = class;\r\n\r\n  TJSHTMLTableElement = Class external name 'HTMLTableElement'(TJSHTMLElement)\r\n  private\r\n    FAlign: String; external name 'align';\r\n    FBGColor: String; external name 'bgColor';\r\n    FBorder: String; external name 'border';\r\n    FCaption: TJSHTMLElement; external name 'caption';\r\n    FCellPadding: String; external name 'cellPadding';\r\n    FCellSpacing: String; external name 'cellSpacing';\r\n    FFrame: String; external name 'frame';\r\n    FRows: TJSHTMLCollection; external name 'rows';\r\n    FRules: String; external name 'rules';\r\n    FSummary: String; external name 'summary';\r\n    FTBodies: TJSHTMLCollection; external name 'tBodies';\r\n    FTfoot: TJSHTMLTableSectionElement; external name 'tfoot';\r\n    FTHead: TJSHTMLTableSectionElement; external name 'tHead';\r\n    FWidth: String; external name 'width';\r\n  public\r\n  { Methods }\r\n    function createCaption: TJSHTMLElement;\r\n    function createTFoot: TJSHTMLTableSectionElement;\r\n    function createTHead: TJSHTMLTableSectionElement;\r\n    procedure deleteCaption;\r\n    procedure deleteRow(index: Integer);\r\n    procedure deleteTFoot;\r\n    procedure deleteTHead;\r\n    function insertRow(index: Integer): TJSHTMLTableRowElement;\r\n  { Properties }\r\n    property align: String read FAlign write FAlign;\r\n    property bgColor: String read FBGColor write FBGColor;\r\n    property border: String read FBorder write FBorder;\r\n    property caption: TJSHTMLElement read FCaption;\r\n    property cellPadding: String read FCellPadding write FCellPadding;\r\n    property cellSpacing: String read FCellSpacing write FCellSpacing;\r\n    property frame: String read FFrame write FFrame;\r\n    property rows: TJSHTMLCollection read FRows;\r\n    property rules: String read FRules write FRules;\r\n    property summary: String read FSummary write FSummary;\r\n    property tBodies: TJSHTMLCollection read FTBodies;\r\n    property tfoot: TJSHTMLTableSectionElement read FTfoot;\r\n    property tHead: TJSHTMLTableSectionElement read FTHead;\r\n    property width: String read FWidth write FWidth;\r\n  end;\r\n\r\n  { TJSHTMLTableSectionElement }\r\n\r\n  TJSHTMLTableSectionElement = Class external name 'HTMLTableSectionElement' (TJSHTMLElement)\r\n  private\r\n    Falign: String; external name 'align';\r\n    Frows: TJSHTMLCollection external name 'rows';\r\n    Fch: String; external name 'ch';\r\n    FchOff: String; external name 'chOff';\r\n    FvAlign: String; external name 'vAlign';\r\n  public\r\n  { Methods }\r\n    procedure deleteRow(index: Integer);\r\n    function insertRow(index: Integer): TJSHTMLTableRowElement;\r\n  { Properties }\r\n    property align: String read Falign write Falign;\r\n    property rows: TJSHTMLCollection read Frows;\r\n    property ch: String read Fch write Fch;\r\n    property chOff: String read FchOff write FchOff;\r\n    property vAlign: String read FvAlign write FvAlign;\r\n  end;\r\n\r\n  { TJSHTMLTableCellElement }\r\n\r\n  TJSHTMLTableCellElement = Class external name 'HTMLTableCellElement' (TJSHTMLElement)\r\n  private\r\n    Fabbr: String; external name 'abbr';\r\n    Falign: String; external name 'align';\r\n    Faxis: String; external name 'axis';\r\n    FbgColor: String; external name 'bgColor';\r\n    FcellIndex: Integer; external name 'cellIndex';\r\n    Fch: String; external name 'ch';\r\n    FchOff: String; external name 'chOff';\r\n    FcolSpan: Integer; external name 'colSpan';\r\n    Fheaders: String; external name 'headers';\r\n    Fheight: String; external name 'height';\r\n    FnoWrap: Boolean; external name 'noWrap';\r\n    FrowSpan: Integer; external name 'rowSpan';\r\n    Fscope: String; external name 'scope';\r\n    FvAlign: String; external name 'vAlign';\r\n    Fwidth: String; external name 'width';\r\n  public\r\n  { Properties }\r\n    property abbr: String read Fabbr write Fabbr;\r\n    property align: String read Falign write Falign;\r\n    property axis: String read Faxis write Faxis;\r\n    property bgColor: String read FbgColor write FbgColor;\r\n    property cellIndex: Integer read FcellIndex;\r\n    property ch: String read Fch write Fch;\r\n    property chOff: String read FchOff write FchOff;\r\n    property colSpan: Integer read FcolSpan write FcolSpan;\r\n    property headers: String read Fheaders write Fheaders;\r\n    property height: String read Fheight write Fheight;\r\n    property noWrap: Boolean read FnoWrap write FnoWrap;\r\n    property rowSpan: Integer read FrowSpan write FrowSpan;\r\n    property scope: String read Fscope write Fscope;\r\n    property vAlign: String read FvAlign write FvAlign;\r\n    property width: String read Fwidth write Fwidth;\r\n  end;\r\n\r\n  { TJSHTMLTableRowElement }\r\n\r\n  TJSHTMLTableRowElement = Class external name 'HTMLTableRowElement' (TJSHTMLElement)\r\n  private\r\n    Falign: String; external name 'align';\r\n    FbgColor: String; external name 'bgColor';\r\n    Fcells: TJSHTMLCollection; external name 'cells';\r\n    Fch: String; external name 'ch';\r\n    FchOff: String; external name 'chOff';\r\n    FrowIndex: Integer; external name 'rowIndex';\r\n    FsectionRowIndex: Integer; external name 'sectionRowIndex';\r\n    FvAlign: String; external name 'vAlign';\r\n  public\r\n  { Methods }\r\n    procedure deleteCell(index: Integer);\r\n    function insertCell(index: Integer): TJSHTMLTableCellElement;\r\n  { Properties }\r\n    property align: String read Falign write Falign;\r\n    property bgColor: String read FbgColor write FbgColor;\r\n    property cells: TJSHTMLCollection read Fcells;\r\n    property ch: String read Fch write Fch;\r\n    property chOff: String read FchOff write FchOff;\r\n    property rowIndex: Integer read FrowIndex;\r\n    property sectionRowIndex: Integer read FsectionRowIndex;\r\n    property vAlign: String read FvAlign write FvAlign;\r\n  end;\r\n\r\n  { TJSHTMLTableDataCellElement }\r\n\r\n  TJSHTMLTableDataCellElement = Class external name 'HTMLTableDataCellElement' (TJSHTMLElement)\r\n  private\r\n    Fabbr: String; external name 'abbr';\r\n  public\r\n  { Properties }\r\n    property abbr: String read Fabbr write Fabbr;\r\n  end;\r\n\r\n\r\n  TJSCanvasRenderingContext2D = Class;\r\n\r\n  THTMLCanvasToBlobCallback = Reference to function (aBlob : TJSBlob) : boolean;\r\n\r\n  TJSHTMLCanvasElement = Class external name 'HTMLCanvasElement' (TJSHTMLElement)\r\n  Public\r\n    height : integer;\r\n    width : integer;\r\n    Function getContext(contextType : string) : TJSObject;\r\n    Function getContext(contextType : string; contextAttributes : TJSObject) : TJSObject;\r\n    Function getContextAs2DContext(contextType : string; contextAttributes : TJSObject) : TJSCanvasRenderingContext2D; external name 'getContext';\r\n    Function getContextAs2DContext(contextType : string) : TJSCanvasRenderingContext2D; external name 'getContext';\r\n    Procedure toBlob (aCallBack : THTMLCanvasToBlobCallback; aMimeType : String); overload;\r\n    Procedure toBlob (aCallBack : THTMLCanvasToBlobCallback; aMimeType : String; aQuality : Double); overload;\r\n    Function toDataURL : String; overload;\r\n    Function toDataURL(aMimeType : String) : String; overload;\r\n    Function toDataURL(aMimeType : String; aQuality : Double) : String; overload;\r\n  end;\r\n\r\n  TJSHTMLProgressElement = class external name 'HTMLProgressElement' (TJSHTMLElement)\r\n  private\r\n    Fposition: Double; external name 'position';\r\n    Flabels: TJSNodeList; external name 'labels';\r\n  public\r\n    max: Double;\r\n    value: Double;\r\n    property position: Double read Fposition;\r\n    property labels: TJSNodeList read Flabels;\r\n  end;\r\n  Type\r\n\r\n  { TJSDOMException }\r\n\r\n  TJSDOMException = class external name 'DOMException' (TJSObject)\r\n  private\r\n    FCode: Integer; external name 'code';\r\n    FMessage: String; external name 'message';\r\n    FName: string; external name 'name';\r\n  Public\r\n    Property code : Integer Read FCode;\r\n    Property Message : String Read FMessage;\r\n    Property name : string Read FName;\r\n  end;\r\n\r\n  { TJSFileReader }\r\n\r\n  TJSFileReader = class external name 'FileReader' (TJSEventTarget)\r\n  private\r\n    FError: TJSDOMException; external name 'error';\r\n    fReadyState: Integer; external name 'readyState';\r\n    FResult: JSValue; external name 'result';\r\n  Public\r\n    Const EMPTY : Integer;\r\n    Const LOADING : Integer;\r\n    Const DONE : Integer;\r\n  Public\r\n    onabort : TJSEventHandler;\r\n    onerror : TJSEventHandler;\r\n    onload : TJSEventHandler;\r\n    onloadstart : TJSEventHandler;\r\n    onloadend : TJSEventHandler;\r\n    onprogress : TJSEventHandler;\r\n  Public\r\n    constructor new;\r\n    Procedure abort;\r\n    procedure readAsArrayBuffer(Blob: TJSBlob);\r\n    procedure readAsBinaryString(Blob: TJSBlob);\r\n    procedure readAsDataURL(Blob: TJSBlob);\r\n    procedure readAsText(Blob: TJSBlob; encoding : string);\r\n    procedure readAsText(Blob: TJSBlob);\r\n    property Error : TJSDOMException read FError;\r\n    Property readyState : Integer Read fReadyState;\r\n    property Result : JSValue Read FResult;\r\n  end;\r\n\r\n  // Opaque objects\r\n  TJSCanvasGradient = class external name 'CanvasGradient'  (TJSObject)\r\n  end;\r\n\r\n  TJSCanvasPattern = class external name 'CanvasPattern'  (TJSObject)\r\n  end;\r\n\r\n  TJSPath2D = class external name 'Path2D'  (TJSObject)\r\n  end;\r\n\r\n  { TJSImageData }\r\n\r\n  TJSImageData = class external name 'ImageData'  (TJSObject)\r\n  private\r\n    FData: TJSUint8ClampedArray; external name 'data';\r\n    FHeight: Integer; external name 'height';\r\n    FWidth: Integer; external name 'width';\r\n  Public\r\n    constructor new(awidth,aheight : integer); overload;\r\n    constructor new(anArray :TJSUint8ClampedArray; awidth,aheight : integer); overload;\r\n    property data : TJSUint8ClampedArray read FData;\r\n    property height : Integer Read FHeight;\r\n    property width : Integer Read FWidth;\r\n  end;\r\n\r\n  TCanvasCoordType = double; // Is in fact a number.\r\n\r\n  TJSTextMetrics = class external name 'TextMetrics' (TJSObject)\r\n    width : TCanvasCoordType;\r\n    actualBoundingBoxLeft : TCanvasCoordType;\r\n    actualBoundingBoxRight : TCanvasCoordType;\r\n    fontBoundingBoxAscent : TCanvasCoordType;\r\n    fontBoundingBoxDescent : TCanvasCoordType;\r\n    actualBoundingBoxAscent : TCanvasCoordType;\r\n    actualBoundingBoxDescent : TCanvasCoordType;\r\n    emHeightAscent : TCanvasCoordType;\r\n    emHeightDescent : TCanvasCoordType;\r\n    hangingBaseline : TCanvasCoordType;\r\n    alphabeticBaseline : TCanvasCoordType;\r\n    ideographicBaseline : TCanvasCoordType;\r\n  end;\r\n\r\n  { TJSCanvasRenderingContext2D }\r\n  TJSCanvasRenderingContext2D = class external name 'CanvasRenderingContext2D'  (TJSObject)\r\n  private\r\n    FCanvas: TJSHTMLCanvasElement; external name 'canvas';\r\n    FfillStyleColor: String; external name 'fillStyle';\r\n    FfillStyleGradient: TJSCanvasGradient; external name 'fillStyle';\r\n    FfillStylePattern: TJSCanvasPattern; external name 'fillStyle';\r\n    FstrokeStyleColor: String; external name 'strokeStyle';\r\n    FstrokeStyleGradient: TJSCanvasGradient; external name 'strokeStyle';\r\n    FstrokeStylePattern: TJSCanvasPattern; external name 'strokeStyle';\r\n  Public\r\n    fillStyle : JSValue;\r\n    font : string;\r\n    globalAlpha : double;\r\n    globalCompositeOperation : String;\r\n    lineCap : string;\r\n    lineDashOffset : Double;\r\n    lineJoin : String;\r\n    lineWidth : Double;\r\n    miterLimit : Double;\r\n    shadowBlur : Double;\r\n    shadowColor : String;\r\n    shadowOffsetX : Double;\r\n    shadowOffsetY : Double;\r\n    strokeStyle : JSValue;\r\n    textAlign : String;\r\n    textBaseline : String;\r\n    procedure arc(x,y, radius,startAngle,endAngle : TCanvasCoordType); overload;\r\n    procedure arc(x,y, radius,startAngle,endAngle : TCanvasCoordType; antiClockWise : boolean); overload;\r\n    procedure arcTo(x1,y1,x2,y2,radius : TCanvasCoordType); overload;\r\n    procedure beginPath;\r\n    procedure bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y : TCanvasCoordType); overload;\r\n    procedure clearRect(x,y,width,height : TCanvasCoordType);\r\n    procedure clip; overload;\r\n    procedure clip(aFillRule : String); overload;\r\n    procedure clip(aPath : TJSPath2D); overload;\r\n    procedure closePath;\r\n    function createImageData(aWidth,aHeight : Integer) : TJSImageData; overload;\r\n    function createImageData(aImage : TJSImageData) : TJSImageData; overload;\r\n    function createLinearGradient(x0,y0,x1,y1 : TCanvasCoordType) : TJSCanvasGradient;\r\n    function createPattern(aImage : TJSObject; repetition : string) : TJSCanvasPattern;\r\n    function createRadialGradient(x0,y0,r0,x1,y1,r1 : TCanvasCoordType) : TJSCanvasGradient;\r\n    procedure drawFocusIfNeeded(aElement : TJSElement); overload;\r\n    procedure drawFocusIfNeeded(aPath : TJSPath2D; aElement : TJSElement); overload;\r\n    procedure drawImage(image : TJSObject; dx,dy : TCanvasCoordType); overload;\r\n    procedure drawImage(image : TJSObject; dx,dy,dwidth,dheight : TCanvasCoordType); overload;\r\n    procedure drawImage(image : TJSObject; sx,sy,sWidth,sHeight,dx,dy,dwidth,dheight : TCanvasCoordType); overload;\r\n    procedure fill; overload;\r\n    procedure fill(aRule : String); overload;\r\n    procedure fill(aPath : TJSPath2D); overload;\r\n    procedure fill(aPath : TJSPath2D;aRule : String); overload;\r\n    procedure fillRect(x,y,awidth,aheight: TCanvasCoordType); overload;\r\n    procedure fillText(aText : string; x,y : TCanvasCoordType); overload;\r\n    procedure fillText(aText : string; x,y, aMaxWidth : TCanvasCoordType); overload;\r\n    function getImageData(x,y,awidth,aheight: TCanvasCoordType) : TJSImageData; overload;\r\n    function getLineDash : TJSArray;\r\n    function isPointInPath(x,y : TCanvasCoordType) : Boolean; overload;\r\n    function isPointInPath(x,y : TCanvasCoordType; aFillRule : String) : Boolean; overload;\r\n    function isPointInPath(aPath : TJSPath2D; x,y : TCanvasCoordType) : Boolean; overload;\r\n    function isPointInPath(aPath : TJSPath2D; x,y : TCanvasCoordType; aFillRule : String) : Boolean; overload;\r\n    function isPointInStroke(x,y : TCanvasCoordType) : Boolean; overload;\r\n    function isPointInStroke(aPath : TJSPath2D; x,y : TCanvasCoordType) : Boolean; overload;\r\n    procedure lineTo(x,y : TCanvasCoordType);\r\n    function measureText(S : String) : TJSTextMetrics;\r\n    procedure moveTo(x,y : TCanvasCoordType);\r\n    procedure putImageData(aData : TJSImageData; x,y: TCanvasCoordType) ; overload;\r\n    procedure putImageData(aData : TJSImageData; x,y,dityX,dirtyY,dirtyWidth,dirtyHeight: TCanvasCoordType) ; overload;\r\n    procedure quadraticCurveTo(cpx,cpy,x,y : TCanvasCoordType);\r\n    procedure rect(x,y,awidth,aheight: TCanvasCoordType); overload;\r\n    procedure restore;\r\n    procedure rotate(anAngle : double);\r\n    procedure save;\r\n    procedure scale(x,y : double);\r\n    procedure setLineDash(segments : TJSArray); overload;\r\n    procedure setLineDash(segments : array of integer); overload;\r\n    procedure setTransform(a,b,c,d,e,f : double);\r\n    procedure stroke; overload;\r\n    procedure stroke(aPath : TJSPath2D); overload;\r\n    procedure strokeRect(x,y,awidth,aheight: TCanvasCoordType);\r\n    procedure strokeText(aText : string; x,y : TCanvasCoordType); overload;\r\n    procedure strokeText(aText : string; x,y, aMaxWidth : TCanvasCoordType); overload;\r\n    procedure transform(a,b,c,d,e,f : double);\r\n    procedure translate(x,y : TCanvasCoordType);\r\n\r\n    property canvas : TJSHTMLCanvasElement Read FCanvas;\r\n    property fillStyleAsColor : String Read FfillStyleColor Write FfillStyleColor;\r\n    property fillStyleAsGradient : TJSCanvasGradient Read FfillStyleGradient Write FfillStyleGradient;\r\n    property fillStyleAsPattern : TJSCanvasPattern Read FfillStylePattern Write FfillStylePattern;\r\n    property strokeStyleAsColor : String Read FstrokeStyleColor Write FstrokeStyleColor;\r\n    property strokeStyleAsGradient : TJSCanvasGradient Read FstrokeStyleGradient Write FstrokeStyleGradient;\r\n    property strokeStyleAsPattern : TJSCanvasPattern Read FstrokeStylePattern Write FstrokeStylePattern;\r\n  end;\r\n\r\n  { TJSHTMLIFrameElement }\r\n\r\n  TJSHTMLIFrameElement = Class external name 'HTMLIFrameElement' (TJSHTMLElement)\r\n  private\r\n    FAllowPaymentRequest: Boolean; external name 'allowPaymentRequest';\r\n    FContentDocument: TJSDocument; external name 'contentDocument';\r\n    FContentWindow: TJSWindow; external name 'contentWindow';\r\n    FSandbox: string; external name 'sandbox';\r\n  Public\r\n    height : string;\r\n    src : string;\r\n    srcdoc : string;\r\n    width : string;\r\n    Property allowPaymentRequest : Boolean Read FAllowPaymentRequest;\r\n    property contentWindow : TJSWindow Read FContentWindow;\r\n    property contentDocument : TJSDocument Read FContentDocument;\r\n    property sandbox : string read FSandbox;\r\n  end;\r\n\r\n  TJSHTMLScriptElement = Class external name 'HTMLScriptElement' (TJSHTMLElement)\r\n  Public\r\n    type_ : String;\r\n    src : String;\r\n    charset : string;\r\n    async : boolean;\r\n    defer : boolean;\r\n    text : string;\r\n    noModule : boolean;\r\n  end;\r\n\r\n\r\n\r\n  TJSXMLHttpRequestEventTarget = class external name 'XMLHttpRequestEventTarget' (TJSEventTarget)\r\n  end;\r\n\r\n  TJSXMLHttpRequestUpload = class external name 'XMLHttpRequestUpload' (TJSXMLHttpRequestEventTarget)\r\n  end;\r\n\r\n  { TJSXMLHttpRequest }\r\n  TJSOnReadyStateChangeHandler = reference to procedure;\r\n\r\n  TJSXMLHttpRequest = class external name 'XMLHttpRequest' (TJSXMLHttpRequestEventTarget)\r\n  private\r\n    FReadyState: NativeInt; external name 'readyState';\r\n    FResponse: JSValue; external name 'response';\r\n    FResponseText: string; external name 'responseText';\r\n    FResponseType: string; external name 'responseType';\r\n    FresponseURL: string; external name 'responseURL';\r\n    FresponseXML: TJSDocument; external name 'responseXML';\r\n    FUpload: TJSXMLHttpRequestUpload; external name 'upload';\r\n    FStatus : integer; external name 'status';\r\n    FStatusText : string; external name 'statusText';\r\n  public\r\n    const\r\n      UNSENT           = 0;\r\n      OPENED           = 1;\r\n      HEADERS_RECEIVED = 2;\r\n      LOADING          = 3;\r\n      DONE             = 4;\r\n  public\r\n    timeout : LongWord;\r\n    withCredentials : Boolean;\r\n    onreadystatechange : TJSOnReadyStateChangeHandler;\r\n    constructor new;\r\n    procedure abort;\r\n    function getResponseHeader(aName : string) : String;\r\n    function getAllResponseHeaders : String;\r\n    procedure open(aMethod,aURL : String); overload;\r\n    procedure open(aMethod,aURL : String; Async : Boolean); overload;\r\n    procedure open(aMethod,aURL : String; Async : Boolean; AUserame : String); overload;\r\n    procedure open(aMethod,aURL : String; Async : Boolean; AUserame,APassword : String); overload;\r\n    procedure overrideMimeType(aType : String);\r\n    procedure send(aBody : jsValue);overload;\r\n    procedure send;overload;\r\n    procedure setRequestHeader(aName, AValue : string);\r\n\r\n    property readyState : NativeInt read FReadyState;\r\n    property ResponseHeaders[aName : string] : string Read getResponseHeader;\r\n    property responseXML : TJSDocument read FresponseXML;\r\n    property responseURL : string read FresponseURL;\r\n    property responseType : string read FResponseType Write FResponseType;\r\n    property response : JSValue Read FResponse;\r\n    property responseText : string read FResponseText;\r\n    property Status : integer read FStatus;\r\n    property StatusText : string read FStatusText;\r\n    property upload : TJSXMLHttpRequestUpload read FUpload;\r\n\r\n  end;\r\n\r\n  { TJSUIEvent }\r\n\r\n  TJSUIEvent = class external name 'UIEvent' (TJSEvent)\r\n  private\r\n    FDetail: NativeInt; external name 'detail';\r\n    FView: TJSWindow; external name 'view';\r\n  Public\r\n    property detail : NativeInt read FDetail;\r\n    property view : TJSWindow read FView;\r\n  end;\r\n\r\n  { TJSMouseEvent }\r\n\r\n  TJSMouseEvent = class external name 'MouseEvent' (TJSUIevent)\r\n  private\r\n    FAltKey: Boolean; external name 'altKey';\r\n    FBUtton: NativeInt; external name 'button';\r\n    FBUttons: NativeInt; external name 'buttons';\r\n    FClientX: Double; external name 'clientX';\r\n    FClientY: Double; external name 'clientY';\r\n    FCtrlKey: Boolean; external name 'ctrlKey';\r\n    FMetaKey: Boolean; external name 'metaKey';\r\n    FmovementX: Double; external name 'movementX';\r\n    FmovementY: Double; external name 'movementY';\r\n    FoffsetX: Double; external name 'offsetX';\r\n    FoffsetY: Double; external name 'offsetY';\r\n    FRegion: String; external name 'region';\r\n    FRelatedTarget: TJSEventTarget; external name 'relatedTarget';\r\n    FscreenX: Double; external name 'screenX';\r\n    FscreenY: Double; external name 'screenY';\r\n    FShiftKey: Boolean; external name 'shiftKey';\r\n  Public\r\n    function getModifierState(keyArg: String): boolean;\r\n    Property altKey : Boolean read FAltKey;\r\n    Property button: NativeInt read FBUtton;\r\n    Property buttons: NativeInt read FBUttons;\r\n    property clientX : Double read FClientX;\r\n    property clientY : Double read FClientY;\r\n    property ctrlKey : Boolean read FCtrlKey;\r\n    property metaKey : Boolean read FMetaKey;\r\n    property movementX : Double read FmovementX;\r\n    property movementY : Double read FmovementY;\r\n    property offsetX : Double read FoffsetX;\r\n    property offsetY : Double read FoffsetY;\r\n{$IFDEF FIREFOX}\r\n    property pageX : Double read FpageX;\r\n    property pageY : Double read FpageY;\r\n{$ENDIF}\r\n    property region : String read FRegion;\r\n    property relatedTarget : TJSEventTarget read FRelatedTarget;\r\n    property screenX : Double read FscreenX;\r\n    property screenY : Double read FscreenY;\r\n    property shiftKey : Boolean read FShiftKey;\r\n    property x : Double read FClientX;\r\n    property y : Double read FClientY;\r\n  end;\r\n\r\n  { TJSWheelEvent }\r\n  TJSWheelEventInit = record\r\n    deltaX : Double;\r\n    deltaY : Double;\r\n    deltaZ : Double;\r\n    deltaMode : NativeInt;\r\n  end;\r\n\r\n  TJSWheelEvent = class external name 'WheelEvent' (TJSMouseEvent)\r\n  private\r\n    FDeltaMode: NativeInt; external name 'deltaMode';\r\n    FDeltaX: Double; external name 'deltaX';\r\n    FDeltaY: Double; external name 'deltaY';\r\n    FDeltaZ: Double; external name 'deltaZ';\r\n  Public\r\n    constructor new(atype : String); overload;\r\n    constructor new(atype : String; aInit : TJSWheelEventInit); overload;\r\n    Property deltaX : Double Read FDeltaX;\r\n    Property deltaY : Double Read FDeltaY;\r\n    Property deltaZ : Double Read FDeltaZ;\r\n    Property deltaMode : NativeInt Read FDeltaMode;\r\n  end;\r\n\r\n  TJSPointerEvent = Class external name 'PointerEvent' (TJSMouseEvent);\r\n\r\n  TJSTouchEvent = Class external name 'TouchEvent'(TJSUIEvent)\r\n  private\r\n    FAltKey: Boolean; external name 'altKey';\r\n    FChangedTouches: TJSTouchList; external name 'changedTouches';\r\n    FCtrlKey: Boolean; external name 'ctrlKey';\r\n    FMetaKey: Boolean; external name 'metaKey';\r\n    FShiftKey: Boolean; external name 'shiftKey';\r\n    FTargetTouches: TJSTouchList; external name 'targetTouches';\r\n    FTouches: TJSTouchList; external name 'touches';\r\n  Public\r\n    Property altKey : Boolean Read FAltKey;\r\n    Property ctrlKey : Boolean Read FCtrlKey;\r\n    Property metaKey : Boolean Read FMetaKey;\r\n    Property shiftKey : Boolean Read FShiftKey;\r\n    property changedTouches : TJSTouchList Read FChangedTouches;\r\n    property touches : TJSTouchList Read FTouches;\r\n    property targetTouches : TJSTouchList Read FTargetTouches;\r\n  end;\r\n\r\n\r\n  // Namespace for standard key names.\r\n  // See list at https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values\r\n  TJSKeyNames = Class\r\n  Const\r\n    Alt = 'Alt';\r\n    AltGraph = 'AltGraph';\r\n    CapsLock = 'CapsLock';\r\n    Control = 'Control';\r\n    Fn = 'Fn';\r\n    FnLock = 'FnLock';\r\n    Hyper = 'Hyper';\r\n    Meta = 'Meta';\r\n    NumLock = 'NumLock';\r\n    ScrollLock = 'ScrollLock';\r\n    Shift = 'Shift';\r\n    Super = 'Super';\r\n    Symbol = 'Symbol';\r\n    SymbolLock = 'SymbolLock';\r\n    Enter = 'Enter';\r\n    Tab = 'Tab';\r\n    Space = 'Space';\r\n    ArrowDown = 'ArrowDown';\r\n    ArrowLeft = 'ArrowLeft';\r\n    ArrowRight = 'ArrowRight';\r\n    ArrowUp = 'ArrowUp';\r\n    _End = 'End';\r\n    Home = 'Home';\r\n    PageDown = 'PageDown';\r\n    PageUp = 'PageUp';\r\n    BackSpace = 'Backspace';\r\n    Clear = 'Clear';\r\n    Copy = 'Copy';\r\n    CrSel = 'CrSel';\r\n    Cut = 'Cut';\r\n    Delete = 'Delete';\r\n    EraseEof = 'EraseEof';\r\n    ExSel = 'ExSel';\r\n    Insert = 'Insert';\r\n    Paste = 'Paste';\r\n    Redo = 'Redo';\r\n    Undo = 'Undo';\r\n    Accept = 'Accept';\r\n    Again = 'Again';\r\n    Attn = 'Attn';\r\n    Cancel = 'Cancel';\r\n    ContextMenu = 'Contextmenu';\r\n    Escape = 'Escape';\r\n    Execute = 'Execute';\r\n    Find = 'Find';\r\n    Finish = 'Finish';\r\n    Help = 'Help';\r\n    Pause = 'Pause';\r\n    Play = 'Play';\r\n    Props = 'Props';\r\n    Select = 'Select';\r\n    ZoomIn = 'ZoomIn';\r\n    ZoomOut = 'ZoomOut';\r\n    BrightnessDown = 'BrightnessDown';\r\n    BrightnessUp = 'BrightnessUp';\r\n    Eject = 'Eject';\r\n    LogOff = 'LogOff';\r\n    Power = 'Power';\r\n    PowerOff = 'PowerOff';\r\n    PrintScreen = 'PrintScreen';\r\n    Hibernate = 'Hibernate';\r\n    Standby = 'Standby';\r\n    WakeUp = 'WakeUp';\r\n    AllCandidates = 'AllCandidates';\r\n    Alphanumeric =  'Alphanumeric';\r\n    CodeInput = 'CodeInput';\r\n    Compose = 'Compose';\r\n    Convert = 'Convert';\r\n    Dead = 'Dead';\r\n    FinalMode = 'FinalMode';\r\n    GroupFirst = 'GroupFirst';\r\n    GroupLast = 'GroupLast';\r\n    GroupNext = 'GroupNext';\r\n    GroupPrevious = 'GroupPrevious';\r\n    ModelChange = 'ModelChange';\r\n    NextCandidate = 'NextCandidate';\r\n    NonConvert = 'NonConvert';\r\n    PreviousCandidate = 'PreviousCandidate';\r\n    Process = 'Process';\r\n    SingleCandidate = 'SingleCandidate';\r\n    HangulMode = 'HangulMode';\r\n    HanjaMode = 'HanjaMode';\r\n    JunjaMode = 'JunjaMode';\r\n    Eisu = 'Eisu';\r\n    Hankaku = 'Hankaku';\r\n    Hiranga = 'Hiranga';\r\n    HirangaKatakana = 'HirangaKatakana';\r\n    KanaMode = 'KanaMode';\r\n    Katakana = 'Katakana';\r\n    Romaji = 'Romaji';\r\n    Zenkaku = 'Zenkaku';\r\n    ZenkakuHanaku = 'ZenkakuHanaku';\r\n    F1 = 'F1';\r\n    F2 = 'F2';\r\n    F3 = 'F3';\r\n    F4 = 'F4';\r\n    F5 = 'F5';\r\n    F6 = 'F6';\r\n    F7 = 'F7';\r\n    F8 = 'F8';\r\n    F9 = 'F9';\r\n    F10 = 'F10';\r\n    F11 = 'F11';\r\n    F12 = 'F12';\r\n    F13 = 'F13';\r\n    F14 = 'F14';\r\n    F15 = 'F15';\r\n    F16 = 'F16';\r\n    F17 = 'F17';\r\n    F18 = 'F18';\r\n    F19 = 'F19';\r\n    F20 = 'F20';\r\n    Soft1 = 'Soft1';\r\n    Soft2 = 'Soft2';\r\n    Soft3 = 'Soft3';\r\n    Soft4 = 'Soft4';\r\n    Decimal = 'Decimal';\r\n    Key11 = 'Key11';\r\n    Key12 = 'Key12';\r\n    Multiply = 'Multiply';\r\n    Add = 'Add';\r\n    NumClear = 'Clear';\r\n    Divide = 'Divide';\r\n    Subtract = 'Subtract';\r\n    Separator = 'Separator';\r\n    AppSwitch = 'AppSwitch';\r\n    Call = 'Call';\r\n    Camera = 'Camera';\r\n    CameraFocus = 'CameraFocus';\r\n    EndCall = 'EndCall';\r\n    GoBack = 'GoBack';\r\n    GoHome = 'GoHome';\r\n    HeadsetHook = 'HeadsetHook';\r\n    LastNumberRedial = 'LastNumberRedial';\r\n    Notification = 'Notification';\r\n    MannerMode = 'MannerMode';\r\n    VoiceDial = 'VoiceDial';\r\n    // TODO : Multimedia keys\r\n    // TODO : Audio control keys\r\n    // TODO : TV control keys\r\n    // TODO : Media controller keys\r\n    // TODO : Speech recognition keys\r\n    // TODO : Document keys\r\n    // TODO : Application selector keys\r\n    // TODO : Browser Control keys\r\n  end;\r\n\r\n\r\n  { TJSKeyboardEvent }\r\n\r\n  TJSKeyboardEvent = class external name 'KeyboardEvent' (TJSUIEvent)\r\n  private\r\n    FAltKey: Boolean; external name 'altKey';\r\n    FCode: string; external name 'code';\r\n    FCtrlKey: Boolean; external name 'ctrlKey';\r\n    FIsComposing: Boolean;  external name 'isComposing';\r\n    FKey: String; external name 'key';\r\n    FLocale: string; external name 'locale';\r\n    FLocation: NativeInt; external name 'location';\r\n    FMetaKey: Boolean; external name 'metaKey';\r\n    FRepeat: Boolean; external name 'repeat';\r\n    FShiftKey: Boolean; external name 'shiftKey';\r\n  Public\r\n    function getModifierState(aKey : string) : Boolean;\r\n    property code : string read FCode;\r\n    Property altKey : Boolean read FAltKey;\r\n    property ctrlKey : Boolean read FCtrlKey;\r\n    property isComposing : Boolean read FIsComposing;\r\n    property Key : String read FKey;\r\n    property locale : string read FLocale;\r\n    property location : NativeInt read FLocation;\r\n    property metaKey : Boolean read FMetaKey;\r\n    property _repeat : Boolean read FRepeat;\r\n    property shiftKey : Boolean read FShiftKey;\r\n  end;\r\n\r\n  { MutationObserver }\r\n\r\n  TJSMutationObserver = Class;\r\n\r\n  TJSMutationRecord = record\r\n    type_ : string;\r\n    target : TJSNode;\r\n    addedNodes : TJSNodeList;\r\n    removedNodes : TJSNodeList;\r\n    previousSibling : TJSNode;\r\n    nextSibling : TJSNode;\r\n    attributeName : String;\r\n    attributeNamespace : String;\r\n    oldValue : String;\r\n  end;\r\n\r\n  TJSMutationRecordArray = array of TJSMutationRecord;\r\n  TJSMutationCallback = reference to procedure(mutations: TJSMutationRecordArray; observer: TJSMutationObserver);\r\n\r\n  TJSMutationObserverInit = record\r\n    attributes: boolean;\r\n    attributeOldValue: boolean;\r\n    characterData: boolean;\r\n    characterDataOldValue: boolean;\r\n    childList: boolean;\r\n    subTree: boolean;\r\n    attributeFilter: TJSArray;\r\n  end;\r\n\r\n  TJSMutationObserver = class external name 'MutationObserver' (TJSObject)\r\n  public\r\n    { constructor }\r\n    constructor new(mutationCallback: TJSMutationCallback); overload;\r\n    { public methods }\r\n    procedure observe(target: TJSNode); overload;\r\n    procedure observe(target: TJSNode; options: TJSMutationObserverInit); overload;\r\n    procedure observe(target: TJSNode; options: TJSObject); overload;\r\n    procedure disconnect;\r\n    function takeRecords: TJSMutationRecordArray;\r\n  end;\r\n\r\n  { --------------------------------------------------------------------\r\n    TJSWebSocket\r\n    --------------------------------------------------------------------}\r\n\r\n  TJSMessagePortArray = Array of TJSMessagePort;\r\n\r\n  { TJSMessageEvent }\r\n\r\n  TJSMessageEvent = class external name 'MessageEvent' (TEventListenerEvent)\r\n  private\r\n    FData: JSValue; external name 'data';\r\n    FLastEventID: String; external name 'lastEventID';\r\n    FOrigin: String;  external name 'origin';\r\n    FPorts: TJSMessagePortArray; external name 'ports';\r\n  Public\r\n    Property Data : JSValue Read FData;\r\n    Property LastEventID : String Read FLastEventID;\r\n    Property Origin : String Read FOrigin;\r\n    Property Ports : TJSMessagePortArray Read FPorts;\r\n  end;\r\n\r\n  TJSWebSocket = class external name 'WebSocket'  (TJSEventTarget)\r\n  Private\r\n    Furl : String; external name 'url';\r\n    FreadyState : Cardinal; external name 'readyState';\r\n    FbufferedAmount : NativeInt; external name 'bufferedAmount';\r\n    Fextensions : String; external name 'extensions';\r\n    Fprotocol : String; external name 'protocol';\r\n  Public\r\n    Const\r\n      CONNECTING = 0;\r\n      OPEN = 1;\r\n      CLOSING = 2;\r\n      CLOSED = 3;\r\n  Public\r\n    onopen : TJSEventHandler;\r\n    onerror : TJSEventHandler;\r\n    onclose : TJSEventHandler;\r\n    onmessage : TJSEventHandler;\r\n    binaryType : String;\r\n    constructor new(url : String); overload;\r\n    constructor new(url : String; protocol: String); overload;\r\n    constructor new(url : String; protocols: array of String); overload;\r\n    Procedure close; overload;\r\n    Procedure close(code : Cardinal); overload;\r\n    Procedure close(code : Cardinal; reason : String); overload;\r\n    Procedure send(data : String);\r\n    Procedure send(data : TJSBlob);\r\n    Procedure send(data : TJSArrayBuffer);\r\n    Procedure send(data : TJSTypedArray);\r\n    Property url : String Read Furl;\r\n    Property readyState : Cardinal Read FreadyState;\r\n    Property bufferedAmount : NativeInt Read FbufferedAmount;\r\n    Property extensions : String Read Fextensions;\r\n    Property protocol : String Read Fprotocol;\r\n  end;\r\n\r\n  TJSHTMLAudioTrack = class external name 'AudioTrack' (TJSObject)\r\n  end;\r\n\r\n  TJSHTMLAudioTrackList = class external name 'AudioTrackList' (TJSObject)\r\n    FLength : Integer; external name 'length';\r\n    function getitem(aIndex : nativeInt) : TJSHTMLAudioTrack ; external name '[]';\r\n  Public\r\n    onaddtrack : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onremovetrack : TJSEventHandler;\r\n    Property Length : Integer Read FLength;\r\n    Property tracks [aIndex : NativeInt] : TJSHTMLAudioTrack read Getitem;\r\n  end;\r\n\r\n  TJSHTMLVideoTrack = class external name 'VideoTrack' (TJSObject)\r\n  end;\r\n\r\n  TJSHTMLVideoTrackList = class external name 'VideoTrackList' (TJSObject)\r\n    FLength : Integer; external name 'length';\r\n    function getitem(aIndex : nativeInt) : TJSHTMLVideoTrack ; external name '[]';\r\n  Public\r\n    onaddtrack : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onremovetrack : TJSEventHandler;\r\n    Property Length : Integer Read FLength;\r\n    Property tracks [aIndex : NativeInt] : TJSHTMLVideoTrack read Getitem;\r\n  end;\r\n\r\n  TJSHTMLTextTrack = class external name 'TextTrack' (TJSObject)\r\n  end;\r\n\r\n  TJSHTMLTextTrackList = class external name 'TextTrackList' (TJSObject)\r\n    FLength : Integer; external name 'length';\r\n    function getitem(aIndex : nativeInt) : TJSHTMLTextTrack ; external name '[]';\r\n  Public\r\n    onaddtrack : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onremovetrack : TJSEventHandler;\r\n    Property Length : Integer Read FLength;\r\n    Property tracks [aIndex : NativeInt] : TJSHTMLTextTrack read Getitem;\r\n  end;\r\n\r\n\r\n  { TJSHTMLMediaElement }\r\n  TJSMEdiaError = class external name 'MediaError' (TJSObject)\r\n    code : NativeInt;\r\n    message : string;\r\n  end;\r\n\r\n  TJSHTMLMediaStream = class external name 'MediaStream' (TJSObject);\r\n\r\n  TJSHTMLMediaController = class external name 'MediaController' (TJSObject);\r\n\r\n  TJSHTMLMediaElement = Class external name 'HTMLMediaElement' (TJSHTMLElement)\r\n  private\r\n    FAudioTracks: TJSHTMLAudioTrackList; external name 'audioTracks';\r\n    FVideoTracks: TJSHTMLVideoTrackList; external name 'videoTracks';\r\n    FTextTracks: TJSHTMLTextTrackList; external name 'textTracks';\r\n    FControlsList: TJSDOMTokenList; external name 'controlslist';\r\n    FCurrentSrc: String; external name 'currentSrc';\r\n    FDuration: Double; external name 'duration';\r\n    FEnded: Boolean;external name 'ended';\r\n    FError: TJSMEdiaError; external name 'error';\r\n    FNetworkState: NativeInt; external name 'networkState';\r\n    FPaused: boolean; external name 'paused';\r\n    FReadyState: NativeInt; external name 'readyState';\r\n    FSeeking: boolean; external name 'seeking';\r\n    FSinkID: string; external name 'sinkId';\r\n  Public\r\n    autoplay : Boolean;\r\n    buffered : Boolean;\r\n    controls : Boolean;\r\n    controller : TJSHTMLMediaController;\r\n    crossOrigin : String;\r\n    currentTime : Double;\r\n    defaultMuted : boolean;\r\n    defaultPlaybackRate : Double;\r\n    disableRemotePlayback : Boolean;\r\n    loop : boolean;\r\n    mediaGroup : string;\r\n    muted : boolean;\r\n    preload : string;\r\n    preservesPitch : boolean;\r\n    src : string;\r\n    srcObject : TJSHTMLMediaStream;\r\n    volume : double;\r\n    onencrypted : TJSEventHandler;\r\n    onwaitingforkey : TJSEventHandler;\r\n    function canPlayType(aType : String) : String;\r\n    Function captureStream : TJSHTMLMediaStream;\r\n    Procedure play;\r\n    Procedure load;\r\n    Procedure pause;\r\n\r\n    Property AudioTracks : TJSHTMLAudioTrackList Read FAudioTracks;\r\n    Property Controlslist : TJSDOMTokenList Read FControlsList;\r\n    Property CurrentSrc : String Read FCurrentSrc;\r\n    Property Duration : Double read FDuration;\r\n    Property Ended : Boolean read FEnded;\r\n    Property Error : TJSMEdiaError read FError;\r\n    property networkState : NativeInt read FNetworkState;\r\n    property paused : boolean read FPaused;\r\n    property readyState : NativeInt read FReadyState;\r\n    property seeking : boolean read FSeeking;\r\n    property sinkID : string read FSinkID;\r\n    Property TextTracks : TJSHTMLTextTrackList Read FTextTracks;\r\n    Property VideoTracks : TJSHTMLVideoTrackList Read FVideoTracks;\r\n  end;\r\n\r\n  TJSHTMLAudioElement = Class external name 'HTMLAudioElement' (TJSHTMLMediaElement)\r\n  end;\r\n\r\n  TJSFormDataEntryValue = String;\r\n  TJSFormDataEntryValueArray = Array of TJSFormDataEntryValue;\r\n\r\n  TJSFormData = Class external name 'FormData' (TJSObject)\r\n    constructor new;\r\n    constructor new(aForm : TJSHTMLElement);\r\n    Procedure append(const aName,aValue : String);\r\n    Procedure append(const aName : String; aBlob : TJSBlob);\r\n    Procedure delete(const aName : String);\r\n    Function entries : TJSFormDataEntryValueArray;\r\n    Function get(const aName : String): TJSFormDataEntryValue;\r\n    function has(const aName : String): Boolean;\r\n    Function keys : TStringDynArray; reintroduce;\r\n    Procedure set_(const aName,aValue : String); external name 'set';\r\n    Procedure set_(const aName : String; aBlob : TJSBlob); external name 'set';\r\n    Function getAll(const aName : String) : TJSFormDataEntryValueArray;\r\n    Function values : TJSValueDynArray;\r\n    Property Entry[aIndex : String] : TJSFormDataEntryValue read Get;\r\n  end;\r\n\r\nvar\r\n  document : TJSDocument; external name 'document';\r\n  window : TJSWindow; external name 'window';\r\n  console : TJSConsole; external name 'window.console';\r\n  \r\nimplementation\r\n    \r\nend.\r\n","unit uGoogleMaps;\r\n{ ╔═════════════════════════════════════════════╗\r\n  ║ Google Maps API                             ║\r\n  ╚═════════════════════════════════════════════╝ }\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\nuses\r\n  Types, JS, Web;\r\n\r\ntype\r\n  TJSGoogleMapsEventHandler = reference to function (event: TJSEvent): boolean;\r\n\r\n{ forward declarations }\r\n  TJSStyleMedia = class;\r\n  TJSAbstractView = class;\r\n\r\n  TJSStyleMedia = class external name 'Object'\r\n  public\r\n    &type: string;\r\n    function matchMedium(mediaquery: string): boolean;\r\n  end;\r\n\r\n  TJSAbstractView = class external name 'Object'\r\n  public\r\n    styleMedia: TJSStyleMedia;\r\n    document: TJSDocument;\r\n  end;\r\n\r\n  TMaps = class external name 'maps'\r\n  end;\r\n\r\n  TGoogle = class external name 'google'\r\n  private\r\n    Fmaps: TMaps; external name 'maps';\r\n  public\r\n    property maps: TMaps read Fmaps;\r\n  end;\r\n\r\n  TGoogleMapsEventListener = class external name 'TGoogleMapsEventListener'\r\n  end;\r\n\r\n  TGoogleMapsEvent = class external name 'TGoogleMapsEvent'\r\n  end;\r\n\r\n  TGoogleEvents = class external name 'google.maps.event'\r\n  public\r\n    class function addDomListener(instance: TJSWindow; const eventName: String;\r\n                                  handler: TJSGoogleMapsEventHandler {TJSEventHandler}; capture: Boolean = false): TJSGoogleMapsEventHandler {TJSEventHandler};\r\n    class function addDomListenerOnce(instance: TJSWindow; const eventName: String;\r\n                                      handler: TJSGoogleMapsEventHandler{TJSEventHandler}; capture: Boolean = false): TJSGoogleMapsEventHandler {TJSEventHandler};\r\n    class function addListener(instance: JSValue; const eventName: String;\r\n                               handler: TJSGoogleMapsEventHandler {TJSEventHandler}): TJSGoogleMapsEventHandler {TJSEventHandler};\r\n    class function addListenerOnce(instance: JSValue; const eventName: String;\r\n                                   handler: TJSGoogleMapsEventHandler {TJSEventHandler}): TJSGoogleMapsEventHandler {TJSEventHandler};\r\n    class procedure clearInstanceListeners(instance: JSValue);\r\n    class procedure clearListeners(instance: JSValue; const eventName:string);\r\n    class procedure removeListener(listener: TJSGoogleMapsEventHandler {TJSEventHandler});\r\n    class procedure trigger(instance: JSValue; const eventName: String; var_args: JSValue = nil);\r\n   end;\r\n\r\ntype\r\n  TGoogleMVCObject = class external name 'google.maps.MVCObject'\r\n  public\r\n    function addListener(const eventName: String; handler: TJSEventHandler): TJSEventHandler;\r\n    procedure bindTo(const key: String; target: TGoogleMVCObject; targetKey: String=''; noNotify: Boolean=False);\r\n    procedure changed(const key: String);\r\n    function get(const key: String): JSValue;\r\n    procedure notify(const key: String);\r\n    procedure &set(const key: String; value: JSValue);\r\n    procedure setValues(values: JSValue);\r\n    procedure unbind(const key: String);\r\n    procedure unbindAll;\r\n  end;\r\n\r\n  TGooglePoint = class external name 'google.maps.Point'\r\n  private\r\n    fx: Double; external name 'x';\r\n    fy: Double; external name 'y';\r\n  public\r\n    constructor New(x,y: Double);\r\n    property x: Double read fx write fx;\r\n    property y: Double read fy write fy;\r\n    function equals(other: TGooglePoint): Boolean;\r\n    function toString: String;\r\n  end;\r\n\r\n  TGoogleSize = class external name 'google.maps.Size'\r\n  private\r\n    fheight: Double; external name 'height';\r\n    fwidth: Double; external name 'width';\r\n   public\r\n     constructor New(width,height: Double; widthUnit: string; heightUnit: String='');\r\n     property height: Double read fheight write fheight;\r\n     property width: Double read fwidth write fwidth;\r\n     function equals(other: TGoogleSize): Boolean;\r\n     function toString: String;\r\n   end;\r\n\r\n  (*\r\n  TGoogleMapTypeID = class external name 'google.maps.MapTypeId'\r\n  public\r\n    class var HYBRID: String; external name 'google.maps.MapTypeId.HYBRID';\r\n    class var ROADMAP: String; external name 'google.maps.MapTypeId.ROADMAP';\r\n    class var SATELLITE: String; external name 'google.maps.MapTypeId.SATELLITE';\r\n    class var TERRAIN: String; external name 'google.maps.MapTypeId.TERRAIN';\r\n    class var view: TJSAbstractView; external name 'view';\r\n  end;\r\n  *)\r\n\r\n  TGoogleMapTypeID = class external name 'google.maps.MapTypeId'\r\n  private\r\n    class var fHYBRID: String; external name 'HYBRID';\r\n    class var fROADMAP: String; external name 'ROADMAP';\r\n    class var fSATELLITE: String; external name 'SATELLITE';\r\n    class var fTERRAIN: String; external name 'TERRAIN';\r\n    class var fview: TJSAbstractView; external name 'view';\r\n   public\r\n    class property HYBRID: String read fHYBRID;\r\n    class property ROADMAP: String read fROADMAP;\r\n    class property SATELLITE: String read fSATELLITE;\r\n    class property TERRAIN: String read fTERRAIN;\r\n    class property view: TJSAbstractView read fview;\r\n  end;\r\n\r\n  TGoogleControlPosition = class external name 'google.maps.ControlPosition'\r\n  private\r\n    class var fBOTTOM_CENTER: String; external name 'BOTTOM_CENTER';\r\n    class var fBOTTOM_LEFT: String; external name 'BOTTOM_LEFT';\r\n    class var fBOTTOM_RIGHT: String; external name 'BOTTOM_RIGHT';\r\n    class var fLEFT_BOTTOM: String; external name 'LEFT_BOTTOM';\r\n    class var fLEFT_CENTER: String; external name 'LEFT_CENTER';\r\n    class var fLEFT_TOP: String; external name 'LEFT_TOP';\r\n    class var fRIGHT_BOTTOM: String; external name 'RIGHT_BOTTOM';\r\n    class var fRIGHT_CENTER: String; external name 'RIGHT_CENTER';\r\n    class var fRIGHT_TOP: String; external name 'RIGHT_TOP';\r\n    class var fTOP_CENTER: String; external name 'TOP_CENTER';\r\n    class var fTOP_LEFT: String; external name 'TOP_LEFT';\r\n    class var fTOP_RIGHT: String; external name 'TOP_RIGHT';\r\n   public\r\n     class property BOTTOM_CENTER: String read fBOTTOM_CENTER;\r\n     class property BOTTOM_LEFT: String read fBOTTOM_LEFT;\r\n     class property BOTTOM_RIGHT: String read fBOTTOM_RIGHT;\r\n     class property LEFT_BOTTOM: String read fLEFT_BOTTOM;\r\n     class property LEFT_CENTER: String read fLEFT_CENTER;\r\n     class property LEFT_TOP: String read fLEFT_TOP;\r\n     class property RIGHT_BOTTOM: String read fRIGHT_BOTTOM;\r\n     class property RIGHT_CENTER: String read fRIGHT_CENTER;\r\n     class property RIGHT_TOP: String read fRIGHT_TOP;\r\n     class property TOP_CENTER: String read fTOP_CENTER;\r\n     class property TOP_LEFT: String read fTOP_LEFT;\r\n     class property TOP_RIGHT: String read fTOP_RIGHT;\r\n   end;\r\n\r\n  TGoogleMapTypeControlStyle = class external name 'google.maps.MapTypeControlStyle'\r\n  private\r\n    class var fDEFAULT: String; external name 'DEFAULT';\r\n    class var fDROPDOWN_MENU: String; external name 'DROPDOWN_MENU';\r\n    class var fHORIZONTAL_BAR: String; external name 'HORIZONTAL_BAR';\r\n   public\r\n     class property &DEFAULT: String read fDEFAULT;\r\n     class property DROPDOWN_MENU: String read fDROPDOWN_MENU;\r\n     class property HORIZONTAL_BAR: String read fHORIZONTAL_BAR;\r\n   end;\r\n\r\n  TGoogleScaleControlStyle = class external name 'google.maps.ScaleControlStyle'\r\n  private\r\n    class var fDEFAULT: String; external name 'DEFAULT';\r\n   public\r\n     class property DEFAULT: String read fDEFAULT;\r\n  end;\r\n\r\n  TGoogleZoomControlStyle = class external name 'google.maps.ZoomControlStyle'\r\n  private\r\n    class var fDEFAULT: String; external name 'DEFAULT';\r\n    class var fLARGE: String; external name 'LARGE';\r\n    class var fSMALL: String; external name 'SMALL';\r\n  public\r\n    class property DEFAULT: String read fDEFAULT;\r\n    class property LARGE: String read fLARGE;\r\n    class property SMALL: String read fSMALL;\r\n   end;\r\n\r\n  TGoogleMapTypeControlOptions = class external name 'google.maps.MapTypeControlOptions'\r\n  private\r\n    fmapTypeIds: TStringDynArray; external name 'mapTypeIds';\r\n    fposition: String; external name 'position';\r\n    fstyle: String; external name 'style';\r\n   public\r\n    property mapTypeIds: TStringDynArray read fmapTypeIds write fmapTypeIds;\r\n    property position: String read fposition write fposition;\r\n    property style: String read fstyle write fstyle;\r\n   end;\r\n\r\n  TGoogleLatLng = class external name 'google.maps.LatLng'\r\n  public\r\n    constructor New(lat,lng: Double; noWrap: Boolean=False);\r\n    function equals(other: TGoogleLatLng): Boolean;\r\n    function lat: Double;\r\n    function lng: Double;\r\n    function toString: String;\r\n    function toUrlValue(precision: Double): String;\r\n  end;\r\n\r\n  TGoogleOverviewMapControlOptions = class external name 'google.maps.OverviewMapControlOptions'\r\n  private\r\n    fopened: Boolean; external name 'opened';\r\n  public\r\n    property opened: Boolean read fopened write fopened;\r\n   end;\r\n\r\n  TGooglePanControlOptions = class external name 'google.maps.PanControlOptions'\r\n  private\r\n    fposition: String; external name 'position';\r\n  public\r\n    property position: String read fposition write fposition;\r\n   end;\r\n\r\n  TGoogleRotateControlOptions = class external name 'google.maps.RotateControlOptions'\r\n  private\r\n    fposition: String; external name 'position';\r\n  public\r\n    property position: String read fposition write fposition;\r\n  end;\r\n\r\n  TGoogleScaleControlOptions = class external name 'google.maps.ScaleControlOptions'\r\n  private\r\n    fstyle: String; external name 'style';\r\n  public\r\n    property style: String read fstyle write fstyle;\r\n  end;\r\n\r\n  TGoogleStreetViewControlOptions = class external name 'google.maps.StreetViewControlOptions'\r\n  private\r\n    fposition: String; external name 'position';\r\n  public\r\n    property position: String read fposition write fposition;\r\n  end;\r\n\r\n  TGoogleZoomControlOptions = class external name 'google.maps.ZoomControlOptions'\r\n  private\r\n    fposition: String; external name 'position';\r\n    fstyle: String; external name 'style';\r\n  public\r\n    property position: String read fposition write fposition;\r\n    property style: String read fstyle write fstyle;\r\n  end;\r\n\r\n  TGoogleMapOptions = class external name 'google.maps.MapOptions'\r\n  //TGoogleMapOptions = class external name 'Object' (TJSObject)\r\n  private\r\n    fbackgroundColor: String; external name 'backgroundColor';\r\n    fcenter: TGoogleLatLng; external name 'center';\r\n    fdisableDefaultUI: Boolean; external name 'disableDefaultUI';\r\n    fdisableDoubleClickZoom: Boolean; external name 'disableDoubleClickZoom';\r\n    fdraggable: Boolean; external name 'draggable';\r\n    fdraggableCursor: String; external name 'draggableCursor';\r\n    fdraggingCursor: String; external name 'draggingCursor';\r\n    fheading: Double; external name 'heading';\r\n    fkeyboardShortcuts: Boolean; external name 'keyboardShortcuts';\r\n    fmapMaker: Boolean; external name 'mapMaker';\r\n    fmapTypeControl: Boolean; external name 'mapTypeControl';\r\n    fmapTypeControlOptions: TGoogleMapTypeControlOptions; external name 'mapTypeControlOptions';\r\n    fmapTypeId: String; external name 'mapTypeId';\r\n    fmaxZoom: Integer; external name 'maxZoom';\r\n    fminZoom: Integer; external name 'minZoom';\r\n    fnoClear: Boolean; external name 'noClear';\r\n    foverviewMapControl: Boolean; external name 'overviewMapControl';\r\n    foverviewMapControlOptions: TGoogleOverviewMapControlOptions; external name 'overviewMapControlOptions';\r\n    fpanControl: Boolean; external name 'panControl';\r\n    fpanControlOptions: TGooglePanControlOptions; external name 'panControlOptions';\r\n    frotateControl: Boolean; external name 'rotateControl';\r\n    frotateControlOptions: TGoogleRotateControlOptions; external name 'rotateControlOptions';\r\n    fscaleControl: Boolean; external name 'scaleControl';\r\n    fscaleControlOptions: TGoogleScaleControlOptions; external name 'scaleControlOptions';\r\n    fscrollwheel: Boolean; external name 'scrollwheel';\r\n    fstreetViewControl: Boolean; external name 'streetViewControl';\r\n    fstreetViewControlOptions: TGoogleStreetViewControlOptions; external name 'streetViewControlOptions';\r\n    fstyles: TStringDynArray; external name 'styles';\r\n    ftilt: Integer; external name 'tilt';\r\n    fzoom: Integer; external name 'zoom';\r\n    fzoomControl: Boolean; external name 'zoomControl';\r\n    fzoomControlOptions: TGoogleZoomControlOptions; external name 'zoomControlOptions';\r\n  public\r\n     property backgroundColor: String read fbackgroundColor write fbackgroundColor;\r\n     property center: TGoogleLatLng read fcenter write fcenter;\r\n     property disableDefaultUI: Boolean read fdisableDefaultUI write fdisableDefaultUI;\r\n     property disableDoubleClickZoom: Boolean read fdisableDoubleClickZoom write fdisableDoubleClickZoom;\r\n     property draggable: Boolean read fdraggable write fdraggable;\r\n     property draggableCursor: String read fdraggableCursor write fdraggableCursor;\r\n     property draggingCursor: String read fdraggingCursor write fdraggingCursor;\r\n     property heading: Double read fheading write fheading;\r\n     property keyboardShortcuts: Boolean read fkeyboardShortcuts write fkeyboardShortcuts;\r\n     property mapMaker: Boolean read fmapMaker write fmapMaker;\r\n     property mapTypeControl: Boolean read fmapTypeControl write fmapTypeControl;\r\n     property mapTypeControlOptions: TGoogleMapTypeControlOptions read fmapTypeControlOptions write fmapTypeControlOptions;\r\n     property mapTypeId: String read fmapTypeId write fmapTypeId;\r\n     property maxZoom: Integer read fmaxZoom write fmaxZoom;\r\n     property minZoom: Integer read fminZoom write fminZoom;\r\n     property noClear: Boolean read fnoClear write fnoClear;\r\n     property overviewMapControl: Boolean read foverviewMapControl write foverviewMapControl;\r\n     property overviewMapControlOptions: TGoogleOverviewMapControlOptions read foverviewMapControlOptions write foverviewMapControlOptions;\r\n     property panControl: Boolean read fpanControl write fpanControl;\r\n     property panControlOptions: TGooglePanControlOptions read fpanControlOptions write fpanControlOptions;\r\n     property rotateControl: Boolean read frotateControl write frotateControl;\r\n     property rotateControlOptions: TGoogleRotateControlOptions read frotateControlOptions write frotateControlOptions;\r\n     property scaleControl: Boolean read fscaleControl write fscaleControl;\r\n     property scaleControlOptions: TGoogleScaleControlOptions read fscaleControlOptions write fscaleControlOptions;\r\n     property scrollwheel: Boolean read fscrollwheel write fscrollwheel;\r\n     property streetViewControl: Boolean read fstreetViewControl write fstreetViewControl;\r\n     property streetViewControlOptions: TGoogleStreetViewControlOptions read fstreetViewControlOptions write fstreetViewControlOptions;\r\n     property styles: TStringDynArray read fstyles write fstyles;\r\n     property tilt: Integer read ftilt write ftilt;\r\n     property zoom: Integer read fzoom write fzoom;\r\n     property zoomControl: Boolean read fzoomControl write fzoomControl;\r\n     property zoomControlOptions: TGoogleZoomControlOptions read fzoomControlOptions write fzoomControlOptions;\r\n  end;\r\n\r\n  TGoogleLatLngBounds = class external name 'google.maps.LatLngBounds'\r\n  public\r\n    constructor New(sw: TGoogleLatLng; ne: TGoogleLatLng=nil);\r\n    function contains(latLng: TGoogleLatLng): Boolean;\r\n    function equals(other: TGoogleLatLngBounds): Boolean;\r\n    function extend(point: TGoogleLatLng): TGoogleLatLngBounds;\r\n    function getCenter: TGoogleLatLng;\r\n    function getNorthEast: TGoogleLatLng;\r\n    function getSouthWest: TGoogleLatLng;\r\n    function intersects(other: TGoogleLatLngBounds): Boolean;\r\n    function isEmpty: Boolean;\r\n    function toSpan: TGoogleLatLng;\r\n    function toString: String;\r\n    function toUrlValue(precision: Double=0): String;\r\n    function union(other: TGoogleLatLngBounds): TGoogleLatLngBounds;\r\n  end;\r\n\r\n  TGoogleProjection = class external name 'google.maps.Projection'\r\n  public\r\n    function fromLatLngToPoint(latLng: TGoogleLatLng; point: TGooglePoint=nil): TGooglePoint;\r\n    function fromPointToLatLng(pixel: TGooglePoint; nowrap: Boolean=False): TGoogleLatLng;\r\n  end;\r\n\r\n  TGoogleMapType = class external name 'google.maps.MapType'\r\n  private\r\n    falt: String; external name 'alt';\r\n    fmaxZoom: Integer; external name 'maxZoom';\r\n    fminZoom: Integer; external name 'minZoom';\r\n    fname: String; external name 'name';\r\n    fprojection: TGoogleProjection; external name 'projection';\r\n    fradius: Double; external name 'radius';\r\n    ftileSize: TGoogleSize; external name 'tileSize';\r\n  public\r\n    property alt: String read falt write falt;\r\n    property maxZoom: Integer read fmaxZoom write fmaxZoom;\r\n    property minZoom: Integer read fminZoom write fminZoom;\r\n    property name: String read fname write fname;\r\n    property projection: TGoogleProjection read fprojection write fprojection;\r\n    property radius: Double read fradius write fradius;\r\n    property tileSize: TGoogleSize read ftileSize write ftileSize;\r\n\r\n    function getTile(tileCoord: TGooglePoint; zoom: Integer; ownerDocument: TJSDocument): TJSNode;\r\n    procedure releaseTile(tile: TJSNode);\r\n  end;\r\n\r\n  TGoogleMapTypeRegistry = class external name 'google.maps.MapTypeRegistry' (TGoogleMVCObject)\r\n  public\r\n    procedure &set(const id: String; mapType: TGoogleMapType=nil);\r\n  end;\r\n\r\n  TGoogleMap = class external name 'google.maps.Map' (TGoogleMVCObject)\r\n  private\r\n    fmapTypes: TGoogleMapTypeRegistry; external name 'mapTypes';\r\n  public\r\n    constructor New(mapDiv: TJSNode; opts: TGoogleMapOptions);\r\n    property mapTypes: TGoogleMapTypeRegistry read fmapTypes;\r\n    procedure fitBounds(bounds: TGoogleLatLngBounds);\r\n    function getBounds: TGoogleLatLngBounds;\r\n    function getCenter: TGoogleLatLng;\r\n    function getDiv: TJSNode;\r\n    function getHeading: Double;\r\n    function getMapTypeId: String;\r\n    function getProjection: TGoogleProjection;\r\n    function getTilt: Integer;\r\n    function getZoom: Integer;\r\n    procedure panBy(x,y: Double);\r\n    procedure panTo(latLng: TGoogleLatLng);\r\n    procedure panToBounds(latLngBounds: TGoogleLatLngBounds);\r\n    procedure setCenter(latlng: TGoogleLatLng);\r\n    procedure setHeading(heading: Double);\r\n    procedure setMapTypeId(mapTypeId: String);\r\n    procedure setOptions(options: TGoogleMapOptions);\r\n    procedure setTilt(tilt: Integer);\r\n    procedure setZoom(zoom: Integer);\r\n  end;\r\n\r\n  TGoogleGeocoderAddressComponent = class external name 'google.maps.GeocoderAddressComponent'\r\n  private\r\n    flong_name: String; external name 'long_name';\r\n    fshort_name: String; external name 'short_name';\r\n    ftypes: TStringDynArray; external name 'types';\r\n  public\r\n    property long_name: String read flong_name;\r\n    property short_name: String read fshort_name;\r\n    property types: TStringDynArray read ftypes;\r\n  end;\r\n\r\n  TGoogleGeocoderStatus = class external name 'google.maps.GeocoderStatus'\r\n  private\r\n    class var fERROR: String; external name 'ERROR';\r\n    class var fINVALID_REQUEST: String; external name 'INVALID_REQUEST';\r\n    class var fOK: String; external name 'OK';\r\n    class var fOVER_QUERY_LIMIT: String; external name 'OVER_QUERY_LIMIT';\r\n    class var fREQUEST_DENIED: String; external name 'REQUEST_DENIED';\r\n    class var fUNKNOWN_ERROR: String; external name 'UNKNOWN_ERROR';\r\n    class var fZERO_RESULTS: String; external name 'ZERO_RESULTS';\r\n  public\r\n    class property ERROR: String read fERROR;\r\n    class property INVALID_REQUEST: String read fINVALID_REQUEST;\r\n    class property OK: String read fOK;\r\n    class property OVER_QUERY_LIMIT: String read fOVER_QUERY_LIMIT;\r\n    class property REQUEST_DENIED: String read fREQUEST_DENIED;\r\n    class property UNKNOWN_ERROR: String read fUNKNOWN_ERROR;\r\n    class property ZERO_RESULTS: String read fZERO_RESULTS;\r\n  end;\r\n\r\n  TGoogleGeocoderLocationType = class external name 'google.maps.GeocoderLocationType'\r\n  private\r\n    class var fAPPROXIMATE: String; external name 'APPROXIMATE';\r\n    class var fGEOMETRIC_CENTER: String; external name 'GEOMETRIC_CENTER';\r\n    class var fRANGE_INTERPOLATED: String; external name 'RANGE_INTERPOLATED';\r\n    class var fROOFTOP: String; external name 'ROOFTOP';\r\n  public\r\n    class property APPROXIMATE: String read fAPPROXIMATE;\r\n    class property GEOMETRIC_CENTER: String read fGEOMETRIC_CENTER;\r\n    class property RANGE_INTERPOLATED: String read fRANGE_INTERPOLATED;\r\n    class property ROOFTOP: String read fROOFTOP;\r\n  end;\r\n\r\n  TGoogleGeocoderGeometry = class external name 'google.maps.GeocoderGeometry'\r\n  private\r\n    fbounds: TGoogleLatLngBounds; external name 'bounds';\r\n    flocation: TGoogleLatLng; external name 'location';\r\n    flocation_type: TGoogleGeocoderLocationType; external name 'location_type';\r\n    fviewport: TGoogleLatLngBounds; external name 'viewport';\r\n  public\r\n    property bounds: TGoogleLatLngBounds read fbounds;\r\n    property location: TGoogleLatLng read flocation;\r\n    property location_type: TGoogleGeocoderLocationType read flocation_type;\r\n    property viewport: TGoogleLatLngBounds read fviewport;\r\n  end;\r\n\r\n  type\r\n    TGoogleGeocoderAddressComponents = array of TGoogleGeocoderAddressComponent;\r\n\r\n  type\r\n  TGoogleGeocoderResult = class external name 'google.maps.GeocoderResult'\r\n  private\r\n    faddress_components: TGoogleGeocoderAddressComponents; external name 'address_components';\r\n    fformatted_address: String; external name 'formatted_address';\r\n    fgeometry: TGoogleGeocoderGeometry; external name 'geometry';\r\n    fpartial_match: Boolean; external name 'partial_match';\r\n    fpostcode_localities: TStringDynArray; external name 'postcode_localities';\r\n    ftypes: TStringDynArray; external name 'types';\r\n  public\r\n    property address_components: TGoogleGeocoderAddressComponents read faddress_components;\r\n    property formatted_address: String read fformatted_address;\r\n    property geometry: TGoogleGeocoderGeometry read fgeometry;\r\n    property partial_match: Boolean read fpartial_match;\r\n    property postcode_localities: TStringDynArray read fpostcode_localities;\r\n    property types: TStringDynArray read ftypes;\r\n  end;\r\n\r\n  TGoogleGeocoderResults = class external name 'TGoogleGeocoderResults'\r\n  private\r\n    flength: Integer; external name 'length';\r\n  public\r\n    function fitems(index: Integer): TGoogleGeocoderResult;\r\n    property items[index: Integer]: TGoogleGeocoderResult read fitems; default;\r\n    property length: Integer read flength;\r\n  end;\r\n\r\n  TGoogleGeocoderCallback = procedure (results: TGoogleGeocoderResults;\r\n                                              const status: String) of object;\r\n\r\n  TGoogleGeocoderComponentRestrictions = class external name 'google.maps.GeocoderComponentRestrictions'\r\n  private\r\n    fadministrativeArea: String; external name 'administrativeArea';\r\n    fcountry: String; external name 'country';\r\n    flocality: String; external name 'locality';\r\n    fpostalCode: String; external name 'postalCode';\r\n    froute: String; external name 'route';\r\n  public\r\n    property administrativeArea: String read fadministrativeArea write fadministrativeArea;\r\n    property country: String read fcountry write fcountry;\r\n    property locality: String read flocality write flocality;\r\n    property postalCode: String read fpostalCode write fpostalCode;\r\n    property route: String read froute write froute;\r\n  end;\r\n\r\n  TGoogleGeocoderRequest = class external name 'google.maps.GeocoderRequest'\r\n  private\r\n    faddress: String; external name 'address';\r\n    fbounds: TGoogleLatLngBounds; external name 'bounds';\r\n    fcomponentRestrictions: TGoogleGeocoderComponentRestrictions; external name 'componentRestrictions';\r\n    flocation: TGoogleLatLng; external name 'location';\r\n    fregion: String; external name 'region';\r\n  public\r\n    property address: String read faddress write faddress;\r\n    property bounds: TGoogleLatLngBounds read fbounds write fbounds;\r\n    property componentRestrictions: TGoogleGeocoderComponentRestrictions read fcomponentRestrictions write fcomponentRestrictions;\r\n    property location: TGoogleLatLng read flocation write flocation;\r\n    property region: String read fregion write fregion;\r\n  end;\r\n\r\n  TGoogleGeocoder = class external name 'google.maps.Geocoder'\r\n  public\r\n    constructor New;\r\n    procedure geocode(request: TGoogleGeocoderRequest; callback: TGoogleGeocoderCallback);\r\n  end;\r\n\r\n  TGoogleAnimation = class external name 'google.maps.Animation'\r\n  private\r\n    class var fBOUNCE: String; external name 'BOUNCE';\r\n    class var fDROP: String; external name 'DROP';\r\n  public\r\n    class property BOUNCE: String read fBOUNCE;\r\n    class property DROP: String read fDROP;\r\n  end;\r\n\r\n  TGoogleAttribution = class external name 'google.maps.Attribution'\r\n  private\r\n    fiosDeepLinkId: String; external name 'iosDeepLinkId';\r\n    fsource: String; external name 'source';\r\n    fwebUrl: String; external name 'webUrl';\r\n  public\r\n    property iosDeepLinkId: String read fiosDeepLinkId write fiosDeepLinkId;\r\n    property source: String read fsource write fsource;\r\n    property webUrl: String read fwebUrl write fwebUrl;\r\n  end;\r\n\r\n  TGooglePlace = class external name 'google.maps.Place'\r\n  private\r\n    flocation: TGoogleLatLng; external name 'location';\r\n    fplaceId: String; external name 'placeId';\r\n    fquery: String; external name 'query';\r\n  public\r\n    property location: TGoogleLatLng read flocation write flocation;\r\n    property placeId: String read fplaceId write fplaceId;\r\n    property query: String read fquery write fquery;\r\n  end;\r\n\r\n  TGoogleMarkerOptions = class external name 'google.maps.MarkerOptions'\r\n  //TGoogleMarkerOptions = class external name 'Object' (TJSObject)\r\n  private\r\n    fanchorPoint: TGooglePoint; external name 'anchorPoint';\r\n    fanimation: String; external name 'animation';\r\n    fattribution: TGoogleAttribution; external name 'attribution';\r\n    fclickable: Boolean; external name 'clickable';\r\n    fcrossOnDrag: Boolean; external name 'crossOnDrag';\r\n    fcursor: String; external name 'cursor';\r\n    fdraggable: Boolean; external name 'draggable';\r\n    ficon: String; external name 'icon';\r\n    fmap: TGoogleMap; external name 'map';\r\n    fopacity: Double; external name 'opacity';\r\n    foptimized: Boolean; external name 'optimized';\r\n    fplace: TGooglePlace; external name 'place';\r\n    fposition: TGoogleLatLng; external name 'position';\r\n    ftitle: String; external name 'title';\r\n    fvisible: Boolean; external name 'visible';\r\n    fzIndex: Integer; external name 'zIndex';\r\n  public\r\n   property anchorPoint: TGooglePoint read fanchorPoint write fanchorPoint;\r\n   property animation: String read fanimation write fanimation;\r\n   property attribution: TGoogleAttribution read fattribution write fattribution;\r\n   property clickable: Boolean read fclickable write fclickable;\r\n   property crossOnDrag: Boolean read fcrossOnDrag write fcrossOnDrag;\r\n   property cursor: String read fcursor write fcursor;\r\n   property draggable: Boolean read fdraggable write fdraggable;\r\n   property icon: String read ficon write ficon;\r\n   property map: TGoogleMap read fmap write fmap;\r\n   property opacity: Double read fopacity write fopacity;\r\n   property optimized: Boolean read foptimized write foptimized;\r\n   property place: TGooglePlace read fplace write fplace;\r\n   property position: TGoogleLatLng read fposition write fposition;\r\n   property title: String read ftitle write ftitle;\r\n   property visible: Boolean read fvisible write fvisible;\r\n   property zIndex: Integer read fzIndex write fzIndex;\r\n end;\r\n\r\n  TGoogleMarker = class external name 'google.maps.Marker' (TGoogleMVCObject)\r\n  public\r\n    constructor New(opts: TGoogleMarkerOptions=nil);\r\n    function getAnimation: TGoogleAnimation;\r\n    function getAttribution: TGoogleAttribution;\r\n    function getClickable: Boolean;\r\n    function getCursor: String;\r\n    function getDraggable: Boolean;\r\n    function getIcon: String;\r\n    function getMap: TGoogleMap;\r\n    function getOpacity: Double;\r\n    function getPlace: TGooglePlace;\r\n    function getPosition: TGoogleLatLng;\r\n    function getTitle: String;\r\n    function getVisible: Boolean;\r\n    function getZIndex: Integer;\r\n    procedure setAnimation(animation: TGoogleAnimation);\r\n    procedure setAttribution(attribution: TGoogleAttribution);\r\n    procedure setClickable(flag: Boolean);\r\n    procedure setCursor(const cursor: String);\r\n    procedure setDraggable(flag: Boolean);\r\n    procedure setIcon(const icon: String);\r\n    procedure setMap(map: TGoogleMap);\r\n    procedure setOpacity(opacity: Double);\r\n    procedure setOptions(options: TGoogleMarkerOptions);\r\n    procedure setPlace(place: TGooglePlace);\r\n    procedure setPosition(latlng: TGoogleLatLng);\r\n    procedure setTitle(const title: String);\r\n    procedure setVisible(visible: Boolean);\r\n    procedure setZIndex(zIndex: Integer);\r\n   end;\r\n\r\nimplementation\r\n\r\nend.\r\n\r\n","program project1;\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\nuses\r\n   JS, Web, uGoogleMaps;\r\n\r\n(*\r\nfunction loadMap(event: TJSEvent): boolean;\r\nvar\r\n  mapOptions: TGoogleMapOptions;\r\n  latlng: TGoogleLatLng;\r\n  map: TGoogleMap;\r\n  beachMarker: TGoogleMarker;\r\n  markerOptions: TGoogleMarkerOptions;\r\nbegin\r\n  console.log('Seven Lakes Map');\r\n  latlng:= TGoogleLatLng.New(-19.4574, -44.2417);\r\n\r\n  mapOptions := TGoogleMapOptions.new;\r\n  mapOptions.zoom:= 16;\r\n  mapOptions.center := latlng;\r\n  mapOptions.mapTypeId := TGoogleMapTypeID.ROADMAP;\r\n\r\n  map := TGoogleMap.New(document.querySelector('#sample'), mapOptions);\r\n\r\n  markerOptions:= TGoogleMarkerOptions.New;\r\n  markerOptions.position := TGoogleLatLng.New(-19.4574, -44.2417);\r\n\r\n  beachMarker:= TGoogleMarker.New(markerOptions);\r\n  beachMarker.setMap(map);\r\n  beachMarker.setIcon('beachflag.png');\r\nend;*)\r\n\r\n//* approach i\r\n//  assuming we have already this tag in the main html\r\n//  <script src = \"https://maps.googleapis.com/maps/api/js\"></script>\r\n// this approach does not work with pas2js, just because pas2js is started on the 'load' event;\r\n\r\n(*\r\nprocedure initializeGM;\r\nvar\r\n  FHandler: TJSGoogleMapsEventHandler;\r\nbegin\r\n  FHandler := TGoogleEvents.addDomListener(window, 'load', @loadMap );\r\n//  FHandler := TGoogleEvents.addDomListener(window, 'DOMContentLoaded', @loadMap );\r\nend;\r\n*)\r\n\r\n\r\nfunction CreateObjecto(obj: String): JSValue; assembler;\r\nasm\r\n return eval(\"(\" + obj + \")\");\r\nend;\r\n\r\nfunction CreateObj: JSValue; assembler;\r\nasm\r\n return {};\r\nend;\r\n\r\n\r\nvar  CreateObject: TJSObject; external name '{}';\r\n(*\r\ntype\r\n  TGM = class\r\n  private\r\n    DisableDefaultUI: Boolean;\r\n    DisableDblClickZoom: Boolean;\r\n    Draggable: Boolean;\r\n    Heading: Double;\r\n    mapTypeId: String;\r\n    center: TGoogleLatLng;\r\n  protected\r\n    procedure SetMapOptions(Value: TGoogleMapOptions);\r\n    function GetMapOptions: TGoogleMapOptions;\r\n  public\r\n    property MapOptions: TGoogleMapOptions read GetMapOptions write SetMapOptions;\r\n  end;\r\n\r\nprocedure TGM.SetMapOptions(Value: TGoogleMapOptions);\r\nbegin\r\n   Value.disableDefaultUI:= DisableDefaultUI;\r\n   Value.disableDoubleClickZoom:= DisableDblClickZoom;\r\n   Value.draggable:= Draggable;\r\n   Value.heading:= Heading;\r\n   Value.mapTypeId:= mapTypeId;\r\n   Value.center := center;\r\nend;\r\n\r\nfunction TGM.GetMapOptions: TGoogleMapOptions;\r\nbegin\r\n   //Result:=TGoogleMapOptions(CreateObject('{}'));\r\n   Result:=TGoogleMapOptions(CreateObjecto);\r\n   SetMapOptions(Result);\r\nend;\r\n*)\r\n\r\ntype\r\nTOption = class\r\nprivate\r\n  DisableDefaultUI: Boolean;\r\n  DisableDblClickZoom: Boolean;\r\n  Draggable: Boolean;\r\n  Heading: Double;\r\n  mapTypeId: String;\r\n  center: TGoogleLatLng;\r\nprotected\r\n//  procedure SetMapOptions(Value: TGoogleMapOptions);\r\n//  function GetMapOptions: TGoogleMapOptions;\r\npublic\r\n//  property MapOptions: TGoogleMapOptions read GetMapOptions write SetMapOptions;\r\nend;\r\n\r\n{ TMap }\r\n\r\nTMap = class\r\n  private\r\n    FOptions: TOption;\r\n    FGoogleMap: TGoogleMap;\r\n    DisableDefaultUI: Boolean;\r\n    DisableDblClickZoom: Boolean;\r\n    Draggable: Boolean;\r\n    Heading: Double;\r\n    mapTypeId: String;\r\n    center: TGoogleLatLng;\r\n  protected\r\n    procedure SetMapOptions(Value: TGoogleMapOptions);\r\n    function GetMapOptions: TGoogleMapOptions;\r\n  public\r\n    constructor Create;\r\n    property GoogleMap: TGoogleMap read FGoogleMap write FGoogleMap;\r\n    property MapOptions: TGoogleMapOptions read GetMapOptions write SetMapOptions;\r\nend;\r\n\r\n{ TMap }\r\n\r\nconstructor TMap.Create;\r\nbegin\r\n  inherited Create;\r\nend;\r\n\r\nprocedure TMap.SetMapOptions(Value: TGoogleMapOptions);\r\nbegin\r\n   Value.disableDefaultUI:= DisableDefaultUI;\r\n   Value.disableDoubleClickZoom:= DisableDblClickZoom;\r\n   Value.draggable:= Draggable;\r\n   Value.heading:= Heading;\r\n   Value.mapTypeId:= mapTypeId;\r\n   Value.center := center;\r\nend;\r\n\r\nfunction TMap.GetMapOptions: TGoogleMapOptions;\r\nbegin\r\n   //Result:=TGoogleMapOptions(CreateObject('{}'));\r\n   Result:=TGoogleMapOptions(CreateObject);\r\n   SetMapOptions(Result);\r\nend;\r\n\r\nfunction loadMap(event: TJSEvent): boolean;\r\n(*\r\nvar\r\n  gm: TMap;\r\n  beachMarker: TGoogleMarker;\r\n  markerOptions: TGoogleMarkerOptions;\r\nbegin\r\n  gm := TMap.Create;\r\n  //gm.Options.disableDefaultUI:=TRUE;\r\n  //gm.Options.disableDoubleClickZoom:=true;\r\n  //gm.Options.draggable:=true;\r\n  //gm.Options.heading:= 123;\r\n  gm.MapOptions.zoom:= 16;\r\n  gm.MapOptions.mapTypeId := TGoogleMapTypeID.ROADMAP;\r\n  gm.MapOptions.center := TGoogleLatLng.New(-19.4574, -44.2417);\r\n  gm.GoogleMap := TGoogleMap.New(document.querySelector('#sample'), gm.MapOptions);\r\n\r\n  markerOptions:= TGoogleMarkerOptions.New;\r\n   markerOptions.position := TGoogleLatLng.New(-19.4574, -44.2417);\r\n\r\n   beachMarker:= TGoogleMarker.New(markerOptions);\r\n   beachMarker.setMap(gm.GoogleMap);\r\n   beachMarker.setIcon('beachflag.png');\r\n*)\r\n\r\n\r\nvar\r\n  mapOptions: TGoogleMapOptions;\r\n\r\n  map: TGoogleMap;\r\n  beachMarker: TGoogleMarker;\r\n  markerOptions: TGoogleMarkerOptions;\r\nbegin\r\n  console.log('Seven Lakes Map');\r\n\r\n  mapOptions := TGoogleMapOptions(CreateObject);\r\n  mapOptions.zoom:= 16;\r\n  mapOptions.center := TGoogleLatLng.New(-19.4574, -44.2417);\r\n  mapOptions.mapTypeId := TGoogleMapTypeID.ROADMAP;\r\n\r\n  map := TGoogleMap.New(document.querySelector('#sample'), mapOptions);\r\n\r\n  //markerOptions:= TGoogleMarkerOptions.New;\r\n  markerOptions:= TGoogleMarkerOptions(CreateObject);\r\n  markerOptions.position := TGoogleLatLng.New(-19.4574, -44.2417);\r\n\r\n  beachMarker:= TGoogleMarker.New(markerOptions);\r\n  beachMarker.setMap(map);\r\n  beachMarker.setIcon('beachflag.png');\r\n\r\nend;\r\n\r\n//  inject the Google maps script\r\nprocedure InjectJS;\r\nvar\r\n  id: string;\r\n  script: TJSHTMLScriptElement;\r\nbegin\r\n  script := TJSHTMLScriptElement(document.createElement('script'));\r\n  script.src := 'https://maps.googleapis.com/maps/api/js?v=3&signed_in=true';\r\n  script.type_ := 'text/javascript';\r\n  script.addEventListener('load', @loadMap);\r\n  document.body.appendChild(script);\r\nend;\r\n\r\n//var\r\n // r: JSValue;\r\n // GoogleMapTypeControlOptions: TGoogleMapTypeControlOptions;\r\n // Value: TGoogleMapOptions;\r\n//  GM: TGM;\r\n\r\nbegin\r\n  // Your code here\r\n  InjectJS;\r\n\r\n\r\n  (*\r\n  GM := TGM.Create;\r\n  GM.MapOptions.disableDefaultUI:=TRUE;\r\n  GM.MapOptions.disableDoubleClickZoom:=true;\r\n  GM.MapOptions.draggable:=true;\r\n  GM.MapOptions.heading:= 123;\r\n  GM.mapTypeId := TGoogleMapTypeID.ROADMAP;\r\n  GM.center := TGoogleLatLng.New(-19.4574, -44.2417);\r\n  *)\r\n\r\n\r\n\r\n  // initialize Google Maps\r\n  //InjectJS;\r\n\r\n//  r:=   CreateObjecto;\r\n//    console.log(r);\r\n\r\n\r\n//r:=   CreateObj;\r\n//  console.log(r);\r\n\r\n//r:= CreateObject('{hello: \"world\", key: \"value\"}');\r\n//console.log(r);\r\n\r\n// Value := TGoogleMapOptions(CreateObject('{}'));\r\n//  Value.mapTypeControlOptions:= TGoogleMapTypeControlOptions(CreateObject('{}'));\r\n//  Value.mapTypeControlOptions:= TGoogleMapTypeControlOptions(CreateObject('{}'));\r\n//  console.log(Value);\r\n\r\n\r\n//Value := TGoogleMapOptions(CreateObjecto);\r\n//Value.mapTypeControlOptions := TGoogleMapTypeControlOptions(CreateObjecto);\r\n//TGoogleMapOptions(Value).mapTypeControlOptions.position:='1';\r\n\r\n//console.log(Value);\r\n\r\n//GoogleMapTypeControlOptions: TGoogleMapTypeControlOptions;\r\n\r\n//console.log(GetMapOptions)\r\nend.\r\n\r\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/zCA;;;AA2hCA;AACE,mBAAU;nBADZ;AA3hCA;ACAA,iBAKS,UALT;;;;3BCIA,kBAES,eAFT;;;;jCChBA,0BAQS,qBART;;;;/CCAA,sBAAiB,mCAAjB;;;zDA+JgB;AAAP;AA2BP;AAEA;AACA;AACA;AAEA,kBAAO,IAAI,CAAC,iBAAD;xCAEX,iBAAgC;jBAChC,cAAU,KAAV,GAAkB;tBAClB,cAAU,OAAV,GAAmC,IAAd,kBAAc,CAAI,CAAC,QAAS,CAAC,QDGC,KCHhB;tEACnC,cAAU,UAAV,GAAwB,qBAAgB;hDAExC,UAAkB,IAAX,eAAW,CAAI,QAAQ,cAAc,CAAC,SAAD,EAAa,UAAvC;1EAGlB,oBAAqC;pBACrC,iBAAa,SAAb,GAAwC,IAAd,kBAAc,CAAI,CAAC,QAAS,CAAC,QDJJ,KCIX;3EAExC,kBAA4B,IAAd,kBAAc,CAAI,aAAJ;tDAC5B,eAAW,OAAO,CAAC,GAAD;1BAClB,eAAW,QAAQ,CAAC,eAAD;vCAhDZ;AAAO;AAqDE;AAGhB;AAEA,aAA+B,QAAQ,cAAc,CAAC,QAAD;5CACrD,UAAM,IAAN,GAAc;jBACd,UAAM,MAAN,GAAgB;nBAChB,UAAM,iBAAiB,CAAC,mBAAD;/CACvB,YAAQ,KAAK,YAAY,CAAC,MAAD;pCATT;AAkBlB;AAEE;AAFF;AAtOA"}